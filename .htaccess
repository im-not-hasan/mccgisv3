# ---------------------------------------------------------
# Normalize host: strip :443 and force HTTPS + www
# ----------------------------------------------------------
RewriteEngine On

# If Host includes :443, redirect to clean domain
RewriteCond %{HTTP_HOST} ^(.+):443$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# Force HTTPS (if not already secure)
RewriteCond %{HTTPS} !=on
RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]


<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteRule ^(.*)$ public/$1 [L]
</IfModule>

# --------------------------
# Security hardening
# --------------------------

# Deny access to hidden files (.env, .git, etc.)
RedirectMatch 404 /\.(.*)$

# Block sensitive Laravel files
<FilesMatch "(artisan|server\.php|composer\.(json|lock)|package\.json|webpack\.mix\.js)">
    Require all denied
</FilesMatch>

# Block access to vendor folder
RedirectMatch 404 ^/vendor/.*

# Block storage folder
RedirectMatch 404 ^/storage/.*

# Disable directory browsing
Options -Indexes
