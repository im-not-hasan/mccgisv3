import{N as A,r as c,L as R,g as v,d as b,e,b as O,l as z,w as G,k as B,t as u,p as W,f as g,i as w,v as L,T as X,M as Z,a as C,c as N,o as ee,F as T,h as $,u as I,j as S,n as te}from"./app-C4_4Ab5x.js";import{S as h}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as oe}from"./DashboardLayout-BBqqxHqF.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ne={class:"bg-white w-full max-w-2xl p-6 rounded-xl shadow-lg relative animate-fade-in-up"},re={class:"text-xl font-bold mb-4 text-mccblue select-none"},ae=["value"],ie={__name:"SubjectForm",props:{course:String,editMode:Boolean,subjectToEdit:Object},emits:["submitted","cancelEdit"],setup(M,{emit:q}){const x=q,{props:j}=A(),f=c(!1),y=M,s=c({code:"",title:"",lecunit:0,labunit:0,pre:"",year:"",semester:""}),k=()=>{y.editMode||(d(),f.value=!0)},d=()=>{s.value={code:"",title:"",lecunit:0,labunit:0,pre:"",year:"",semester:""}},m=()=>{f.value=!1,d(),x("cancelEdit")};R(()=>y.subjectToEdit,a=>{y.editMode&&a&&(s.value={code:a.code,title:a.title,lecunit:a.lecunit,labunit:a.labunit,pre:a.pre,year:a.year,semester:a.semester},f.value=!0)},{immediate:!0});const i=async()=>{var t;const a={code:s.value.code,title:s.value.title,lecunit:s.value.lecunit,labunit:s.value.labunit,pre:s.value.pre,year:s.value.year,semester:s.value.semester,course:y.course};try{y.editMode&&((t=y.subjectToEdit)!=null&&t.id)?(await C.put(`/subjects/${y.subjectToEdit.id}`,a),h.fire({icon:"success",title:"Subject Updated",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})):(await C.post("/subjects",a),h.fire({icon:"success",title:"Subject Added",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})),d(),f.value=!1,x("submitted")}catch(r){h.fire("Error","Could not save subject","error"),console.error("Subject save error:",r)}};return(a,t)=>(b(),v("div",null,[e("button",{onClick:k,class:"bg-mccblue hover:bg-mccdarkblue text-white font-semibold py-2 px-4 rounded-md transition"}," + Add Subject "),(b(),O(Z,{to:"body"},[z(X,{name:"fade"},{default:G(()=>[f.value?(b(),v("div",se,[e("div",ne,[e("h2",re,u(M.editMode?"Edit Subject":"Add New Subject"),1),e("form",{onSubmit:W(i,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Subject Code",-1)),g(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>s.value.code=r),placeholder:"e.g. BSIT101",class:"peer w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},null,512),[[w,s.value.code]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Subject Title",-1)),g(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=r=>s.value.title=r),placeholder:"e.g. Introduction to Computing",class:"peer w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},null,512),[[w,s.value.title]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Lecture Units",-1)),g(e("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=r=>s.value.lecunit=r),min:"0",class:"peer w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},null,512),[[w,s.value.lecunit,void 0,{number:!0}]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Lab Units",-1)),g(e("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=r=>s.value.labunit=r),min:"0",class:"peer w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},null,512),[[w,s.value.labunit,void 0,{number:!0}]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Total Units",-1)),e("input",{type:"number",value:Number(s.value.lecunit)+Number(s.value.labunit),disabled:"",class:"peer w-full rounded-md border border-gray-300 bg-gray-100 text-gray-800 px-3 py-2 placeholder-gray-400"},null,8,ae)]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Prerequisites",-1)),g(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=r=>s.value.pre=r),placeholder:"e.g. None",class:"peer w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition"},null,512),[[w,s.value.pre]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Year Level",-1)),g(e("select",{"onUpdate:modelValue":t[5]||(t[5]=r=>s.value.year=r),class:"peer w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},t[13]||(t[13]=[e("option",{value:"",disabled:""},"Select Year",-1),e("option",{value:"1"},"1st Year",-1),e("option",{value:"2"},"2nd Year",-1),e("option",{value:"3"},"3rd Year",-1),e("option",{value:"4"},"4th Year",-1)]),512),[[L,s.value.year]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Semester",-1)),g(e("select",{"onUpdate:modelValue":t[6]||(t[6]=r=>s.value.semester=r),class:"peer w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},t[15]||(t[15]=[e("option",{value:"",disabled:""},"Select Semester",-1),e("option",{value:"1"},"1st Semester",-1),e("option",{value:"2"},"2nd Semester",-1),e("option",{value:"summer"},"Summer",-1)]),512),[[L,s.value.semester]])]),e("div",{class:"md:col-span-2 flex justify-end gap-4 pt-4"},[e("button",{type:"button",onClick:m,class:"text-gray-500 hover:text-red-500 transition"}," Cancel "),t[17]||(t[17]=e("button",{type:"submit",class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded-md transition"}," Save ",-1))])],32),e("button",{onClick:m,class:"absolute top-4 right-4 text-gray-500 text-2xl hover:text-red-500 transition"}," × ")])])):B("",!0)]),_:1})]))]))}},ue=le(ie,[["__scopeId","data-v-8ba0bb04"]]),de={class:"flex flex-col md:flex-row justify-between select-none items-center p-5"},ce={class:"mb-2 md:mb-0"},be=["value"],me={class:"flex flex-col md:flex-row gap-2 items-center"},pe={class:"p-4 space-y-6 animate-slide-in-top"},ve={class:"overflow-x-auto rounded-lg border shadow"},fe={class:"min-w-full bg-white"},ye={class:"bg-mcclightblue text-white"},ge=["onClick"],xe={key:0},we={class:"px-4 py-2"},he={class:"px-4 py-2"},ke={class:"px-4 py-2 text-center"},Se={class:"px-4 py-2 text-center"},Ce={class:"px-4 py-2 text-center"},je={class:"px-4 py-2 text-center"},_e={class:"px-4 py-2 text-center space-x-2"},Ee=["onClick"],Te=["onClick"],$e={key:0},Me={class:"flex justify-between bg-mcclightblue items-center px-2 text-sm text-white select-none"},Ue={class:"font-semibold"},Ve={class:"font-semibold"},Ne={class:"font-semibold"},Be={class:"flex gap-1"},Le=["disabled"],qe=["onClick"],Pe=["disabled"],Ae={__name:"CourseSubjects",props:{course:String},setup(M){const x=A().props.course,j=c(""),f=c(""),y=c(""),s=c([]),k=c(""),d=c([{key:"year",direction:"asc"},{key:"semester",direction:"asc"}]),m=c(10),i=c(1),a=c(!1),t=c(null),r=[{key:"code",label:"Code"},{key:"title",label:"Title"},{key:"totalunit",label:"Units"},{key:"pre",label:"Prerequisites"},{key:"year",label:"Year"},{key:"semester",label:"Semester"}],H=async()=>{try{const n=await C.get("/session");j.value=n.data.fullname,f.value=n.data.level,y.value=n.data.username,(!j.value||!f.value)&&(window.location.href="/")}catch{window.location.href="/"}},U=async()=>{try{const n=await C.get(`/api/subjects/${x}`);s.value=n.data,i.value=1,F()}catch(n){console.error("Failed to load subjects:",n)}},V=N(()=>[...s.value].sort((l,o)=>{for(const p of d.value){const E=p.key,D=p.direction;if(l[E]<o[E])return D==="asc"?-1:1;if(l[E]>o[E])return D==="asc"?1:-1}return 0}).filter(l=>Object.values(l).join(" ").toLowerCase().includes(k.value.toLowerCase()))),_=N(()=>{const n=(i.value-1)*m.value;return V.value.slice(n,n+m.value)}),P=()=>{i.value=1},Y=N(()=>Math.ceil(V.value.length/m.value)),J=n=>{const l=d.value.findIndex(o=>o.key===n);l!==-1?d.value[l].direction=d.value[l].direction==="asc"?"desc":"asc":d.value.push({key:n,direction:"asc"})},K=async n=>{if((await h.fire({title:"Delete this subject?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes"})).isConfirmed)try{await C.delete(`/subjects/${n}`),await U(),h.fire({toast:!0,title:"Deleted",icon:"success",position:"top-end",timer:2e3,showConfirmButton:!1})}catch{h.fire("Error","Failed to delete subject.","error")}},Q=n=>{a.value=!0,t.value={...n}},F=()=>{a.value=!1,t.value=null};return ee(()=>{H(),U()}),(n,l)=>(b(),O(oe,{fullname:j.value,userLevel:f.value,title:`Subjects – ${I(x)}`},{default:G(()=>[e("div",de,[e("div",ce,[l[5]||(l[5]=e("label",{class:"mr-2"},"Show",-1)),g(e("select",{"onUpdate:modelValue":l[0]||(l[0]=o=>m.value=o),onChange:P,class:"border py-1 rounded"},[(b(),v(T,null,$([10,25,50,100],o=>e("option",{key:o,value:o},u(o),9,be)),64))],544),[[L,m.value]]),l[6]||(l[6]=e("span",{class:"ml-2"},"entries",-1))]),e("div",me,[g(e("input",{"onUpdate:modelValue":l[1]||(l[1]=o=>k.value=o),onInput:P,type:"text",placeholder:"Search subjects...",class:"border px-3 py-1 rounded w-full md:w-64"},null,544),[[w,k.value]]),z(ue,{course:I(x),class:"ml-4",onSubmitted:U,editMode:a.value,subjectToEdit:t.value,onCancelEdit:F},null,8,["course","editMode","subjectToEdit"])])]),e("div",pe,[e("div",ve,[e("table",fe,[e("thead",ye,[e("tr",null,[(b(),v(T,null,$(r,o=>e("th",{key:o.key,class:"px-4 py-2 select-none text-center cursor-pointer",onClick:p=>J(o.key)},[S(u(o.label)+" ",1),d.value.find(p=>p.key===o.key)?(b(),v("span",xe,u(d.value.find(p=>p.key===o.key).direction==="asc"?"▲":"▼"),1)):B("",!0)],8,ge)),64)),l[7]||(l[7]=e("th",{class:"px-4 py-2 text-center select-none"},"Actions",-1))])]),e("tbody",null,[(b(!0),v(T,null,$(_.value,o=>(b(),v("tr",{key:o.id,class:"hover:bg-gray-100"},[e("td",we,u(o.code),1),e("td",he,u(o.title),1),e("td",ke,u(o.totalunit),1),e("td",Se,u(o.pre||"None"),1),e("td",Ce,u(o.year),1),e("td",je,u(o.semester==1?"1st Sem":o.semester==2?"2nd Sem":"Summer"),1),e("td",_e,[e("button",{onClick:p=>Q(o),class:"text-blue-600 select-none hover:underline"}," Edit ",8,Ee),e("button",{onClick:p=>K(o.id),class:"text-red-600 select-none hover:underline"}," Delete ",8,Te)])]))),128)),_.value.length===0?(b(),v("tr",$e,l[8]||(l[8]=[e("td",{colspan:"7",class:"text-center py-4"},"No subjects found.",-1)]))):B("",!0)])]),e("div",Me,[e("div",null,[l[9]||(l[9]=S(" Showing ")),e("span",Ue,u(_.value.length?(i.value-1)*m.value+1:0),1),l[10]||(l[10]=S(" to ")),e("span",Ve,u((i.value-1)*m.value+_.value.length),1),l[11]||(l[11]=S(" of ")),e("span",Ne,u(V.value.length),1),l[12]||(l[12]=S(" entries "))]),e("div",Be,[e("button",{onClick:l[2]||(l[2]=o=>d.value=[]),class:"text-sm text-white border-0 rounded hover:bg-mccblue transition"}," Clear Sorting "),e("button",{onClick:l[3]||(l[3]=o=>i.value=i.value-1),disabled:i.value===1,class:"px-3 py-1 border-0 rounded disabled:opacity-50 disabled:hover:bg-mcclightblue hover:bg-mccblue transition"}," Prev ",8,Le),(b(!0),v(T,null,$(Y.value,o=>(b(),v("button",{key:o,onClick:p=>i.value=o,class:te(["px-3 py-1 border-0 rounded",i.value===o?"bg-white text-mccblue font-bold":"hover:bg-mccblue transition"])},u(o),11,qe))),128)),e("button",{onClick:l[4]||(l[4]=o=>i.value=i.value+1),disabled:i.value===Y.value,class:"px-3 py-1 border-0 rounded disabled:opacity-50 disabled:hover:bg-mcclightblue hover:bg-mccblue transition"}," Next ",8,Pe)])])])])]),_:1},8,["fullname","userLevel","title"]))}};export{Ae as default};
