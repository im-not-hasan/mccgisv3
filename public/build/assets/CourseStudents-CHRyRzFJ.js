import{r as d,L as X,a as f,g as u,d as r,e,l as O,w as q,i as k,t as i,T as H,p as Z,f as b,j as M,F as S,h as $,v as j,N as ee,c as R,o as te,b as K,u as Q,k as N,n as se}from"./app-BM-D2KsP.js";import{S as C}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as le}from"./DashboardLayout-BXprZFQe.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ae={class:"bg-white w-full max-w-3xl p-6 rounded-xl shadow-lg relative animate-fade-in-up"},re={class:"text-xl font-bold mb-4 text-mccblue select-none text-center"},ue={class:"relative w-full h-[600px] overflow-hidden"},ie={class:"ml-1"},de={class:"ml-1"},ce={class:"ml-1"},me=["value"],ve={class:"ml-1"},be=["value"],fe={class:"ml-1"},pe=["value"],ge={class:"ml-1"},ye={class:"md:col-span-2 flex justify-end gap-4 pt-4"},xe={type:"submit",class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded-md transition"},we={key:0,class:"absolute top-0 left-0 w-full h-full p-4 flex flex-col"},he={class:"flex items-center justify-between mb-4"},ke={class:"text-xl font-bold text-mccblue select-none"},Se={class:"relative mb-4"},$e={key:0,class:"absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-40 overflow-y-auto"},Ce=["onClick"],_e={class:"mb-4 flex-1 overflow-y-auto"},je=["onClick"],Ee={__name:"StudentForm",props:{course:String,editMode:Boolean,studentToEdit:Object},emits:["submitted","cancelEdit"],setup(A,{emit:J}){const E=J,v=A,p=d(!1),h=d(1),U=d([]),g=d([]);d(null);const y=d(""),x=d([]),c=d([]),F=d([]),B=()=>{const s=y.value.toLowerCase();x.value=U.value.filter(t=>t.title.toLowerCase().includes(s))},P=s=>{g.value.some(t=>t.id===s.id)||g.value.push(s),y.value="",x.value=[]},Y=s=>{g.value=g.value.filter(t=>t.id!==s.id)},o=d({studid:"",fname:"",mname:"",lname:"",email:"",course:v.course||"",year:"",section:"",semester:"",ay:"",gender:"",regular:1}),_=()=>{o.value={studid:"",fname:"",mname:"",lname:"",email:"",course:v.course||"",year:"",section:"",semester:"",ay:"",gender:"",regular:1},h.value=1,U.value=[],g.value=[]},T=async()=>{v.editMode||(_(),p.value=!0),await a(),await l()},V=()=>{p.value=!1,_(),E("cancelEdit")};X(()=>v.studentToEdit,async s=>{v.editMode&&s&&(await a(),await l(),o.value={...s},p.value=!0,s.regular==0&&(await L(),await m(s.studid)))},{immediate:!0});const I=async()=>{var s;if(!v.editMode&&await w(o.value.studid)){C.fire("Error","Student ID already exists. Please use a unique ID.","error");return}if(o.value.regular==0&&h.value==1){await L(),h.value=2;return}try{v.editMode&&((s=v.studentToEdit)!=null&&s.id)?(await f.put(`/students/${v.studentToEdit.id}`,o.value),C.fire({icon:"success",title:"Student Updated",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})):(console.log("Form payload:",o.value),await f.post("/students",o.value),C.fire({icon:"success",title:"Student Added",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})),_(),p.value=!1,E("submitted")}catch(t){t.response&&t.response.status===422?(console.error("Validation errors:",t.response.data.errors),C.fire("Validation Error","Please check form fields.","error")):(console.error("Error saving student:",t),C.fire("Error","Could not save student","error"))}},z=()=>{h.value=1},L=async()=>{try{const s=await f.get(`/api/allsubjects/${o.value.course}`);U.value=s.data}catch(s){console.error("Failed to load subjects",s)}},G=async()=>{try{v.editMode?(await f.put(`/students/${v.studentToEdit.id}`,o.value),await f.put(`/api/irregstudentsubject/${o.value.studid}`,{subjects:g.value})):(await f.post("/students",o.value),await f.post("/api/irregstudentsubject",{studid:o.value.studid,subjects:g.value})),C.fire({icon:"success",title:v.editMode?"Student Updated":"Student Added",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1}),_(),p.value=!1,E("submitted")}catch(s){console.error("Error saving irregular subjects:",s),C.fire("Error","Could not save irregular student subjects","error")}},D=()=>{let s=o.value.studid.replace(/\D/g,"");s.length>8&&(s=s.slice(0,8)),s.length>4&&(s=s.slice(0,4)+"-"+s.slice(4)),o.value.studid=s},m=async s=>{try{const t=await f.get(`/api/irregstudentsubject/${s}`);g.value=t.data}catch(t){console.error("Failed to load existing irregular subjects:",t)}},a=async()=>{try{const s=await f.get("/api/sections");c.value=s.data}catch(s){console.error("Failed to fetch sections:",s)}},l=async()=>{try{const s=await f.get("/api/academicyears");F.value=s.data}catch(s){console.error("Failed to fetch academic years:",s)}},w=async s=>{try{return(await f.get(`/api/students/check/${s}`)).data.exists}catch(t){return console.error("Failed to check studid:",t),!1}};return(s,t)=>(r(),u("div",null,[e("button",{onClick:T,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded-lg shadow-md transition"},t[12]||(t[12]=[e("p",{class:"text-xs md:text-base select-none"},"+ Add Student",-1)])),O(H,{name:"fade"},{default:q(()=>[p.value?(r(),u("div",ne,[e("div",ae,[h.value===2?(r(),u("button",{key:0,onClick:z,class:"absolute top-4 left-4 text-gray-500 text-lg hover:text-mccblue transition mt-[9px]"}," ← Back ")):k("",!0),e("h2",re,i(h.value===1?A.editMode?"Edit Student":"Add New Student":"Select Subjects for "+o.value.fname+" "+o.value.lname),1),e("div",ue,[O(H,{name:"slide-left-right"},{default:q(()=>[h.value===1?(r(),u("form",{key:0,onSubmit:Z(I,["prevent"]),class:"absolute top-0 left-0 w-full h-full grid grid-cols-1 md:grid-cols-2 gap-4 overflow-y-auto pr-2"},[e("div",ie,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Student ID",-1)),b(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=n=>o.value.studid=n),onInput:D,placeholder:"e.g. 2024-0001",maxlength:"9",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},null,544),[[M,o.value.studid]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"First Name",-1)),b(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>o.value.fname=n),placeholder:"e.g. Hasan",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},null,512),[[M,o.value.fname]])]),e("div",de,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Middle Name",-1)),b(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>o.value.mname=n),placeholder:"Leave Blank if N/A",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition"},null,512),[[M,o.value.mname]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Last Name",-1)),b(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=n=>o.value.lname=n),placeholder:"e.g. Syed",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},null,512),[[M,o.value.lname]])]),e("div",ce,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Email",-1)),b(e("input",{type:"email","onUpdate:modelValue":t[4]||(t[4]=n=>o.value.email=n),placeholder:"e.g. hasanmangubat@gmail.com",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition"},null,512),[[M,o.value.email]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Year",-1)),b(e("select",{"onUpdate:modelValue":t[5]||(t[5]=n=>o.value.year=n),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},[t[18]||(t[18]=e("option",{value:"",disabled:""},"Select Year",-1)),(r(),u(S,null,$([1,2,3,4],n=>e("option",{key:n,value:n},i(n),9,me)),64))],512),[[j,o.value.year]])]),e("div",ve,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Section",-1)),b(e("select",{"onUpdate:modelValue":t[6]||(t[6]=n=>o.value.section=n),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},[t[20]||(t[20]=e("option",{value:"",disabled:""},"Select Section",-1)),(r(!0),u(S,null,$(c.value,n=>(r(),u("option",{key:n,value:n},i(n),9,be))),128))],512),[[j,o.value.section]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Semester",-1)),b(e("select",{"onUpdate:modelValue":t[7]||(t[7]=n=>o.value.semester=n),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},t[22]||(t[22]=[e("option",{value:"",disabled:""},"Select Semester",-1),e("option",{value:"First Semester"},"First Semester",-1),e("option",{value:"Second Semester"},"Second Semester",-1),e("option",{value:"Summer"},"Summer",-1)]),512),[[j,o.value.semester]])]),e("div",fe,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Academic Year",-1)),b(e("select",{"onUpdate:modelValue":t[8]||(t[8]=n=>o.value.ay=n),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},[t[24]||(t[24]=e("option",{value:"",disabled:""},"Select Academic Year",-1)),(r(!0),u(S,null,$(F.value,n=>(r(),u("option",{key:n,value:n},i(n),9,pe))),128))],512),[[j,o.value.ay]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Gender",-1)),b(e("select",{"onUpdate:modelValue":t[9]||(t[9]=n=>o.value.gender=n),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},t[26]||(t[26]=[e("option",{value:"",disabled:""},"Select Gender",-1),e("option",{value:"Male"},"Male",-1),e("option",{value:"Female"},"Female",-1)]),512),[[j,o.value.gender]])]),e("div",ge,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Student Type",-1)),b(e("select",{"onUpdate:modelValue":t[10]||(t[10]=n=>o.value.regular=n),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition"},t[28]||(t[28]=[e("option",{value:1},"Regular",-1),e("option",{value:0},"Irregular",-1)]),512),[[j,o.value.regular]])]),e("div",ye,[e("button",{type:"button",onClick:V,class:"text-gray-500 hover:text-red-500 transition"}," Cancel "),e("button",xe,i(o.value.regular==0?"Next":"Save"),1)])],32)):k("",!0)]),_:1}),O(H,{name:"slide-left-right"},{default:q(()=>[h.value===2?(r(),u("div",we,[e("div",he,[e("h2",ke,i(o.value.fname)+" "+i(o.value.lname)+" - Subjects",1)]),e("div",Se,[b(e("input",{"onUpdate:modelValue":t[11]||(t[11]=n=>y.value=n),onInput:B,placeholder:"Type to search subject",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition"},null,544),[[M,y.value]]),x.value.length?(r(),u("div",$e,[(r(!0),u(S,null,$(x.value,n=>(r(),u("div",{key:n.id,onClick:W=>P(n),class:"px-3 py-2 hover:bg-gray-200 text-gray-800 cursor-pointer"},i(n.title),9,Ce))),128))])):k("",!0)]),e("ul",_e,[(r(!0),u(S,null,$(g.value,n=>(r(),u("li",{key:n.id,class:"flex justify-between items-center bg-gray-100 text-gray-800 px-3 py-2 mb-2 rounded-md"},[e("span",null,i(n.title),1),e("button",{onClick:W=>Y(n),class:"text-red-500 hover:text-red-700"},"-",8,je)]))),128))]),e("div",{class:"flex justify-end gap-4 mt-auto pt-4"},[e("button",{onClick:G,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded-md transition"}," Save ")])])):k("",!0)]),_:1})]),e("button",{onClick:V,class:"absolute top-4 right-4 text-gray-500 text-2xl hover:text-red-500 transition mt-[6px]"}," × ")])])):k("",!0)]),_:1})]))}},Ve=oe(Ee,[["__scopeId","data-v-d84a5812"]]),Me={class:"flex flex-col md:flex-row justify-between select-none items-center p-5"},Ue={class:"mb-2 md:mb-0"},Fe=["value"],Te={class:"flex flex-col md:flex-row gap-2 items-center"},Be={class:"p-4 space-y-6 animate-slide-in-top"},Ne={class:"overflow-x-auto rounded-lg border shadow"},Ie={class:"min-w-full bg-white"},Le={class:"bg-mcclightblue text-white"},De=["onClick"],qe={key:0},Ae={key:0,class:"px-4 py-2 text-center"},Pe={class:"px-4 py-2 text-center"},Ye={class:"px-4 py-2"},ze={class:"px-4 py-2 text-center"},Ge={class:"px-4 py-2 text-center"},Oe={key:0,class:"px-4 py-2 text-center space-x-2"},He=["onClick"],Re=["onClick"],Je={key:0},Ke={class:"flex justify-between bg-mcclightblue items-center px-2 text-sm text-white select-none"},Qe={class:"font-semibold"},We={class:"font-semibold"},Xe={class:"font-semibold"},Ze={class:"flex gap-1 items-center"},et=["disabled"],tt=["onClick"],st=["value"],lt=["disabled"],ut={__name:"CourseStudents",setup(A){const E=ee().props.course,v=d(""),p=d(""),h=d(""),U=d([]),g=d(""),y=d([{key:"studid",direction:"asc"}]),x=d(10),c=d(1),F=d(!1),B=d(null),P=[{key:"studid",label:"Student ID"},{key:"name",label:"Name"},{key:"gender",label:"Gender"},{key:"year",label:"Year"}],Y=async()=>{try{const m=await f.get("/session");v.value=m.data.fullname,p.value=m.data.level,h.value=m.data.username,(!v.value||!p.value)&&(window.location.href="/")}catch{window.location.href="/"}},o=async()=>{const m=await f.get(`/api/students/${E}`);U.value=m.data,c.value=1,D()},_=R(()=>[...U.value].sort((a,l)=>{for(const w of y.value){const s=w.key,t=w.direction;if(a[s]<l[s])return t==="asc"?-1:1;if(a[s]>l[s])return t==="asc"?1:-1}return 0}).filter(a=>Object.values(a).join(" ").toLowerCase().includes(g.value.toLowerCase()))),T=R(()=>{const m=(c.value-1)*x.value;return _.value.slice(m,m+x.value)}),V=R(()=>Math.ceil(_.value.length/x.value)),I=()=>{c.value=1},z=m=>{const a=y.value.findIndex(l=>l.key===m);a!==-1?y.value[a].direction=y.value[a].direction==="asc"?"desc":"asc":y.value.push({key:m,direction:"asc"})},L=async m=>{(await C.fire({title:"Delete this student?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes"})).isConfirmed&&(await f.delete(`/students/${m}`),await o(),C.fire({toast:!0,title:"Deleted",icon:"success",position:"top-end",timer:2e3,showConfirmButton:!1}))},G=m=>{F.value=!0,B.value={...m}},D=()=>{F.value=!1,B.value=null};return te(()=>{Y(),o()}),(m,a)=>(r(),K(le,{fullname:v.value,userLevel:p.value,title:`Students – ${Q(E)}`},{default:q(()=>[e("div",Me,[e("div",Ue,[a[7]||(a[7]=e("label",{class:"mr-2"},"Show",-1)),b(e("select",{"onUpdate:modelValue":a[0]||(a[0]=l=>x.value=l),onChange:I,class:"border py-1 rounded"},[(r(),u(S,null,$([10,25,50,100],l=>e("option",{key:l,value:l},i(l),9,Fe)),64))],544),[[j,x.value]]),a[8]||(a[8]=e("span",{class:"ml-2"},"entries",-1))]),e("div",Te,[b(e("input",{"onUpdate:modelValue":a[1]||(a[1]=l=>g.value=l),onInput:I,type:"text",placeholder:"Search students...",class:"border px-3 py-1 rounded w-full md:w-64"},null,544),[[M,g.value]]),p.value!=="registrar"?(r(),K(Ve,{key:0,course:Q(E),class:"ml-4",onSubmitted:o,editMode:F.value,studentToEdit:B.value,onCancelEdit:D},null,8,["course","editMode","studentToEdit"])):k("",!0)])]),e("div",Be,[e("div",Ne,[e("table",Ie,[e("thead",Le,[e("tr",null,[(r(),u(S,null,$(P,l=>e("th",{key:l.key,class:"px-4 py-2 text-center cursor-pointer",onClick:w=>z(l.key)},[N(i(l.label)+" ",1),y.value.find(w=>w.key===l.key)?(r(),u("span",qe,i(y.value.find(w=>w.key===l.key).direction==="asc"?"▲":"▼"),1)):k("",!0)],8,De)),64)),p.value!=="registrar"?(r(),u("th",Ae,"Actions")):k("",!0)])]),e("tbody",null,[(r(!0),u(S,null,$(T.value,l=>(r(),u("tr",{key:l.id,class:"hover:bg-gray-100"},[e("td",Pe,i(l.studid),1),e("td",Ye,i(l.fname)+" "+i(l.lname),1),e("td",ze,i(l.gender),1),e("td",Ge,i(l.year),1),p.value!=="registrar"?(r(),u("td",Oe,[e("button",{onClick:w=>G(l),class:"text-blue-600 hover:underline"},"Edit",8,He),e("button",{onClick:w=>L(l.id),class:"text-red-600 hover:underline"},"Delete",8,Re)])):k("",!0)]))),128)),T.value.length===0?(r(),u("tr",Je,a[9]||(a[9]=[e("td",{colspan:"5",class:"text-center py-4"},"No students found.",-1)]))):k("",!0)])]),e("div",Ke,[e("div",null,[a[10]||(a[10]=N(" Showing ")),e("span",Qe,i(T.value.length?(c.value-1)*x.value+1:0),1),a[11]||(a[11]=N(" to ")),e("span",We,i((c.value-1)*x.value+T.value.length),1),a[12]||(a[12]=N(" of ")),e("span",Xe,i(_.value.length),1),a[13]||(a[13]=N(" entries "))]),e("div",Ze,[e("button",{onClick:a[2]||(a[2]=l=>y.value=[]),class:"text-sm hover:bg-mccblue px-2 py-1 rounded transition"}," Clear Sorting "),e("button",{onClick:a[3]||(a[3]=l=>c.value=c.value-1),disabled:c.value===1,class:"px-3 py-1 border-0 rounded disabled:opacity-50 disabled:hover:bg-mcclightblue hover:bg-mccblue transition"}," Prev ",8,et),V.value<=10?(r(!0),u(S,{key:0},$(V.value,l=>(r(),u("button",{key:l,onClick:w=>c.value=l,class:se(["px-3 py-1 border-0 rounded",c.value===l?"bg-white text-mccblue font-bold":"hover:bg-mccblue transition"])},i(l),11,tt))),128)):b((r(),u("select",{key:1,"onUpdate:modelValue":a[4]||(a[4]=l=>c.value=l),onChange:a[5]||(a[5]=l=>c.value=parseInt(l.target.value)),class:"bg-white text-mccblue py-[0.5px] rounded border-none"},[(r(!0),u(S,null,$(V.value,l=>(r(),u("option",{key:l,value:l},i(l),9,st))),128))],544)),[[j,c.value]]),e("button",{onClick:a[6]||(a[6]=l=>c.value=c.value+1),disabled:c.value===V.value,class:"px-3 py-1 border-0 rounded disabled:opacity-50 disabled:hover:bg-mcclightblue hover:bg-mccblue transition"}," Next ",8,lt)])])])])]),_:1},8,["fullname","userLevel","title"]))}};export{ut as default};
