import{r as p,q as Je,o as Xe,E as kt,c as ce,N as qt,L as $e,g as c,d as b,e as a,k as W,t as i,u as qe,i as y,n as d,F,h as I,f as z,j as h,a as ee,$ as k,p as q}from"./app-CvgGXEGl.js";import{S as M}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as Ct}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Et={class:"p-6 bg-whitebg"},St={class:"mb-3 border rounded bg-gray-100 px-4 py-2 flex items-center justify-between text-sm"},_t={class:"flex flex-wrap gap-x-6 gap-y-1"},At={class:"flex items-center gap-2 relative"},Nt={key:0},Ft={key:1},It={key:2},Ut={key:3},$t={class:"relative"},Mt={key:0,class:"absolute right-0 mt-1 w-36 bg-white border shadow z-50"},Rt={class:"relative"},Vt={key:0,class:"absolute right-0 mt-1 w-40 bg-white border shadow z-50"},Tt={key:0,class:"min-w-full border-collapse text-xs"},Gt=["colspan"],Pt=["disabled"],Qt=["colspan"],Bt=["disabled"],Lt=["onUpdate:modelValue","disabled"],Dt={class:"border p-1 bg-gray-300 text-center font-semibold sticky top-8 z-30"},Ht=["onUpdate:modelValue","disabled"],Kt={class:"border p-1 bg-gray-300 text-center font-semibold sticky top-8 z-30"},Ot=["disabled"],jt=["disabled"],Yt=["disabled"],Zt={class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},Jt={key:0},Xt=["colspan"],Wt={class:"border-none p-1 text-center bg-white"},er={class:"border-none p-1 sticky left-0 bg-white z-40 w-36"},tr={class:"border-none p-1 sticky left-20 bg-white z-40 w-3"},rr={class:"border-none p-1 sticky left-40 bg-white z-40 w-36"},ar={key:0,class:"ml-1 px-1 text-xs bg-red-100 text-red-600 rounded"},or=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],nr={class:"border p-1 text-center font-semibold bg-gray-200"},sr={class:"border p-1 text-center font-semibold bg-gray-200"},lr={class:"border p-1 text-center font-semibold bg-gray-200"},ur=["onUpdate:modelValue","disabled","onInput","data-row","data-col","onKeydown"],ir={class:"border p-1 text-center font-semibold bg-gray-200"},dr={class:"border p-1 text-center font-semibold bg-gray-200"},cr={class:"border p-1 text-center font-semibold bg-gray-200"},br=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],pr={class:"border p-1 text-center font-semibold bg-gray-200"},mr={class:"border p-1 text-center font-semibold bg-gray-200"},vr=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],gr=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],fr={class:"border p-1 text-center font-semibold bg-gray-200"},yr={class:"border p-1 text-center font-semibold bg-gray-200"},xr={class:"border p-1 text-center font-semibold bg-gray-200"},wr={class:"border p-1 text-center font-semibold bg-gray-200"},zr={class:"border p-1 text-center font-semibold bg-gray-200"},hr={key:1,class:"min-w-full border-collapse text-xs"},kr=["colspan"],qr=["disabled"],Cr=["colspan"],Er=["disabled"],Sr=["onUpdate:modelValue","disabled"],_r={class:"border p-1 bg-gray-300 text-center font-semibold sticky top-8 z-30"},Ar=["onUpdate:modelValue","disabled"],Nr={class:"border p-1 bg-gray-300 text-center font-semibold sticky top-8 z-30"},Fr=["disabled"],Ir=["disabled"],Ur={key:0},$r=["colspan"],Mr={class:"border-none p-1 text-center bg-white"},Rr={class:"border-none p-1 sticky left-0 bg-white z-40 w-36"},Vr={class:"border-none p-1 sticky left-20 bg-white z-40 w-36"},Tr={class:"border-none p-1 sticky left-40 bg-white z-40 w-36"},Gr=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],Pr={class:"border p-1 text-center font-semibold bg-gray-200"},Qr={class:"border p-1 text-center font-semibold bg-gray-200"},Br={class:"border p-1 text-center font-semibold bg-gray-200"},Lr=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],Dr={class:"border p-1 text-center font-semibold bg-gray-200"},Hr={class:"border p-1 text-center font-semibold bg-gray-200"},Kr={class:"border p-1 text-center font-semibold bg-gray-200"},Or=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],jr={class:"border p-1 text-center font-semibold bg-gray-200"},Yr={class:"border p-1 text-center font-semibold bg-gray-200"},Zr=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],Jr={class:"border p-1 text-center font-semibold bg-gray-200"},Xr={class:"border p-1 text-center font-semibold bg-gray-200"},Wr={class:"border p-1 text-center font-semibold bg-gray-200"},ea={class:"border p-1 text-center font-semibold bg-gray-200"},ta={class:"border p-1 text-center font-semibold bg-gray-200"},ra={class:"border p-1 text-center font-semibold bg-gray-200"},aa={class:"border p-1 text-center font-semibold bg-gray-200"},oa={__name:"GradeEntry",setup(na){const P=p("midterm"),o=p(!1),We=p(!1),C=Je({midterm:!1,finals:!1}),U=Je({midterm:!1,finals:!1}),E=p("idle"),Me=p(!1),xe=p(new Map),Ce=p(null),be=p(!1),pe=p(!1),Ee=p(null),et=()=>{be.value=!1,pe.value=!1},Re=t=>{Ee.value&&(Ee.value.contains(t.target)||et())};Xe(()=>{document.addEventListener("click",Re)}),kt(()=>{document.removeEventListener("click",Re)});const tt=()=>{be.value=!be.value,pe.value=!1},rt=()=>{pe.value=!pe.value,be.value=!1},B=(t,e,r,s)=>{var u,_;const n=s==="final"?"finals":"midterm";if(!C[n]||U[n]||o.value){E.value="idle",Me[n]||(Me[n]=!0,M.fire({toast:!1,position:"center",icon:"info",title:`Autosave for ${n} will start after you click Save`,text:"Please set number of quizzes and attendances, enter their highest scores, and then click Save to enable autosave.",showConfirmButton:!0}));return}const l=`${s}-${t.studid}-${e}-${r}`;xe.value.set(l,{teacher_username:X.value,subject_code:L,course:D,year:H,section:K,ay_id:J.value.id,term:s,student_id:t.studid,component_type:e,component_index:r,score:e==="quiz"?(u=t.quizzes)==null?void 0:u[r-1]:e==="attendance"?(_=t.attendance)==null?void 0:_[r-1]:e==="performance"?t.performance:e==="exam"?s==="midterm"?r===1?t.prelimScore:t.midtermScore:t.finalExam:null}),E.value="waiting",Ce.value&&clearTimeout(Ce.value),Ce.value=setTimeout(at,5e3)},at=async()=>{if(xe.value.size!==0){E.value="saving";try{const t=Array.from(xe.value.values());await ee.post("/grades/autosave",{teacher_username:X.value,subject_code:L,course:D,year:H,section:K,ay_id:J.value.id,changes:t}),xe.value.clear(),E.value="saved",setTimeout(()=>{E.value==="saved"&&(E.value="idle")},2e3)}catch(t){console.error("Autosave failed",t),E.value="error"}}},Ve=ce(()=>4+(m.value+3)+(v.value+3)+3+5+3),{url:ot}=qt(),we=new URLSearchParams(ot.split("?")[1]),L=we.get("subject")||"",D=we.get("course")||"",H=we.get("year")||"",K=we.get("section")||"",me=p(!0),m=p(5),v=p(10),R=p(Array(m.value).fill(0)),G=p(Array(v.value).fill(0)),O=p(100),te=p(100),re=p(100),S=p([]),Se=ce(()=>R.value.reduce((t,e)=>t+(Number(e)||0),0)),_e=ce(()=>G.value.reduce((t,e)=>t+(Number(e)||0),0)),Ae=ce(()=>(Number(te.value)||0)+(Number(re.value)||0)),f=p(5),x=p(10),A=p([]),V=p(Array(f.value).fill(0)),T=p(Array(x.value).fill(0)),j=p(100),Y=p(100),Ne=ce(()=>V.value.reduce((t,e)=>t+(Number(e)||0),0)),Fe=ce(()=>T.value.reduce((t,e)=>t+(Number(e)||0),0)),w=(t,e,r,s)=>{const n=e==="midterm"?S.value:A.value;if(!n||!n.length)return;const l=n.length-1;let u=t==="down"?r+1:r-1;if(u<0||u>l)return;const _=`input[data-section="${e}"][data-row="${u}"][data-col="${s}"]`,g=document.querySelector(_);g&&(g.focus(),typeof g.select=="function"&&g.select())},Z=(t,e)=>{const r=Number(t),s=Number(e);return!s||Number.isNaN(s)||t===""||t===null||t===void 0?!1:!Number.isNaN(r)&&r>s},Te=(t,e)=>{var r;return Z((r=t.quizzes)==null?void 0:r[e],R.value[e])},Ge=(t,e)=>{var r;return Z((r=t.attendance)==null?void 0:r[e],G.value[e])},Pe=t=>Z(t.performance,O.value),Qe=t=>Z(t.prelimScore,te.value),Be=t=>Z(t.midtermScore,re.value),Le=(t,e)=>{var r;return Z((r=t.quizzes)==null?void 0:r[e],V.value[e])},De=(t,e)=>{var r;return Z((r=t.attendance)==null?void 0:r[e],T.value[e])},He=t=>Z(t.performance,j.value),Ke=t=>Z(t.finalExam,Y.value),Oe=()=>{for(const t of S.value){for(let e=0;e<m.value;e++)if(Te(t,e))return!0;for(let e=0;e<v.value;e++)if(Ge(t,e))return!0;if(Pe(t)||Qe(t)||Be(t))return!0}return!1},je=()=>{for(const t of A.value){for(let e=0;e<f.value;e++)if(Le(t,e))return!0;for(let e=0;e<x.value;e++)if(De(t,e))return!0;if(He(t)||Ke(t))return!0}return!1};async function ze({typeLabel:t,columnLabel:e,hasHps:r,hasScores:s}){if(!r&&!s)return!0;const n=[];r&&n.push("an HPS value"),s&&n.push("scores entered for at least one student");const l=n.join(" and ");return(await M.fire({title:`Delete ${e}?`,html:`
      <p class="text-sm text-gray-700">
        This ${t.toLowerCase()} already has <b>${l}</b>.<br>
        Deleting it will permanently remove all data in this column.
      </p>
      <p class="mt-2 text-xs text-red-600">
        This action cannot be undone.
      </p>
    `,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete column",cancelButtonText:"Cancel",confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",reverseButtons:!0})).isConfirmed?(await M.fire({title:"Are you absolutely sure?",html:`
      <p class="text-sm text-gray-700">
        All scores and the HPS for <b>${e}</b> will be lost for every student.
      </p>
    `,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete anyway",cancelButtonText:"Go back",confirmButtonColor:"#b91c1c",cancelButtonColor:"#6b7280",reverseButtons:!0})).isConfirmed:!1}const nt=()=>{m.value++,R.value.push(0),S.value.forEach(t=>{t.quizzes.push("")}),U.midterm=!0,C.midterm=!1},st=()=>{v.value++,G.value.push(0),S.value.forEach(t=>{t.attendance.push("")}),U.midterm=!0,C.midterm=!1},lt=async()=>{if(m.value<=1)return;const t=m.value-1,e=!!Number(R.value[t]),r=S.value.some(n=>{var u;const l=(u=n.quizzes)==null?void 0:u[t];return l!==""&&l!==null&&l!==void 0&&!Number.isNaN(Number(l))});await ze({typeLabel:"Quiz column",columnLabel:`Q${m.value}`,hasHps:e,hasScores:r})&&(m.value--,R.value.pop(),S.value.forEach(n=>{n.quizzes.pop()}),U.midterm=!0,C.midterm=!1)},ut=async()=>{if(v.value<=1)return;const t=v.value-1,e=!!Number(G.value[t]),r=S.value.some(n=>{var u;const l=(u=n.attendance)==null?void 0:u[t];return l!==""&&l!==null&&l!==void 0&&!Number.isNaN(Number(l))});await ze({typeLabel:"Attendance column",columnLabel:`A${v.value}`,hasHps:e,hasScores:r})&&(v.value--,G.value.pop(),S.value.forEach(n=>{n.attendance.pop()}),U.midterm=!0,C.midterm=!1)};function ve(t){for(const e in t)if(Array.isArray(t[e]))t[e]=t[e].map(r=>{if(r===""||r===null)return r;const s=Number(r);return Number.isInteger(s)?parseInt(s):s});else if(typeof t[e]=="object"&&t[e]!==null)ve(t[e]);else if(t[e]!==""&&t[e]!==null){const r=Number(t[e]);isNaN(r)||(t[e]=Number.isInteger(r)?parseInt(r):r)}}const it=()=>{f.value++,V.value.push(0),A.value.forEach(t=>{t.quizzes.push("")}),U.finals=!0,C.finals=!1},dt=()=>{x.value++,T.value.push(0),A.value.forEach(t=>{t.attendance.push("")}),U.finals=!0,C.finals=!1},ct=async()=>{if(f.value<=1)return;const t=f.value-1,e=!!Number(V.value[t]),r=A.value.some(n=>{var u;const l=(u=n.quizzes)==null?void 0:u[t];return l!==""&&l!==null&&l!==void 0&&!Number.isNaN(Number(l))});await ze({typeLabel:"Final quiz column",columnLabel:`Q${f.value}`,hasHps:e,hasScores:r})&&(f.value--,V.value.pop(),A.value.forEach(n=>{n.quizzes.pop()}),U.finals=!0,C.finals=!1)},bt=async()=>{if(x.value<=1)return;const t=x.value-1,e=!!Number(T.value[t]),r=A.value.some(n=>{var u;const l=(u=n.attendance)==null?void 0:u[t];return l!==""&&l!==null&&l!==void 0&&!Number.isNaN(Number(l))});await ze({typeLabel:"Final attendance column",columnLabel:`A${x.value}`,hasHps:e,hasScores:r})&&(x.value--,T.value.pop(),A.value.forEach(n=>{n.attendance.pop()}),U.finals=!0,C.finals=!1)},pt=async()=>{var t,e,r,s,n,l,u,_;try{const g=await ee.get("/session?source=gradeentry");if(he.value=g.data.fullname,ue.value=g.data.level,X.value=g.data.username,!he.value||!ue.value||ue.value!=="teacher"){window.location.href="/";return}}catch{window.location.href="/";return}try{const g=`/grades/${encodeURIComponent(L)}/${encodeURIComponent(D)}/${encodeURIComponent(H)}/${encodeURIComponent(K)}`,ge=await ee.get(g,{params:{teacher_username:X.value,ay_id:J.value.id}});o.value=!!ge.data.submitted,C.midterm=!!ge.data.hasComponents,We.value=C.midterm;const N=ge.data;ve(N.gradesData),ve(N.gradeComponents),m.value=N.quizCount??5,v.value=N.attendanceCount??10;const ie=((t=N.gradeComponents)==null?void 0:t.quiz)||{};R.value=Array(m.value).fill(0).map((ne,$)=>ie[$+1]??0);const Q=((e=N.gradeComponents)==null?void 0:e.attendance)||{};G.value=Array(v.value).fill(0).map((ne,$)=>Q[$+1]??0),O.value=((s=(r=N.gradeComponents)==null?void 0:r.performance)==null?void 0:s[1])??0,te.value=((l=(n=N.gradeComponents)==null?void 0:n.exam)==null?void 0:l[1])??0,re.value=((_=(u=N.gradeComponents)==null?void 0:u.exam)==null?void 0:_[2])??0,S.value=N.students.map(ne=>{var de,ae,Ye,Ze;const $=((de=N.gradesData)==null?void 0:de[ne.studid])||{quizzes:[],attendance:[],performance:"",exams:[]},se=((ae=N.summaryGrades)==null?void 0:ae[ne.studid])||{},ke=Array(m.value).fill("").map((ht,fe)=>{var ye;return((ye=$.quizzes)==null?void 0:ye[fe])!==void 0?$.quizzes[fe]:""}),Ue=Array(v.value).fill("").map((ht,fe)=>{var ye;return((ye=$.attendance)==null?void 0:ye[fe])!==void 0?$.attendance[fe]:""});return{...ne,quizzes:ke,attendance:Ue,performance:$.performance??"",prelimScore:((Ye=$.exams)==null?void 0:Ye[0])??"",midtermScore:((Ze=$.exams)==null?void 0:Ze[1])??"",midterm:se.midterm??"",final:se.final??"",overall:se.overall??"",submitted:se.submitted??0,totals:{quiz:0,attendance:0,exam:0},equivs:{quiz:0,attendance:0,performance:0,exam:0},percents:{quiz:0,attendance:0,performance:0,exam:0},midtermGrade:0,equivalent:0,remarks:""}})}catch(g){console.error("Failed to fetch grades:",g)}finally{}},mt=async()=>{var t,e,r,s,n,l;try{const u=await ee.get("/session?source=gradeentry");if(he.value=u.data.fullname,ue.value=u.data.level,X.value=u.data.username,!he.value||!ue.value||ue.value!=="teacher"){window.location.href="/";return}}catch{window.location.href="/";return}try{const u=`/finalgrades/${encodeURIComponent(L)}/${encodeURIComponent(D)}/${encodeURIComponent(H)}/${encodeURIComponent(K)}`,_=await ee.get(u,{params:{teacher_username:X.value,ay_id:J.value.id}});C.finals=Object.keys(_.data.gradeComponents||{}).length>0;const g=_.data;ve(g.gradesData),ve(g.gradeComponents),f.value=g.quizCount??5,x.value=g.attendanceCount??10;const ge=((t=g.gradeComponents)==null?void 0:t.quiz)||{};V.value=Array(f.value).fill(0).map((ie,Q)=>ge[Q+1]??0);const N=((e=g.gradeComponents)==null?void 0:e.attendance)||{};T.value=Array(x.value).fill(0).map((ie,Q)=>N[Q+1]??0),j.value=((s=(r=g.gradeComponents)==null?void 0:r.performance)==null?void 0:s[1])??0,Y.value=((l=(n=g.gradeComponents)==null?void 0:n.exam)==null?void 0:l[1])??0,A.value=g.students.map(ie=>{var se,ke;const Q=((se=g.gradesData)==null?void 0:se[ie.studid])||{quizzes:[],attendance:[],performance:"",exams:[]},ne=Array(f.value).fill("").map((Ue,de)=>{var ae;return((ae=Q.quizzes)==null?void 0:ae[de])??""}),$=Array(x.value).fill("").map((Ue,de)=>{var ae;return((ae=Q.attendance)==null?void 0:ae[de])??""});return{...ie,quizzes:ne,attendance:$,performance:Q.performance??"",finalExam:((ke=Q.exams)==null?void 0:ke[0])??"",totals:{quiz:0,attendance:0,exam:0},equivs:{quiz:0,attendance:0,performance:0,exam:0},percents:{quiz:0,attendance:0,performance:0,exam:0},finalGrade:0,equivalent:0,remarks:"Failed"}})}catch(u){console.error("Failed to fetch final grades:",u)}finally{}};function oe(t){const e=S.value.find(r=>r.studid===t);return e&&e.midtermGrade||0}$e(P,()=>{E.value="idle"});function le(t){return t>94.45?1:t>93.45?1.1:t>92.45?1.2:t>91.45?1.3:t>90.45?1.4:t>89.45?1.5:t>88.45?1.6:t>87.45?1.7:t>86.45?1.8:t>85.45?1.9:t>84.45?2:t>83.45?2.1:t>82.45?2.2:t>81.45?2.3:t>80.45?2.4:t>79.45?2.5:t>78.45?2.6:t>77.45?2.7:t>76.45?2.8:t>75.45?2.9:t>74.45?3:t>73.45?3.1:t>72.45?3.2:t>71.45?3.3:t>70.45?3.4:(t>69.45,3.5)}const vt=()=>{S.value.forEach(t=>{const e=t.quizzes.reduce((u,_)=>u+(Number(_)||0),0);t.totals.quiz=e,t.equivs.quiz=Se.value?e*40/Se.value+60:0,t.percents.quiz=t.equivs.quiz*.3;const r=t.attendance.reduce((u,_)=>u+(Number(_)||0),0);t.totals.attendance=r,t.equivs.attendance=_e.value?r*100/_e.value:0,t.percents.attendance=t.equivs.attendance*.15,t.totals.performance=Number(t.performance)||0,t.equivs.performance=O.value?t.totals.performance*50/O.value+50:0,t.percents.performance=t.equivs.performance*.15;const s=Number(t.prelimScore)||0,n=Number(t.midtermScore)||0,l=s+n;t.totals.exam=l,t.equivs.exam=Ae.value?l*40/Ae.value+60:0,t.percents.exam=t.equivs.exam*.4,t.midtermGrade=(t.percents.quiz||0)+(t.percents.attendance||0)+(t.percents.performance||0)+(t.percents.exam||0),t.equivalent=Number(le(t.midtermGrade).toFixed(1)),t.remarks=t.midtermGrade>=75?"Passed":"Failed"})},gt=()=>{A.value.forEach(t=>{const e=t.quizzes.reduce((n,l)=>n+(Number(l)||0),0);t.totals.quiz=e,t.equivs.quiz=Ne.value?e*40/Ne.value+60:0,t.percents.quiz=t.equivs.quiz*.3;const r=t.attendance.reduce((n,l)=>n+(Number(l)||0),0);t.totals.attendance=r,t.equivs.attendance=Fe.value?r*100/Fe.value:0,t.percents.attendance=t.equivs.attendance*.15,t.totals.performance=Number(t.performance)||0,t.equivs.performance=j.value?t.totals.performance*40/j.value+60:0,t.percents.performance=t.equivs.performance*.15;const s=Number(t.finalExam)||0;t.totals.exam=s,t.equivs.exam=Y.value?s*40/Y.value+60:0,t.percents.exam=t.equivs.exam*.4,t.finalGrade=(t.percents.quiz||0)+(t.percents.attendance||0)+(t.percents.performance||0)+(t.percents.exam||0),t.equivalent=Number(le(t.finalGrade).toFixed(1)),t.remarks=t.finalGrade>=75?"Passed":"Failed"})};$e([S,R,G,O,te,re],vt,{deep:!0,immediate:!0}),$e([A,V,T,j,Y],gt,{deep:!0,immediate:!0});const ft=async()=>{if(Oe()||je()){await M.fire({icon:"error",title:"Scores Exceed HPS",html:`
        <p class="text-sm text-gray-700">
          Some scores are higher than their column HPS.<br>
          Please fix the <span class="font-semibold text-red-600">red-highlighted cells</span> before submitting.
        </p>
      `,confirmButtonColor:"#ef4444"});return}if((await M.fire({title:"Submit Grades?",html:`
      <p class="text-sm text-gray-700">
        Once submitted, <b>grades cannot be edited or modified</b>.<br>
        Are you sure you want to finalize and submit all grades for this class?
      </p>
    `,icon:"warning",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",confirmButtonColor:"#2563eb",cancelButtonColor:"#6b7280",reverseButtons:!0})).isConfirmed)try{await ee.post("/grades/submit",{teacher_username:X.value,subject_code:L,course:D,year:H,section:K,ay_id:J.value.id}),o.value=!0,await M.fire({icon:"success",title:"Grades Submitted!",text:"All grades have been marked as submitted and are now locked.",confirmButtonColor:"#2563eb"})}catch(e){console.error(e),M.fire({icon:"error",title:"Submission Failed!",text:"An error occurred while submitting grades. Please try again later.",confirmButtonColor:"#ef4444"})}finally{me.value=!1}},yt=async()=>{if(Oe()){await M.fire({icon:"error",title:"Scores Exceed HPS",html:`
        <p class="text-sm text-gray-700">
          At least one student has a score that is higher than the HPS for its column.<br>
          Please review the <span class="font-semibold text-red-600">red-highlighted cells</span> before saving.
        </p>
      `,confirmButtonColor:"#ef4444"});return}try{const t=[];R.value.forEach((n,l)=>{t.push({component_type:"quiz",component_index:l+1,hps:Number(n)||0})}),G.value.forEach((n,l)=>{t.push({component_type:"attendance",component_index:l+1,hps:Number(n)||0})}),t.push({component_type:"performance",component_index:1,hps:Number(O.value)||0}),t.push({component_type:"exam",component_index:1,hps:Number(te.value)||0}),t.push({component_type:"exam",component_index:2,hps:Number(re.value)||0});const e=[];S.value.forEach(n=>{n.quizzes.forEach((l,u)=>{e.push({student_id:n.studid,component_type:"quiz",component_index:u+1,score:l})}),n.attendance.forEach((l,u)=>{e.push({student_id:n.studid,component_type:"attendance",component_index:u+1,score:l})}),e.push({student_id:n.studid,component_type:"performance",component_index:1,score:n.performance}),e.push({student_id:n.studid,component_type:"exam",component_index:1,score:n.prelimScore}),e.push({student_id:n.studid,component_type:"exam",component_index:2,score:n.midtermScore})});const r=S.value.map(n=>({student_id:n.studid,midterm:Number(n.equivalent)||0}));await ee.post("/grades/save",{teacher_username:X.value,subject_code:L,course:D,year:H,section:K,ay_id:J.value.id,gradeComponents:t,gradesData:e,gradesSummary:r}),await M.fire({icon:"success",title:"Midterm Grades Saved!",text:"All midterm grades were successfully saved.",confirmButtonColor:"#2563eb"}),C.midterm=!0,U.midterm=!1}catch(t){console.error("Failed to save grades:",t),M.fire({icon:"error",title:"Failed to Save!",text:"There was an error saving midterm grades. Please try again.",confirmButtonColor:"#ef4444"})}},xt=async()=>{if(je()){await M.fire({icon:"error",title:"Scores Exceed HPS",html:`
        <p class="text-sm text-gray-700">
          At least one student has a score that is higher than the HPS for its column.<br>
          Please review the <span class="font-semibold text-red-600">red-highlighted cells</span> before saving.
        </p>
      `,confirmButtonColor:"#ef4444"});return}try{const t=[];V.value.forEach((s,n)=>{t.push({component_type:"quiz",component_index:n+1,hps:Number(s)||0})}),T.value.forEach((s,n)=>{t.push({component_type:"attendance",component_index:n+1,hps:Number(s)||0})}),t.push({component_type:"performance",component_index:1,hps:Number(j.value)||0}),t.push({component_type:"exam",component_index:1,hps:Number(Y.value)||0});const e=[];A.value.forEach(s=>{s.quizzes.forEach((n,l)=>{e.push({student_id:s.studid,component_type:"quiz",component_index:l+1,score:n})}),s.attendance.forEach((n,l)=>{e.push({student_id:s.studid,component_type:"attendance",component_index:l+1,score:n})}),e.push({student_id:s.studid,component_type:"performance",component_index:1,score:s.performance}),e.push({student_id:s.studid,component_type:"exam",component_index:1,score:s.finalExam})});const r=A.value.map(s=>{const n=oe(s.studid),l=le(Number(s.finalGrade))||0,u=(le(n)*.3+l*.7).toFixed(2);return{student_id:s.studid,final:l,overall:u}});await ee.post("/finalgrades/save",{teacher_username:X.value,subject_code:L,course:D,year:H,section:K,ay_id:J.value.id,gradeComponents:t,gradesData:e,gradesSummary:r,term:"final"}),await M.fire({icon:"success",title:"Final Grades Saved!",text:"All final grades were successfully saved.",confirmButtonColor:"#2563eb"}),C.finals=!0,U.finals=!1}catch(t){console.error("Failed to save final grades:",t),M.fire({icon:"error",title:"Save Failed!",text:"There was an error saving final grades. Please try again.",confirmButtonColor:"#ef4444"})}},Ie=p(null);function wt(){Ie.value&&(document.fullscreenElement?document.exitFullscreen():Ie.value.requestFullscreen().catch(t=>{console.error(`Error attempting fullscreen: ${t.message}`)}))}const J=p({id:null,academicyear:"",semester:""}),he=p(""),ue=p(""),X=p(""),zt=async()=>{try{const t=await ee.get("/api/active-ay");t.data&&(J.value=t.data)}catch(t){console.error("Failed to fetch active academic year",t)}};return Xe(async()=>{var t;await zt(),L&&D&&H&&K&&((t=J.value)!=null&&t.id)&&(me.value=!0,await pt(),me.value=!1,await mt())}),(t,e)=>(b(),c("div",Et,[a("div",St,[a("div",_t,[a("div",null,[e[9]||(e[9]=a("strong",null,"Subject:",-1)),W(" "+i(qe(L)),1)]),a("div",null,[e[10]||(e[10]=a("strong",null,"Course:",-1)),W(" "+i(qe(D))+" "+i(qe(H))+" â€“ "+i(qe(K)),1)])]),a("div",At,[a("div",{class:"flex items-center gap-2 relative",ref_key:"toolbarRef",ref:Ee},[E.value!=="idle"?(b(),c("div",{key:0,class:d(["flex items-center gap-2 px-3 py-1 rounded shadow text-sm transition",{"bg-yellow-100 text-yellow-800":E.value==="saving","bg-green-100 text-green-700":E.value==="saved","bg-red-100 text-red-700":E.value==="error"}])},[E.value==="waiting"?(b(),c("span",Nt,"âŒ› Waiting to saveâ€¦")):y("",!0),E.value==="saving"?(b(),c("span",Ft,"ðŸ’¾ Savingâ€¦")):y("",!0),E.value==="saved"?(b(),c("span",It,"âœ… Saved")):y("",!0),E.value==="error"?(b(),c("span",Ut,"âš  Save failed")):y("",!0)],2)):y("",!0),a("div",$t,[a("button",{onClick:tt,class:d(["excel-btn flex items-center gap-1",{"ring-2 ring-blue-400 animate-pulse":P.value==="midterm"?!C.midterm||U.midterm:!C.finals||U.finals}])},e[11]||(e[11]=[W(" Save "),a("span",{class:"text-xs"},"â–¼",-1)]),2),be.value?(b(),c("div",Mt,[a("button",{class:"dropdown-item",onClick:yt}," Save Midterm "),a("button",{class:"dropdown-item",onClick:xt}," Save Finals ")])):y("",!0)]),a("div",Rt,[a("button",{onClick:rt,class:"excel-btn flex items-center gap-1"},e[12]||(e[12]=[W(" Submit "),a("span",{class:"text-xs"},"â–¼",-1)])),pe.value?(b(),c("div",Vt,[a("button",{class:"dropdown-item",onClick:e[0]||(e[0]=(...r)=>t.submitMidterm&&t.submitMidterm(...r))}," Submit Midterm "),a("button",{class:"dropdown-item",onClick:ft}," Submit Finals ")])):y("",!0)])],512),e[13]||(e[13]=a("div",{class:"h-5 w-px bg-gray-300 mx-1"},null,-1)),a("button",{onClick:e[1]||(e[1]=r=>P.value="midterm"),class:d([{"bg-gray-300 text-black":P.value==="midterm","bg-gray-100 text-black hover:bg-gray-200 ":P.value!=="midterm"},"px-3 py-1 border text-md"])}," Midterm ",2),a("button",{onClick:e[2]||(e[2]=r=>P.value="finals"),class:d([{"bg-gray-300 text-black":P.value==="finals","bg-gray-100 text-black hover:bg-gray-200 ":P.value!=="finals"},"px-3 py-1 border text-md"])}," Finals ",2),a("button",{class:"excel-icon-btn border-gray-300",title:"Help",onClick:e[3]||(e[3]=(...r)=>t.openHelpModal&&t.openHelpModal(...r))}," ? "),a("button",{class:"excel-icon-btn border-gray-300",title:"Fullscreen",onClick:wt}," â›¶ ")])]),a("div",{class:"overflow-auto border rounded-lg max-h-[630px] w-full",ref_key:"gradesTable",ref:Ie},[P.value==="midterm"?(b(),c("table",Tt,[a("thead",null,[a("tr",null,[e[16]||(e[16]=a("th",{rowspan:"3",class:"bg-gray-300 border p-2"},"No.",-1)),e[17]||(e[17]=a("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-0 top-0 z-40 w-36"},"LASTNAME",-1)),e[18]||(e[18]=a("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-20 top-0 z-40 w-36"},"FIRSTNAME",-1)),e[19]||(e[19]=a("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-40 top-0 z-40 w-36"},"MIDDLENAME",-1)),a("th",{colspan:m.value+3,class:"bg-gray-300 border p-2"},[e[14]||(e[14]=W(" QUIZZES ")),o.value?y("",!0):(b(),c("button",{key:0,onClick:nt,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Quiz Column"}," + ")),o.value?y("",!0):(b(),c("button",{key:1,onClick:lt,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Quiz Column",disabled:m.value<=1}," - ",8,Pt))],8,Gt),a("th",{colspan:v.value+3,class:"bg-gray-300 border p-2"},[e[15]||(e[15]=W(" ATTENDANCE ")),o.value?y("",!0):(b(),c("button",{key:0,onClick:st,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Attendance Column"}," + ")),o.value?y("",!0):(b(),c("button",{key:1,onClick:ut,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Attendance Column",disabled:v.value<=1}," - ",8,Bt))],8,Qt),e[20]||(e[20]=a("th",{colspan:"3",class:"bg-gray-300 border p-2"},"PERFORMANCE",-1)),e[21]||(e[21]=a("th",{colspan:"5",class:"bg-gray-300 border p-2"},"MAJOR EXAM",-1)),e[22]||(e[22]=a("th",{colspan:"3",class:"bg-gray-300 border p-2"},"PRELIM",-1))]),a("tr",null,[(b(!0),c(F,null,I(m.value,r=>(b(),c("th",{key:"q-label-"+r,class:d(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])}," Q"+i(r),3))),128)),e[23]||(e[23]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[24]||(e[24]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[25]||(e[25]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"30%",-1)),(b(!0),c(F,null,I(v.value,r=>(b(),c("th",{key:"a-label-"+r,class:d(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])}," A"+i(r),3))),128)),e[26]||(e[26]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[27]||(e[27]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[28]||(e[28]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"15%",-1)),a("th",{class:d(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"100",2),e[29]||(e[29]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[30]||(e[30]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"15%",-1)),a("th",{class:d(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"PRELIM SCORE",2),a("th",{class:d(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"MIDTERM SCORE",2),e[31]||(e[31]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[32]||(e[32]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[33]||(e[33]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"40%",-1)),e[34]||(e[34]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"MIDTERM GRADE",-1)),e[35]||(e[35]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIVALENT",-1)),e[36]||(e[36]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"REMARKS",-1))]),a("tr",null,[(b(!0),c(F,null,I(R.value,(r,s)=>(b(),c("td",{key:"hps-quiz-"+s,class:d(["border p-1 bg-blue-200 sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[z(a("input",{"onUpdate:modelValue":n=>R.value[s]=n,type:"number",min:"0",class:d(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,Lt),[[h,R.value[s],void 0,{number:!0}]])],2))),128)),a("td",Dt,i(Se.value.toFixed(0)),1),e[37]||(e[37]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[38]||(e[38]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"30",-1)),(b(!0),c(F,null,I(G.value,(r,s)=>(b(),c("td",{key:"hps-attendance-"+s,class:d(["border p-1 bg-blue-200 sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[z(a("input",{"onUpdate:modelValue":n=>G.value[s]=n,type:"number",min:"0",class:d(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,Ht),[[h,G.value[s],void 0,{number:!0}]])],2))),128)),a("td",Kt,i(_e.value.toFixed(0)),1),e[39]||(e[39]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[40]||(e[40]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"15",-1)),a("td",{class:d(["border p-1 bg-blue-200 text-center sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[z(a("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>O.value=r),type:"number",min:"0",class:d(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,Ot),[[h,O.value,void 0,{number:!0}]])],2),e[41]||(e[41]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[42]||(e[42]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"15",-1)),a("td",{class:d(["border p-1 bg-blue-200 text-center sticky top-8 z-30",{"bg-gray-300 ":o.value,"bg-blue-200":!o.value}])},[z(a("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>te.value=r),type:"number",min:"0",class:d(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,jt),[[h,te.value,void 0,{number:!0}]])],2),a("td",{class:d(["border p-1 bg-blue-200 text-center sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[z(a("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>re.value=r),type:"number",min:"0",class:d(["w-12 border px-1 text-center bg-blue-200 sticky top-8 z-30 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,Yt),[[h,re.value,void 0,{number:!0}]])],2),a("td",Zt,i(Ae.value.toFixed(0)),1),e[43]||(e[43]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[44]||(e[44]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"40",-1)),e[45]||(e[45]=a("td",{colspan:"2",class:"border p-1 bg-gray-300 sticky top-8 z-30"},null,-1)),e[46]||(e[46]=a("td",{colspan:"1",class:"border p-1 bg-gray-300 sticky top-8 z-30"},null,-1))])]),a("tbody",null,[me.value?(b(),c("tr",Jt,[a("td",{colspan:Ve.value,class:"text-center p-4"},"Loading student data...",8,Xt)])):y("",!0),(b(!0),c(F,null,I(S.value,(r,s)=>(b(),c("tr",{key:r.id},[a("td",Wt,i(s+1),1),a("td",er,i(r.lname),1),a("td",tr,i(r.fname),1),a("td",rr,[W(i(r.mname)+" ",1),r.is_irregular?(b(),c("span",ar," IRREG ")):y("",!0)]),(b(!0),c(F,null,I(r.quizzes,(n,l)=>(b(),c("td",{key:"quiz-"+s+"-"+l,class:d(["border p-1",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[z(a("input",{"onUpdate:modelValue":u=>r.quizzes[l]=u,type:"number",min:"0",max:R.value[l]||100,disabled:o.value,onInput:u=>B(r,"quiz",l+1,"midterm"),"data-section":"midterm","data-row":s,"data-col":l,onKeydown:[k(q(u=>w("down","midterm",s,l),["prevent"]),["enter"]),k(q(u=>w("up","midterm",s,l),["shift","prevent"]),["enter"])],class:d(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Te(r,l)?"bg-red-200 border-red-500 text-red-800":""])},null,42,or),[[h,r.quizzes[l],void 0,{number:!0}]])],2))),128)),a("td",nr,i(r.totals.quiz.toFixed(0)),1),a("td",sr,i(r.equivs.quiz.toFixed(0)),1),a("td",lr,i(r.percents.quiz.toFixed(0)),1),(b(!0),c(F,null,I(r.attendance,(n,l)=>(b(),c("td",{key:"att-"+s+"-"+l,class:d(["border p-1 bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[z(a("input",{"onUpdate:modelValue":u=>r.attendance[l]=u,type:"number",disabled:o.value,onInput:u=>B(r,"attendance",l+1,"midterm"),"data-section":"midterm","data-row":s,"data-col":m.value+l,onKeydown:[k(q(u=>w("down","midterm",s,m.value+l),["prevent"]),["enter"]),k(q(u=>w("up","midterm",s,m.value+l),["shift","prevent"]),["enter"])],class:d(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Ge(r,l)?"bg-red-200 border-red-500 text-red-800":""])},null,42,ur),[[h,r.attendance[l],void 0,{number:!0}]])],2))),128)),a("td",ir,i(r.totals.attendance.toFixed(0)),1),a("td",dr,i(r.equivs.attendance.toFixed(0)),1),a("td",cr,i(r.percents.attendance.toFixed(0)),1),a("td",{class:d(["border p-1 text-center bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[z(a("input",{"onUpdate:modelValue":n=>r.performance=n,type:"number",min:"0",max:O.value,disabled:o.value,onInput:n=>B(r,"performance",1,"midterm"),"data-section":"midterm","data-row":s,"data-col":m.value+v.value,onKeydown:[k(q(n=>w("down","midterm",s,m.value+v.value),["prevent"]),["enter"]),k(q(n=>w("up","midterm",s,m.value+v.value),["shift","prevent"]),["enter"])],class:d(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Pe(r)?"bg-red-200 border-red-500 text-red-800":""])},null,42,br),[[h,r.performance,void 0,{number:!0}]])],2),a("td",pr,i(r.equivs.performance.toFixed(0)),1),a("td",mr,i(r.percents.performance.toFixed(0)),1),a("td",{class:d(["border p-1 text-center bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[z(a("input",{"onUpdate:modelValue":n=>r.prelimScore=n,type:"number",min:"0",max:te.value,disabled:o.value,onInput:n=>B(r,"exam",1,"midterm"),"data-section":"midterm","data-row":s,"data-col":m.value+v.value+1,onKeydown:[k(q(n=>w("down","midterm",s,m.value+v.value+1),["prevent"]),["enter"]),k(q(n=>w("up","midterm",s,m.value+v.value+1),["shift","prevent"]),["enter"])],class:d(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Qe(r)?"bg-red-200 border-red-500 text-red-800":""])},null,42,vr),[[h,r.prelimScore,void 0,{number:!0}]])],2),a("td",{class:d(["border p-1 text-center bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[z(a("input",{"onUpdate:modelValue":n=>r.midtermScore=n,type:"number",min:"0",max:re.value,disabled:o.value,onInput:n=>B(r,"exam",2,"midterm"),"data-section":"midterm","data-row":s,"data-col":m.value+v.value+2,onKeydown:[k(q(n=>w("down","midterm",s,m.value+v.value+2),["prevent"]),["enter"]),k(q(n=>w("up","midterm",s,m.value+v.value+2),["shift","prevent"]),["enter"])],class:d(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Be(r)?"bg-red-200 border-red-500 text-red-800":""])},null,42,gr),[[h,r.midtermScore,void 0,{number:!0}]])],2),a("td",fr,i(r.totals.exam.toFixed(0)),1),a("td",yr,i(r.equivs.exam.toFixed(0)),1),a("td",xr,i(r.percents.exam.toFixed(0)),1),a("td",wr,i(r.midtermGrade.toFixed(0)),1),a("td",zr,i(r.equivalent.toFixed(1)),1),a("td",{class:d(["border p-1 text-center font-semibold",{"text-green-700 bg-green-100":r.remarks==="Passed","text-red-700 bg-red-100":r.remarks==="Failed"}])},i(r.remarks),3)]))),128))])])):y("",!0),P.value==="finals"?(b(),c("table",hr,[a("thead",null,[a("tr",null,[e[49]||(e[49]=a("th",{rowspan:"3",class:"bg-gray-300 border p-2"},"No.",-1)),e[50]||(e[50]=a("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-0 top-0 z-40 w-36"},"LASTNAME",-1)),e[51]||(e[51]=a("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-20 top-0 z-40 w-36"},"FIRSTNAME",-1)),e[52]||(e[52]=a("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-40 top-0 z-40 w-36"},"MIDDLENAME",-1)),a("th",{colspan:f.value+3,class:"bg-gray-300 border p-2"},[e[47]||(e[47]=W(" QUIZZES ")),o.value?y("",!0):(b(),c("button",{key:0,onClick:it,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Quiz Column"},"+")),o.value?y("",!0):(b(),c("button",{key:1,onClick:ct,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Quiz Column",disabled:f.value<=1},"-",8,qr))],8,kr),a("th",{colspan:x.value+3,class:"bg-gray-300 border p-2"},[e[48]||(e[48]=W(" ATTENDANCE ")),o.value?y("",!0):(b(),c("button",{key:0,onClick:dt,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Attendance Column"},"+")),o.value?y("",!0):(b(),c("button",{key:1,onClick:bt,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Attendance Column",disabled:x.value<=1},"-",8,Er))],8,Cr),e[53]||(e[53]=a("th",{colspan:"3",class:"bg-gray-300 border p-2"},"PERFORMANCE",-1)),e[54]||(e[54]=a("th",{colspan:"3",class:"bg-gray-300 border p-2"},"MAJOR EXAM",-1)),e[55]||(e[55]=a("th",{colspan:"3",class:"bg-gray-300 border p-2"},"FINAL SUMMARY",-1)),e[56]||(e[56]=a("th",{colspan:"4",class:"bg-gray-300 border p-2"},"MIDTERM REFERENCE",-1))]),a("tr",null,[(b(!0),c(F,null,I(f.value,r=>(b(),c("th",{key:"fq-label-"+r,class:d(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-orange-200":!o.value}])},"Q"+i(r),3))),128)),e[57]||(e[57]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[58]||(e[58]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[59]||(e[59]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"30%",-1)),(b(!0),c(F,null,I(x.value,r=>(b(),c("th",{key:"fa-label-"+r,class:d(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-orange-200":!o.value}])},"A"+i(r),3))),128)),e[60]||(e[60]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[61]||(e[61]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[62]||(e[62]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"15%",-1)),a("th",{class:d(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-orange-200":!o.value}])},"100",2),e[63]||(e[63]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[64]||(e[64]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"15%",-1)),a("th",{class:d(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-orange-200":!o.value}])},"FINAL SCORE",2),e[65]||(e[65]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[66]||(e[66]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"40%",-1)),e[67]||(e[67]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"FINAL GRADE",-1)),e[68]||(e[68]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIVALENT",-1)),e[69]||(e[69]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"REMARKS",-1)),e[70]||(e[70]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"MIDTERM GRADE",-1)),e[71]||(e[71]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"FINAL RATING",-1)),e[72]||(e[72]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIVALENT",-1)),e[73]||(e[73]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"REMARKS",-1))]),a("tr",null,[(b(!0),c(F,null,I(V.value,(r,s)=>(b(),c("td",{key:"fhps-quiz-"+s,class:d(["border p-1 bg-orange-200 sticky top-8 z-30",{"bg-gray-300":o.value,"bg-orange-200":!o.value}])},[z(a("input",{"onUpdate:modelValue":n=>V.value[s]=n,type:"number",min:"0",class:d(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-orange-200":!o.value}]),disabled:o.value},null,10,Sr),[[h,V.value[s],void 0,{number:!0}]])],2))),128)),a("td",_r,i(Ne.value.toFixed(0)),1),e[74]||(e[74]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[75]||(e[75]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"30",-1)),(b(!0),c(F,null,I(T.value,(r,s)=>(b(),c("td",{key:"fhps-att-"+s,class:d(["border p-1 bg-orange-200 sticky top-8 z-30",{"bg-gray-300":o.value,"bg-orange-200":!o.value}])},[z(a("input",{"onUpdate:modelValue":n=>T.value[s]=n,type:"number",min:"0",class:d(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-orange-200":!o.value}]),disabled:o.value},null,10,Ar),[[h,T.value[s],void 0,{number:!0}]])],2))),128)),a("td",Nr,i(Fe.value.toFixed(0)),1),e[76]||(e[76]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[77]||(e[77]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"15",-1)),a("td",{class:d(["border p-1 bg-orange-200 text-center sticky top-8 z-30",{"bg-gray-300":o.value,"bg-orange-200":!o.value}])},[z(a("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>j.value=r),type:"number",min:"0",class:d(["w-12 border px-1 text-center bg-orange-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-orange-200":!o.value}]),disabled:o.value},null,10,Fr),[[h,j.value,void 0,{number:!0}]])],2),e[78]||(e[78]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[79]||(e[79]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"15",-1)),a("td",{class:d(["border p-1 bg-orange-200 text-center sticky top-8 z-30",{"bg-gray-300":o.value,"bg-orange-200":!o.value}])},[z(a("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>Y.value=r),type:"number",min:"0",class:d(["w-12 border px-1 text-center bg-orange-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-orange-200":!o.value}]),disabled:o.value},null,10,Ir),[[h,Y.value,void 0,{number:!0}]])],2),e[80]||(e[80]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[81]||(e[81]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"40",-1)),e[82]||(e[82]=a("td",{colspan:"7",class:"border p-1 bg-gray-300 sticky top-8 z-30"},null,-1))])]),a("tbody",null,[me.value?(b(),c("tr",Ur,[a("td",{colspan:Ve.value,class:"text-center p-4"},"Loading student data...",8,$r)])):y("",!0),(b(!0),c(F,null,I(A.value,(r,s)=>(b(),c("tr",{key:r.id},[a("td",Mr,i(s+1),1),a("td",Rr,i(r.lname),1),a("td",Vr,i(r.fname),1),a("td",Tr,i(r.mname),1),(b(!0),c(F,null,I(r.quizzes,(n,l)=>(b(),c("td",{key:"fquiz-"+s+"-"+l,class:d(["border p-1 bg-orange-100",{"bg-gray-200":o.value,"bg-orange-100":!o.value}])},[z(a("input",{"onUpdate:modelValue":u=>r.quizzes[l]=u,type:"number",min:"0",max:V.value[l]||100,disabled:o.value,onInput:u=>B(r,"quiz",l+1,"final"),"data-section":"finals","data-row":s,"data-col":l,onKeydown:[k(q(u=>w("down","finals",s,l),["prevent"]),["enter"]),k(q(u=>w("up","finals",s,l),["shift","prevent"]),["enter"])],class:d(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-orange-100",Le(r,l)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Gr),[[h,r.quizzes[l],void 0,{number:!0}]])],2))),128)),a("td",Pr,i(r.totals.quiz.toFixed(0)),1),a("td",Qr,i(r.equivs.quiz.toFixed(0)),1),a("td",Br,i(r.percents.quiz.toFixed(0)),1),(b(!0),c(F,null,I(r.attendance,(n,l)=>(b(),c("td",{key:"fatt-"+s+"-"+l,class:d(["border p-1 bg-orange-100",{"bg-gray-200":o.value,"bg-orange-100":!o.value}])},[z(a("input",{"onUpdate:modelValue":u=>r.attendance[l]=u,type:"number",min:"0",max:T.value[l]||1,disabled:o.value,onInput:u=>B(r,"attendance",l+1,"final"),"data-section":"finals","data-row":s,"data-col":f.value+l,onKeydown:[k(q(u=>w("down","finals",s,f.value+l),["prevent"]),["enter"]),k(q(u=>w("up","finals",s,f.value+l),["shift","prevent"]),["enter"])],class:d(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-orange-100",De(r,l)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Lr),[[h,r.attendance[l],void 0,{number:!0}]])],2))),128)),a("td",Dr,i(r.totals.attendance.toFixed(0)),1),a("td",Hr,i(r.equivs.attendance.toFixed(0)),1),a("td",Kr,i(r.percents.attendance.toFixed(0)),1),a("td",{class:d(["border p-1 text-center bg-orange-100",{"bg-gray-200":o.value,"bg-orange-100":!o.value}])},[z(a("input",{"onUpdate:modelValue":n=>r.performance=n,type:"number",min:"0",max:j.value,disabled:o.value,onInput:n=>B(r,"performance",1,"final"),"data-section":"finals","data-row":s,"data-col":f.value+x.value,onKeydown:[k(q(n=>w("down","finals",s,f.value+x.value),["prevent"]),["enter"]),k(q(n=>w("up","finals",s,f.value+x.value),["shift","prevent"]),["enter"])],class:d(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-orange-100",He(r)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Or),[[h,r.performance,void 0,{number:!0}]])],2),a("td",jr,i(r.equivs.performance.toFixed(0)),1),a("td",Yr,i(r.percents.performance.toFixed(0)),1),a("td",{class:d(["border p-1 text-center bg-orange-100",{"bg-gray-200":o.value,"bg-orange-100":!o.value}])},[z(a("input",{"onUpdate:modelValue":n=>r.finalExam=n,type:"number",min:"0",max:Y.value,disabled:o.value,onInput:n=>B(r,"exam",1,"final"),"data-section":"finals","data-row":s,"data-col":f.value+x.value+1,onKeydown:[k(q(n=>w("down","finals",s,f.value+x.value+1),["prevent"]),["enter"]),k(q(n=>w("up","finals",s,f.value+x.value+1),["shift","prevent"]),["enter"])],class:d(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-orange-100",Ke(r)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Zr),[[h,r.finalExam,void 0,{number:!0}]])],2),a("td",Jr,i(r.equivs.exam.toFixed(0)),1),a("td",Xr,i(r.percents.exam.toFixed(0)),1),a("td",Wr,i(r.finalGrade.toFixed(0)),1),a("td",ea,i(r.equivalent.toFixed(1)),1),a("td",{class:d(["border p-1 text-center font-semibold bg-gray-200",{"text-green-700 bg-green-100":r.remarks==="Passed","text-red-700 bg-red-100":r.remarks==="Failed"}])},i(r.remarks),3),a("td",ta,i(oe(r.studid).toFixed(0)),1),a("td",ra,i((oe(r.studid)*.3+r.finalGrade*.7).toFixed(0)),1),a("td",aa,i((le(oe(r.studid))*.3+le(r.finalGrade)*.7).toFixed(1)),1),a("td",{class:d(["border p-1 text-center font-semibold bg-gray-200",{"text-green-700 bg-green-100":oe(r.studid)*.3+r.finalGrade*.7>=75,"text-red-700 bg-red-100":oe(r.studid)*.3+r.finalGrade*.7<75}])},i(oe(r.studid)*.3+r.finalGrade*.7>=75?"Passed":"Failed"),3)]))),128))])])):y("",!0)],512)]))}},ia=Ct(oa,[["__scopeId","data-v-291e67de"]]);export{ia as default};
