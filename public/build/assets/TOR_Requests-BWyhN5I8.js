import{r as p,c as C,o as Z,b as ee,d as r,w as z,e as s,l as te,f as a,g as i,F as f,h as x,t as d,v as S,j as u,k as h,i as T,n as B,T as se,p as le,u as oe,a as _}from"./app-yhYp1Hqu.js";import{_ as ae}from"./DashboardLayout-C90qY3gE.js";import{S as V}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"flex flex-col md:flex-row justify-between select-none items-center p-5"},re={class:"mb-2 md:mb-0"},ue=["value"],ie={class:"flex flex-col md:flex-row gap-2 items-center"},ce={class:"p-4 space-y-6 animate-slide-in-top"},pe={class:"overflow-x-auto rounded-lg border shadow"},ve={class:"min-w-full bg-white text-sm"},me={class:"bg-mcclightblue text-white"},be=["onClick"],ge={key:0},ye={class:"px-4 py-2 text-center"},fe={class:"px-4 py-2 text-center"},xe={class:"px-4 py-2 text-center"},he={class:"px-4 py-2 text-center"},_e={class:"px-4 py-2 text-center"},we={class:"px-4 py-2 text-center select-none"},ke={class:"px-4 py-2 text-center"},Ce=["onClick"],Se={key:0},Ve={class:"flex justify-between bg-mcclightblue items-center px-2 text-sm text-white select-none"},Ue={class:"font-semibold"},Me={class:"font-semibold"},Ne={class:"font-semibold"},Re={class:"flex gap-1 items-center"},Pe=["disabled"],De=["onClick"],je=["disabled"],Fe={key:0,class:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center"},Te={class:"bg-white w-full max-w-4xl p-6 rounded-lg shadow-lg relative animate-fade-in-up max-h-[80vh] overflow-y-auto"},$e={class:"text-xl sm:text-2xl font-bold mb-4 text-mccblue"},Ie={class:"flex gap-2 mb-4"},Le={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ae={class:"grid grid-cols-2 gap-2"},Oe={class:"grid grid-cols-3 gap-2"},ze={class:"grid grid-cols-3 gap-2"},Be=["value"],Ee=["value"],Je=["value"],Ye={class:"flex flex-col items-center"},qe={class:"w-32 max-h-40 bg-gray-100 border-black flex items-center justify-center overflow-hidden mb-2 shrink-0"},Ge=["src"],He={key:1,class:"text-gray-400 text-xs"},Ke={class:"mt-4 space-y-3"},Qe={class:"grid grid-cols-3 gap-2"},We={class:"grid grid-cols-2 gap-2"},Xe={class:"grid grid-cols-2 gap-2"},Ze={__name:"TOR_Requests",setup(et){const U=p(""),M=p(""),E=p(""),$=p([]),N=p(""),m=p([{key:"requested_at",direction:"desc"}]),g=p(10),v=p(1),R=p(!1),y=p({}),l=p({}),n=p({month:"",day:"",year:""}),P=["January","February","March","April","May","June","July","August","September","October","November","December"],J=Array.from({length:80},(o,e)=>new Date().getFullYear()-e),I=C(()=>!n.value.month||!n.value.year?[]:Array.from({length:new Date(n.value.year,n.value.month,0).getDate()},(o,e)=>e+1)),Y=()=>{n.value.day>I.value&&(n.value.day="")},q=[{key:"student_id",label:"Student ID"},{key:"lname",label:"Last Name"},{key:"fname",label:"First Name"},{key:"mname",label:"Middle Name"},{key:"requested_at",label:"Date of Request"},{key:"status",label:"Status"},{key:"actions",label:"Actions"}],L=async()=>{const o=await _.get("/tor-requests/all");$.value=o.data},D=C(()=>[...$.value].sort((e,t)=>{for(const c of m.value){const b=c.key,k=c.direction;if(e[b]<t[b])return k==="asc"?-1:1;if(e[b]>t[b])return k==="asc"?1:-1}return 0}).filter(e=>Object.values(e).join(" ").toLowerCase().includes(N.value.toLowerCase()))),w=C(()=>{const o=(v.value-1)*g.value;return D.value.slice(o,o+g.value)}),A=C(()=>Math.ceil(D.value.length/g.value)),O=()=>{v.value=1},G=o=>{const e=m.value.findIndex(t=>t.key===o);e!==-1?m.value[e].direction=m.value[e].direction==="asc"?"desc":"asc":m.value.push({key:o,direction:"asc"})},H=o=>o?o.charAt(0).toUpperCase()+o.slice(1):"",K=async o=>{y.value=o,l.value={tor_request_id:o.id,student_number:o.student_id,surname:o.lname,firstname:o.fname,middlename:o.mname,sex:o.gender||"",course:o.course||"",dob_month:"",dob_day:"",dob_year:"",place_of_birth:"",civil_status:"",religion:"",citizenship:"",intermediate_sy:"",intermediate_school:"",highschool_sy:"",highschool_school:"",guardian_name:"",home_address:"",date_enrolled:"",picture:""};try{const e=await _.get(`/tor-requests/${o.id}/student-info`);e.data&&Object.keys(e.data).length>0&&(l.value={...l.value,...e.data},l.value.dob_month&&(n.value.month=P.findIndex(t=>t===l.value.dob_month)+1),l.value.dob_day&&(n.value.day=Number(l.value.dob_day)),l.value.dob_year&&(n.value.year=Number(l.value.dob_year)))}catch(e){console.error("Error fetching student info",e)}R.value=!0},j=()=>{R.value=!1},F=async(o,e)=>{try{await _.post(`/tor-requests/${o}/update-status`,{status:e}),L(),V.fire({icon:"success",title:`Status updated to ${e.charAt(0).toUpperCase()+e.slice(1)}`,toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})}catch(t){console.error("Failed to update status",t)}},Q=async()=>{try{if(l.value.dob_month=P[n.value.month-1]||"",l.value.dob_day=n.value.day?String(n.value.day):"",l.value.dob_year=n.value.year?String(n.value.year):"",(await _.post("/tor-requests/save-student-info",l.value)).data.success){const e=route("tor.print",{request_id:y.value.id});window.open(e,"_blank"),j()}}catch(o){console.error("Failed to save student info",o),V.fire("Error","Could not save TOR student info","error")}},W=o=>{const e=o.target.files[0];if(!e)return;if(!["image/jpeg","image/png"].includes(e.type)){V.fire("Invalid File","Please upload only JPEG or PNG images.","warning"),o.target.value="";return}const c=2*1024*1024;if(e.size>c){V.fire("File Too Large","Image must be less than 2 MB.","error"),o.target.value="";return}const b=new FileReader;b.onload=()=>{const k=b.result.split(",")[1];l.value.picture=k},b.readAsDataURL(e)},X=async()=>{try{const o=await _.get("/session");U.value=o.data.fullname,M.value=o.data.level,E.value=o.data.username,(!U.value||!M.value)&&(window.location.href="/")}catch{window.location.href="/"}};return Z(()=>{X(),L()}),(o,e)=>(r(),ee(ae,{fullname:U.value,userLevel:M.value,title:"TOR Requests"},{default:z(()=>[s("div",de,[s("div",re,[e[27]||(e[27]=s("label",{class:"mr-2"},"Show",-1)),a(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),onChange:O,class:"border py-1 rounded"},[(r(),i(f,null,x([10,25,50,100],t=>s("option",{key:t,value:t},d(t),9,ue)),64))],544),[[S,g.value]]),e[28]||(e[28]=s("span",{class:"ml-2"},"entries",-1))]),s("div",ie,[a(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>N.value=t),onInput:O,type:"text",placeholder:"Search requests...",class:"border px-3 py-1 rounded w-full md:w-64"},null,544),[[u,N.value]])])]),s("div",ce,[s("div",pe,[s("table",ve,[s("thead",me,[s("tr",null,[(r(),i(f,null,x(q,t=>s("th",{key:t.key,class:"px-4 py-2 text-center cursor-pointer select-none",onClick:c=>G(t.key)},[h(d(t.label)+" ",1),m.value.find(c=>c.key===t.key)?(r(),i("span",ge,d(m.value.find(c=>c.key===t.key).direction==="asc"?"▲":"▼"),1)):T("",!0)],8,be)),64))])]),s("tbody",null,[(r(!0),i(f,null,x(w.value,t=>(r(),i("tr",{key:t.id,class:"hover:bg-gray-100"},[s("td",ye,d(t.student_id),1),s("td",fe,d(t.lname),1),s("td",xe,d(t.fname),1),s("td",he,d(t.mname),1),s("td",_e,d(new Date(t.requested_at).toLocaleDateString()),1),s("td",we,[s("span",{class:B({"bg-red-100 text-red-500 px-2 py-1 rounded":t.status==="pending","bg-blue-100 text-blue-500 px-2 py-1 rounded":t.status==="processing","bg-green-100 text-green-500 px-2 py-1 rounded":t.status==="completed"})},d(H(t.status)),3)]),s("td",ke,[s("button",{onClick:c=>K(t),class:"bg-mcclightblue text-white px-2 py-1 rounded hover:bg-mccblue transition select-none"}," View ",8,Ce)])]))),128)),w.value.length===0?(r(),i("tr",Se,e[29]||(e[29]=[s("td",{colspan:"7",class:"text-center py-4"},"No TOR requests found.",-1)]))):T("",!0)])]),s("div",Ve,[s("div",null,[e[30]||(e[30]=h(" Showing ")),s("span",Ue,d(w.value.length?(v.value-1)*g.value+1:0),1),e[31]||(e[31]=h(" to ")),s("span",Me,d((v.value-1)*g.value+w.value.length),1),e[32]||(e[32]=h(" of ")),s("span",Ne,d(D.value.length),1),e[33]||(e[33]=h(" entries "))]),s("div",Re,[s("button",{onClick:e[2]||(e[2]=t=>m.value=[]),class:"text-sm hover:bg-mccblue px-2 py-1 rounded transition"}," Clear Sorting "),s("button",{onClick:e[3]||(e[3]=t=>v.value--),disabled:v.value===1,class:"px-3 py-1 rounded disabled:opacity-50 hover:bg-mccblue transition"},"Prev",8,Pe),(r(!0),i(f,null,x(A.value,t=>(r(),i("button",{key:t,onClick:c=>v.value=t,class:B(["px-3 py-1 rounded",v.value===t?"bg-white text-mccblue font-bold":"hover:bg-mccblue transition"])},d(t),11,De))),128)),s("button",{onClick:e[4]||(e[4]=t=>v.value++),disabled:v.value===A.value,class:"px-3 py-1 rounded disabled:opacity-50 hover:bg-mccblue transition"},"Next",8,je)])])])]),te(se,{name:"fade"},{default:z(()=>[R.value?(r(),i("div",Fe,[s("div",Te,[s("h2",$e," TOR Request for "+d(y.value.lname)+", "+d(y.value.fname),1),s("div",Ie,[s("button",{onClick:e[5]||(e[5]=t=>F(y.value.id,"pending")),class:"bg-green-500 text-white px-3 py-1 rounded select-none"}," Mark as Pending "),s("button",{onClick:e[6]||(e[6]=t=>F(y.value.id,"processing")),class:"bg-green-500 text-white px-3 py-1 rounded select-none"}," Mark as Processing "),s("button",{onClick:e[7]||(e[7]=t=>F(y.value.id,"completed")),class:"bg-green-500 text-white px-3 py-1 rounded select-none"}," Mark as Completed ")]),s("div",Le,[s("form",{id:"torForm",onSubmit:le(Q,["prevent"]),class:"space-y-3 md:col-span-2"},[s("div",Ae,[a(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>l.value.student_number=t),placeholder:"Student Number",class:"border p-2 rounded text-sm",readonly:""},null,512),[[u,l.value.student_number]]),a(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>l.value.sex=t),placeholder:"Sex",class:"border p-2 rounded text-sm",readonly:""},null,512),[[u,l.value.sex]])]),s("div",Oe,[a(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>l.value.surname=t),placeholder:"Last Name",class:"border p-2 rounded text-sm",readonly:""},null,512),[[u,l.value.surname]]),a(s("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>l.value.firstname=t),placeholder:"First Name",class:"border p-2 rounded text-sm",readonly:""},null,512),[[u,l.value.firstname]]),a(s("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>l.value.middlename=t),placeholder:"Middle Name",class:"border p-2 rounded text-sm",readonly:""},null,512),[[u,l.value.middlename]])]),s("div",ze,[a(s("select",{"onUpdate:modelValue":e[13]||(e[13]=t=>n.value.month=t),onChange:Y,class:"border p-2 rounded text-sm"},[e[34]||(e[34]=s("option",{disabled:"",value:""},"Month",-1)),(r(),i(f,null,x(P,(t,c)=>s("option",{key:c,value:c+1},d(t),9,Be)),64))],544),[[S,n.value.month]]),a(s("select",{"onUpdate:modelValue":e[14]||(e[14]=t=>n.value.day=t),class:"border p-2 rounded text-sm"},[e[35]||(e[35]=s("option",{disabled:"",value:""},"Day",-1)),(r(!0),i(f,null,x(I.value,t=>(r(),i("option",{key:t,value:t},d(t),9,Ee))),128))],512),[[S,n.value.day]]),a(s("select",{"onUpdate:modelValue":e[15]||(e[15]=t=>n.value.year=t),class:"border p-2 rounded text-sm"},[e[36]||(e[36]=s("option",{disabled:"",value:""},"Year",-1)),(r(!0),i(f,null,x(oe(J),t=>(r(),i("option",{key:t,value:t},d(t),9,Je))),128))],512),[[S,n.value.year]])]),a(s("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>l.value.place_of_birth=t),placeholder:"Place of Birth",class:"border p-2 rounded text-sm w-full"},null,512),[[u,l.value.place_of_birth]])],32),s("div",Ye,[s("div",qe,[l.value.picture?(r(),i("img",{key:0,src:"data:image/jpeg;base64,"+l.value.picture,alt:"Preview",class:"w-full h-full object-cover"},null,8,Ge)):(r(),i("span",He,"No Picture"))]),s("input",{type:"file",onChange:W,accept:"image/png, image/jpeg",class:"text-xs"},null,32)])]),s("div",Ke,[s("div",Qe,[a(s("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>l.value.civil_status=t),placeholder:"Civil Status",class:"border p-2 rounded text-sm"},null,512),[[u,l.value.civil_status]]),a(s("input",{"onUpdate:modelValue":e[18]||(e[18]=t=>l.value.religion=t),placeholder:"Religion",class:"border p-2 rounded text-sm"},null,512),[[u,l.value.religion]]),a(s("input",{"onUpdate:modelValue":e[19]||(e[19]=t=>l.value.citizenship=t),placeholder:"Citizenship",class:"border p-2 rounded text-sm"},null,512),[[u,l.value.citizenship]])]),s("div",We,[a(s("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>l.value.intermediate_school=t),placeholder:"Intermediate School",class:"border p-2 rounded text-sm"},null,512),[[u,l.value.intermediate_school]]),a(s("input",{"onUpdate:modelValue":e[21]||(e[21]=t=>l.value.intermediate_sy=t),placeholder:"SY",class:"border p-2 rounded text-sm"},null,512),[[u,l.value.intermediate_sy]])]),s("div",Xe,[a(s("input",{"onUpdate:modelValue":e[22]||(e[22]=t=>l.value.highschool_school=t),placeholder:"Highschool School",class:"border p-2 rounded text-sm"},null,512),[[u,l.value.highschool_school]]),a(s("input",{"onUpdate:modelValue":e[23]||(e[23]=t=>l.value.highschool_sy=t),placeholder:"SY",class:"border p-2 rounded text-sm"},null,512),[[u,l.value.highschool_sy]])]),a(s("input",{"onUpdate:modelValue":e[24]||(e[24]=t=>l.value.guardian_name=t),placeholder:"Guardian / Parent Name",class:"border p-2 rounded text-sm w-full"},null,512),[[u,l.value.guardian_name]]),a(s("input",{"onUpdate:modelValue":e[25]||(e[25]=t=>l.value.home_address=t),placeholder:"Home Address",class:"border p-2 rounded text-sm w-full"},null,512),[[u,l.value.home_address]]),a(s("input",{"onUpdate:modelValue":e[26]||(e[26]=t=>l.value.date_enrolled=t),placeholder:"Date Enrolled (ex. May 21, 2018)",class:"border p-2 rounded text-sm w-full"},null,512),[[u,l.value.date_enrolled]])]),s("div",{class:"flex justify-between mt-6"},[s("button",{type:"button",onClick:j,class:"px-4 py-2 bg-red-500 text-white rounded"},"Close"),e[37]||(e[37]=s("button",{type:"submit",form:"torForm",class:"px-4 py-2 bg-mccblue text-white rounded hover:bg-mccdarkblue transition"},"Save & Print",-1))]),s("button",{onClick:j,class:"absolute top-4 right-4 text-xl text-gray-600 hover:text-red-500"},"×")])])):T("",!0)]),_:1})]),_:1},8,["fullname","userLevel"]))}},at=ne(Ze,[["__scopeId","data-v-31a697bd"]]);export{at as default};
