import{r as p,c as P,a as E,o as H,b as K,d as r,w as Y,e as s,f as V,g as c,F as w,h as k,t as i,v as j,i as I,j as J,k as _,n as Q}from"./app-DSfOqlHP.js";import{S as x}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as Z}from"./DashboardLayout-6XgNFcSd.js";const ee={class:"flex flex-col md:flex-row justify-between select-none items-center p-5"},te={class:"mb-2 md:mb-0"},se=["value"],ne={class:"flex flex-col md:flex-row gap-2 items-center"},oe={class:"p-4 space-y-6 animate-slide-in-top"},ae={class:"overflow-x-auto rounded-lg border shadow"},le={class:"min-w-full bg-white"},de={class:"bg-mcclightblue text-white"},re=["onClick"],ie={key:0},ce={class:"px-4 py-2 text-center"},ue={class:"px-4 py-2"},ve={class:"px-4 py-2 text-center"},pe={class:"px-4 py-2 text-center"},me={class:"px-4 py-2 text-center"},be={key:0},ge={class:"flex justify-between bg-mcclightblue items-center px-2 text-sm text-white select-none"},fe={class:"font-semibold"},ye={class:"font-semibold"},xe={class:"font-semibold"},he={class:"flex gap-1 items-center"},we=["disabled"],ke=["onClick"],_e=["value"],Ce=["disabled"],Se={__name:"AllStudents",setup(Le){const S=p(""),h=p(""),z=p(""),N=p([]),$=p(""),m=p([{key:"studid",direction:"asc"}]),g=p(10),o=p(1),F=p(!1),A=p(null),O=[{key:"studid",label:"Student ID"},{key:"name",label:"Name"},{key:"gender",label:"Gender"},{key:"course",label:"Course"},{key:"year",label:"Year"}],W=async()=>{try{const d=await E.get("/session");S.value=d.data.fullname,h.value=d.data.level,z.value=d.data.username,(!S.value||!h.value)&&(window.location.href="/")}catch{window.location.href="/"}},U=async()=>{const d=await E.get("/api/allstudents/");N.value=d.data,o.value=1,q()},M=P(()=>[...N.value].sort((t,e)=>{for(const a of m.value){const u=a.key,v=a.direction;if(t[u]<e[u])return v==="asc"?-1:1;if(t[u]>e[u])return v==="asc"?1:-1}return 0}).filter(t=>Object.values(t).join(" ").toLowerCase().includes($.value.toLowerCase()))),C=P(()=>{const d=(o.value-1)*g.value;return M.value.slice(d,d+g.value)}),L=P(()=>Math.ceil(M.value.length/g.value)),T=()=>{o.value=1},R=d=>{const t=m.value.findIndex(e=>e.key===d);t!==-1?m.value[t].direction=m.value[t].direction==="asc"?"desc":"asc":m.value.push({key:d,direction:"asc"})},q=()=>{F.value=!1,A.value=null};E.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const X=()=>{window.location.href="/students/template/export"},G=()=>{const d="/students/template/import";let t=null;x.fire({title:"Import Students",html:`
      <div id="dz"
           class="mt-2 border-2 border-dashed rounded-lg p-6 text-sm
                  bg-white hover:bg-gray-50 transition-colors
                  border-gray-300 text-gray-600">
        <div class="pointer-events-none select-none">
          <div class="font-semibold text-gray-800 mb-1 text-lg">Drag & drop file here</div>
          <div class="text-md opacity-80 mb-3">Accepted: .xlsx, .csv</div>
        </div>
        <div class="items-center gap-2">
          <button id="browseBtn"
                  class="px-4 py-2 rounded bg-mccblue text-white text-md hover:opacity-90">
            Browse
          </button>
          <span id="fileName" class="text-xs"></span>
        </div>
        <input id="fileInput" type="file" accept=".xlsx,.csv" class="hidden" />

        <div id="progressWrap" class="mt-4 hidden">
          <div class="h-2 w-full bg-gray-200 rounded">
            <div id="bar" class="h-2 bg-mccblue rounded" style="width:0%"></div>
          </div>
          <div id="pct" class="text-xs mt-1 text-gray-600">0%</div>
        </div>
      </div>
    `,showCancelButton:!0,confirmButtonText:"Upload",cancelButtonText:"Cancel",confirmButtonColor:"#16a34a",width:600,focusConfirm:!1,allowOutsideClick:()=>!x.isLoading(),didOpen:()=>{const e=document.getElementById("dz"),a=document.getElementById("fileInput"),u=document.getElementById("browseBtn"),v=document.getElementById("fileName"),f=["xlsx","csv"],y=n=>{if(!n)return;const l=(n.name.split(".").pop()||"").toLowerCase();if(!f.includes(l)){t=null,v.textContent="",x.showValidationMessage("Invalid file type. Please upload a .xlsx or .csv file.");return}t=n,v.textContent=`${n.name} (${Math.round(n.size/1024)} KB)`,x.resetValidationMessage()};u.addEventListener("click",()=>a.click()),a.addEventListener("change",n=>{var l;return y((l=n.target.files)==null?void 0:l[0])});const B=n=>{n.preventDefault(),n.stopPropagation()};["dragenter","dragover","dragleave","drop"].forEach(n=>e.addEventListener(n,B)),e.addEventListener("dragenter",()=>e.classList.add("bg-gray-50")),e.addEventListener("dragleave",()=>e.classList.remove("bg-gray-50")),e.addEventListener("drop",n=>{var l,b;e.classList.remove("bg-gray-50"),y((b=(l=n.dataTransfer)==null?void 0:l.files)==null?void 0:b[0])})},preConfirm:async()=>{var f,y,B,n;if(!t)return x.showValidationMessage("Please select a file first."),!1;const e=document.getElementById("progressWrap"),a=document.getElementById("bar"),u=document.getElementById("pct");e.classList.remove("hidden"),a.style.width="0%",u.textContent="0%";const v=new FormData;v.append("file",t);try{return(await E.post(d,v,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:b=>{if(!b.total)return;const D=Math.round(b.loaded/b.total*100);a.style.width=D+"%",u.textContent=D+"%"}})).data}catch(l){const b=((y=(f=l==null?void 0:l.response)==null?void 0:f.data)==null?void 0:y.error)||((n=(B=l==null?void 0:l.response)==null?void 0:B.data)==null?void 0:n.message)||l.message||"Upload failed";return x.showValidationMessage(b),!1}}}).then(async e=>{if(e.isConfirmed&&e.value){const{inserted:a=0,updated:u=0,skipped:v=0,errors:f=[]}=e.value;await x.fire({icon:"success",title:"Import completed",html:`<div class="text-center">
                 <div><b>Inserted:</b> ${a}</div>
                 <div><b>Updated:</b> ${u}</div>
                 <div><b>Skipped:</b> ${v}</div>
                 ${f.length?`<hr class="my-2"/><div class="text-sm max-h-40 overflow-auto">${f.map(y=>`<div>• ${y}</div>`).join("")}</div>`:""}
               </div>`}),await U()}})};return H(()=>{W(),U()}),(d,t)=>(r(),K(Z,{fullname:S.value,userLevel:h.value,title:"All Students"},{default:Y(()=>[s("div",ee,[s("div",te,[t[7]||(t[7]=s("label",{class:"mr-2"},"Show",-1)),V(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),onChange:T,class:"border py-1 rounded"},[(r(),c(w,null,k([10,25,50,100],e=>s("option",{key:e,value:e},i(e),9,se)),64))],544),[[j,g.value]]),t[8]||(t[8]=s("span",{class:"ml-2"},"entries",-1))]),s("div",ne,[h.value!=="registrar"?(r(),c("button",{key:0,onClick:G,class:"bg-mccblue text-white px-3 py-1 rounded hover:bg-mccdarkblue transition"}," Import ")):I("",!0),h.value!=="registrar"?(r(),c("button",{key:1,onClick:X,class:"bg-mccblue text-white px-3 py-1 rounded hover:bg-mccdarkblue transition"}," Export ")):I("",!0),V(s("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>$.value=e),onInput:T,type:"text",placeholder:"Search students...",class:"border px-3 py-1 rounded w-full md:w-64"},null,544),[[J,$.value]])])]),s("div",oe,[s("div",ae,[s("table",le,[s("thead",de,[s("tr",null,[(r(),c(w,null,k(O,e=>s("th",{key:e.key,class:"px-4 py-2 text-center cursor-pointer",onClick:a=>R(e.key)},[_(i(e.label)+" ",1),m.value.find(a=>a.key===e.key)?(r(),c("span",ie,i(m.value.find(a=>a.key===e.key).direction==="asc"?"▲":"▼"),1)):I("",!0)],8,re)),64))])]),s("tbody",null,[(r(!0),c(w,null,k(C.value,e=>(r(),c("tr",{key:e.id,class:"hover:bg-gray-100"},[s("td",ce,i(e.studid),1),s("td",ue,i(e.fname)+" "+i(e.lname),1),s("td",ve,i(e.gender),1),s("td",pe,i(e.course),1),s("td",me,i(e.year),1)]))),128)),C.value.length===0?(r(),c("tr",be,t[9]||(t[9]=[s("td",{colspan:"5",class:"text-center py-4"},"No students found.",-1)]))):I("",!0)])]),s("div",ge,[s("div",null,[t[10]||(t[10]=_(" Showing ")),s("span",fe,i(C.value.length?(o.value-1)*g.value+1:0),1),t[11]||(t[11]=_(" to ")),s("span",ye,i((o.value-1)*g.value+C.value.length),1),t[12]||(t[12]=_(" of ")),s("span",xe,i(M.value.length),1),t[13]||(t[13]=_(" entries "))]),s("div",he,[s("button",{onClick:t[2]||(t[2]=e=>m.value=[]),class:"text-sm hover:bg-mccblue px-2 py-1 rounded transition"}," Clear Sorting "),s("button",{onClick:t[3]||(t[3]=e=>o.value=o.value-1),disabled:o.value===1,class:"px-3 py-1 border-0 rounded disabled:opacity-50 disabled:hover:bg-mcclightblue hover:bg-mccblue transition"}," Prev ",8,we),L.value<=10?(r(!0),c(w,{key:0},k(L.value,e=>(r(),c("button",{key:e,onClick:a=>o.value=e,class:Q(["px-3 py-1 border-0 rounded",o.value===e?"bg-white text-mccblue font-bold":"hover:bg-mccblue transition"])},i(e),11,ke))),128)):V((r(),c("select",{key:1,"onUpdate:modelValue":t[4]||(t[4]=e=>o.value=e),onChange:t[5]||(t[5]=e=>o.value=parseInt(e.target.value)),class:"bg-white text-mccblue py-[0.5px] rounded border-none"},[(r(!0),c(w,null,k(L.value,e=>(r(),c("option",{key:e,value:e},i(e),9,_e))),128))],544)),[[j,o.value]]),s("button",{onClick:t[6]||(t[6]=e=>o.value=o.value+1),disabled:o.value===L.value,class:"px-3 py-1 border-0 rounded disabled:opacity-50 disabled:hover:bg-mcclightblue hover:bg-mccblue transition"}," Next ",8,Ce)])])])])]),_:1},8,["fullname","userLevel"]))}};export{Se as default};
