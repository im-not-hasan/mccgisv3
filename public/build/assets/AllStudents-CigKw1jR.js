import{r as p,c as M,a as B,o as H,b as K,d as r,w as Y,e as s,f as P,g as u,F as h,h as w,t as i,v as D,i as J,j as k,k as j,n as Q}from"./app-DOBgdSPY.js";import{S as y}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as Z}from"./DashboardLayout-BnhVPHV2.js";const ee={class:"flex flex-col md:flex-row justify-between select-none items-center p-5"},te={class:"mb-2 md:mb-0"},se=["value"],ne={class:"flex flex-col md:flex-row gap-2 items-center"},oe={class:"p-4 space-y-6 animate-slide-in-top"},ae={class:"overflow-x-auto rounded-lg border shadow"},le={class:"min-w-full bg-white"},de={class:"bg-mcclightblue text-white"},ie=["onClick"],re={key:0},ce={class:"px-4 py-2 text-center"},ue={class:"px-4 py-2"},ve={class:"px-4 py-2 text-center"},pe={class:"px-4 py-2 text-center"},me={class:"px-4 py-2 text-center"},be={key:0},ge={class:"flex justify-between bg-mcclightblue items-center px-2 text-sm text-white select-none"},fe={class:"font-semibold"},xe={class:"font-semibold"},ye={class:"font-semibold"},he={class:"flex gap-1 items-center"},we=["disabled"],ke=["onClick"],_e=["value"],Ce=["disabled"],Se={__name:"AllStudents",setup(Le){const E=p(""),I=p(""),z=p(""),V=p([]),S=p(""),m=p([{key:"studid",direction:"asc"}]),g=p(10),o=p(1),F=p(!1),A=p(null),O=[{key:"studid",label:"Student ID"},{key:"name",label:"Name"},{key:"gender",label:"Gender"},{key:"course",label:"Course"},{key:"year",label:"Year"}],W=async()=>{try{const d=await B.get("/session");E.value=d.data.fullname,I.value=d.data.level,z.value=d.data.username,(!E.value||!I.value)&&(window.location.href="/")}catch{window.location.href="/"}},N=async()=>{const d=await B.get("/api/allstudents/");V.value=d.data,o.value=1,q()},$=M(()=>[...V.value].sort((t,e)=>{for(const a of m.value){const c=a.key,v=a.direction;if(t[c]<e[c])return v==="asc"?-1:1;if(t[c]>e[c])return v==="asc"?1:-1}return 0}).filter(t=>Object.values(t).join(" ").toLowerCase().includes(S.value.toLowerCase()))),_=M(()=>{const d=(o.value-1)*g.value;return $.value.slice(d,d+g.value)}),C=M(()=>Math.ceil($.value.length/g.value)),U=()=>{o.value=1},R=d=>{const t=m.value.findIndex(e=>e.key===d);t!==-1?m.value[t].direction=m.value[t].direction==="asc"?"desc":"asc":m.value.push({key:d,direction:"asc"})},q=()=>{F.value=!1,A.value=null};B.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const X=()=>{window.location.href="/students/template/export"},G=()=>{const d="/students/template/import";let t=null;y.fire({title:"Import Students",html:`
      <div id="dz"
           class="mt-2 border-2 border-dashed rounded-lg p-6 text-sm
                  bg-white hover:bg-gray-50 transition-colors
                  border-gray-300 text-gray-600">
        <div class="pointer-events-none select-none">
          <div class="font-semibold text-gray-800 mb-1 text-lg">Drag & drop file here</div>
          <div class="text-md opacity-80 mb-3">Accepted: .xlsx, .csv</div>
        </div>
        <div class="items-center gap-2">
          <button id="browseBtn"
                  class="px-4 py-2 rounded bg-mccblue text-white text-md hover:opacity-90">
            Browse
          </button>
          <span id="fileName" class="text-xs"></span>
        </div>
        <input id="fileInput" type="file" accept=".xlsx,.csv" class="hidden" />

        <div id="progressWrap" class="mt-4 hidden">
          <div class="h-2 w-full bg-gray-200 rounded">
            <div id="bar" class="h-2 bg-mccblue rounded" style="width:0%"></div>
          </div>
          <div id="pct" class="text-xs mt-1 text-gray-600">0%</div>
        </div>
      </div>
    `,showCancelButton:!0,confirmButtonText:"Upload",cancelButtonText:"Cancel",confirmButtonColor:"#16a34a",width:600,focusConfirm:!1,allowOutsideClick:()=>!y.isLoading(),didOpen:()=>{const e=document.getElementById("dz"),a=document.getElementById("fileInput"),c=document.getElementById("browseBtn"),v=document.getElementById("fileName"),f=["xlsx","csv"],x=n=>{if(!n)return;const l=(n.name.split(".").pop()||"").toLowerCase();if(!f.includes(l)){t=null,v.textContent="",y.showValidationMessage("Invalid file type. Please upload a .xlsx or .csv file.");return}t=n,v.textContent=`${n.name} (${Math.round(n.size/1024)} KB)`,y.resetValidationMessage()};c.addEventListener("click",()=>a.click()),a.addEventListener("change",n=>{var l;return x((l=n.target.files)==null?void 0:l[0])});const L=n=>{n.preventDefault(),n.stopPropagation()};["dragenter","dragover","dragleave","drop"].forEach(n=>e.addEventListener(n,L)),e.addEventListener("dragenter",()=>e.classList.add("bg-gray-50")),e.addEventListener("dragleave",()=>e.classList.remove("bg-gray-50")),e.addEventListener("drop",n=>{var l,b;e.classList.remove("bg-gray-50"),x((b=(l=n.dataTransfer)==null?void 0:l.files)==null?void 0:b[0])})},preConfirm:async()=>{var f,x,L,n;if(!t)return y.showValidationMessage("Please select a file first."),!1;const e=document.getElementById("progressWrap"),a=document.getElementById("bar"),c=document.getElementById("pct");e.classList.remove("hidden"),a.style.width="0%",c.textContent="0%";const v=new FormData;v.append("file",t);try{return(await B.post(d,v,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:b=>{if(!b.total)return;const T=Math.round(b.loaded/b.total*100);a.style.width=T+"%",c.textContent=T+"%"}})).data}catch(l){const b=((x=(f=l==null?void 0:l.response)==null?void 0:f.data)==null?void 0:x.error)||((n=(L=l==null?void 0:l.response)==null?void 0:L.data)==null?void 0:n.message)||l.message||"Upload failed";return y.showValidationMessage(b),!1}}}).then(async e=>{if(e.isConfirmed&&e.value){const{inserted:a=0,updated:c=0,skipped:v=0,errors:f=[]}=e.value;await y.fire({icon:"success",title:"Import completed",html:`<div class="text-center">
                 <div><b>Inserted:</b> ${a}</div>
                 <div><b>Updated:</b> ${c}</div>
                 <div><b>Skipped:</b> ${v}</div>
                 ${f.length?`<hr class="my-2"/><div class="text-sm max-h-40 overflow-auto">${f.map(x=>`<div>• ${x}</div>`).join("")}</div>`:""}
               </div>`}),await N()}})};return H(()=>{W(),N()}),(d,t)=>(r(),K(Z,{fullname:E.value,userLevel:I.value,title:"All Students"},{default:Y(()=>[s("div",ee,[s("div",te,[t[7]||(t[7]=s("label",{class:"mr-2"},"Show",-1)),P(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),onChange:U,class:"border py-1 rounded"},[(r(),u(h,null,w([10,25,50,100],e=>s("option",{key:e,value:e},i(e),9,se)),64))],544),[[D,g.value]]),t[8]||(t[8]=s("span",{class:"ml-2"},"entries",-1))]),s("div",ne,[s("button",{onClick:G,class:"bg-mccblue text-white px-3 py-1 rounded hover:bg-mccdarkblue transition"}," Import "),s("button",{onClick:X,class:"bg-mccblue text-white px-3 py-1 rounded hover:bg-mccdarkblue transition"}," Export "),P(s("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>S.value=e),onInput:U,type:"text",placeholder:"Search students...",class:"border px-3 py-1 rounded w-full md:w-64"},null,544),[[J,S.value]])])]),s("div",oe,[s("div",ae,[s("table",le,[s("thead",de,[s("tr",null,[(r(),u(h,null,w(O,e=>s("th",{key:e.key,class:"px-4 py-2 text-center cursor-pointer",onClick:a=>R(e.key)},[k(i(e.label)+" ",1),m.value.find(a=>a.key===e.key)?(r(),u("span",re,i(m.value.find(a=>a.key===e.key).direction==="asc"?"▲":"▼"),1)):j("",!0)],8,ie)),64))])]),s("tbody",null,[(r(!0),u(h,null,w(_.value,e=>(r(),u("tr",{key:e.id,class:"hover:bg-gray-100"},[s("td",ce,i(e.studid),1),s("td",ue,i(e.fname)+" "+i(e.lname),1),s("td",ve,i(e.gender),1),s("td",pe,i(e.course),1),s("td",me,i(e.year),1)]))),128)),_.value.length===0?(r(),u("tr",be,t[9]||(t[9]=[s("td",{colspan:"5",class:"text-center py-4"},"No students found.",-1)]))):j("",!0)])]),s("div",ge,[s("div",null,[t[10]||(t[10]=k(" Showing ")),s("span",fe,i(_.value.length?(o.value-1)*g.value+1:0),1),t[11]||(t[11]=k(" to ")),s("span",xe,i((o.value-1)*g.value+_.value.length),1),t[12]||(t[12]=k(" of ")),s("span",ye,i($.value.length),1),t[13]||(t[13]=k(" entries "))]),s("div",he,[s("button",{onClick:t[2]||(t[2]=e=>m.value=[]),class:"text-sm hover:bg-mccblue px-2 py-1 rounded transition"}," Clear Sorting "),s("button",{onClick:t[3]||(t[3]=e=>o.value=o.value-1),disabled:o.value===1,class:"px-3 py-1 border-0 rounded disabled:opacity-50 disabled:hover:bg-mcclightblue hover:bg-mccblue transition"}," Prev ",8,we),C.value<=10?(r(!0),u(h,{key:0},w(C.value,e=>(r(),u("button",{key:e,onClick:a=>o.value=e,class:Q(["px-3 py-1 border-0 rounded",o.value===e?"bg-white text-mccblue font-bold":"hover:bg-mccblue transition"])},i(e),11,ke))),128)):P((r(),u("select",{key:1,"onUpdate:modelValue":t[4]||(t[4]=e=>o.value=e),onChange:t[5]||(t[5]=e=>o.value=parseInt(e.target.value)),class:"bg-white text-mccblue py-[0.5px] rounded border-none"},[(r(!0),u(h,null,w(C.value,e=>(r(),u("option",{key:e,value:e},i(e),9,_e))),128))],544)),[[D,o.value]]),s("button",{onClick:t[6]||(t[6]=e=>o.value=o.value+1),disabled:o.value===C.value,class:"px-3 py-1 border-0 rounded disabled:opacity-50 disabled:hover:bg-mcclightblue hover:bg-mccblue transition"}," Next ",8,Ce)])])])])]),_:1},8,["fullname","userLevel"]))}};export{Se as default};
