import{r as d,L as X,a as f,g as u,d as a,e,l as O,w as A,i as S,t as i,T as H,p as Z,f as b,j as V,F as C,h as $,v as j,N as ee,c as R,o as te,b as K,u as Q,k as N,n as se}from"./app-BzR5gmBy.js";import{S as k}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as oe}from"./DashboardLayout-XlP5Gg7c.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},re={class:"bg-white w-full max-w-3xl p-6 rounded-xl shadow-lg relative animate-fade-in-up"},ae={class:"text-xl font-bold mb-4 text-mccblue select-none text-center"},ue={class:"relative w-full h-[600px] overflow-hidden"},ie={class:"ml-1"},de={class:"ml-1"},ce={class:"ml-1"},me=["value"],ve={class:"ml-1"},be=["value"],fe={class:"ml-1"},pe=["value"],ge={class:"ml-1"},ye={class:"md:col-span-2 flex justify-end gap-4 pt-4"},xe={type:"submit",class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded-md transition"},we={key:0,class:"absolute top-0 left-0 w-full h-full p-4 flex flex-col"},he={class:"flex items-center justify-between mb-4"},ke={class:"text-xl font-bold text-mccblue select-none"},Se={class:"relative mb-4"},Ce={key:0,class:"absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-40 overflow-y-auto"},$e=["onClick"],_e={class:"mb-4 flex-1 overflow-y-auto"},je=["onClick"],Ee={__name:"StudentForm",props:{course:String,editMode:Boolean,studentToEdit:Object},emits:["submitted","cancelEdit"],setup(D,{emit:J}){const E=J,v=D,p=d(!1),h=d(1),T=d([]),g=d([]);d(null);const y=d(""),x=d([]),c=d([]),U=d([]),F=()=>{const o=y.value.toLowerCase();x.value=T.value.filter(t=>t.title.toLowerCase().includes(o))},P=o=>{g.value.some(t=>t.id===o.id)||g.value.push(o),y.value="",x.value=[]},Y=o=>{g.value=g.value.filter(t=>t.id!==o.id)},l=d({studid:"",fname:"",mname:"",lname:"",email:"",course:v.course||"",year:"",section:"",semester:"",ay:"",gender:"",regular:1}),_=()=>{l.value={studid:"",fname:"",mname:"",lname:"",email:"",course:v.course||"",year:"",section:"",semester:"",ay:"",gender:"",regular:1},h.value=1,T.value=[],g.value=[]},B=async()=>{v.editMode||(_(),p.value=!0),await r(),await s()},M=()=>{p.value=!1,_(),E("cancelEdit")};X(()=>v.studentToEdit,async o=>{v.editMode&&o&&(await r(),await s(),l.value={...o},p.value=!0,o.regular==0&&(await L(),await m(o.studid)))},{immediate:!0});const I=async()=>{var o;if(!v.editMode&&await w(l.value.studid)){k.fire("Error","Student ID already exists. Please use a unique ID.","error");return}if(l.value.regular==0&&h.value==1){await L(),h.value=2;return}try{v.editMode&&((o=v.studentToEdit)!=null&&o.id)?(await f.put(`/students/${v.studentToEdit.id}`,l.value),k.fire({icon:"success",title:"Student Updated",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})):(console.log("Form payload:",l.value),await f.post("/students",l.value),k.fire({icon:"success",title:"Student Added",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})),_(),p.value=!1,E("submitted")}catch(t){t.response&&t.response.status===422?(console.error("Validation errors:",t.response.data.errors),k.fire("Validation Error","Please check form fields.","error")):(console.error("Error saving student:",t),k.fire("Error","Could not save student","error"))}},z=()=>{h.value=1},L=async()=>{try{const o=await f.get(`/api/allsubjects/${l.value.course}`);T.value=o.data}catch(o){console.error("Failed to load subjects",o)}},G=async()=>{try{v.editMode?(await f.put(`/students/${v.studentToEdit.id}`,l.value),await f.put(`/api/irregstudentsubject/${l.value.studid}`,{subjects:g.value})):(await f.post("/students",l.value),await f.post("/api/irregstudentsubject",{studid:l.value.studid,subjects:g.value})),k.fire({icon:"success",title:v.editMode?"Student Updated":"Student Added",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1}),_(),p.value=!1,E("submitted")}catch(o){console.error("Error saving irregular subjects:",o),k.fire("Error","Could not save irregular student subjects","error")}},q=()=>{let o=l.value.studid.replace(/\D/g,"");o.length>8&&(o=o.slice(0,8)),o.length>4&&(o=o.slice(0,4)+"-"+o.slice(4)),l.value.studid=o},m=async o=>{try{const t=await f.get(`/api/irregstudentsubject/${o}`);g.value=t.data}catch(t){console.error("Failed to load existing irregular subjects:",t)}},r=async()=>{try{const o=await f.get("/api/sections");c.value=o.data}catch(o){console.error("Failed to fetch sections:",o)}},s=async()=>{try{const o=await f.get("/api/academicyears");U.value=o.data}catch(o){console.error("Failed to fetch academic years:",o)}},w=async o=>{try{return(await f.get(`/api/students/check/${o}`)).data.exists}catch(t){return console.error("Failed to check studid:",t),!1}};return(o,t)=>(a(),u("div",null,[e("button",{onClick:B,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded-lg shadow-md transition"},t[12]||(t[12]=[e("p",{class:"text-xs md:text-base select-none"},"+ Add Student",-1)])),O(H,{name:"fade"},{default:A(()=>[p.value?(a(),u("div",ne,[e("div",re,[h.value===2?(a(),u("button",{key:0,onClick:z,class:"absolute top-4 left-4 text-gray-500 text-lg hover:text-mccblue transition mt-[9px]"}," ← Back ")):S("",!0),e("h2",ae,i(h.value===1?D.editMode?"Edit Student":"Add New Student":"Select Subjects for "+l.value.fname+" "+l.value.lname),1),e("div",ue,[O(H,{name:"slide-left-right"},{default:A(()=>[h.value===1?(a(),u("form",{key:0,onSubmit:Z(I,["prevent"]),class:"absolute top-0 left-0 w-full h-full grid grid-cols-1 md:grid-cols-2 gap-4 overflow-y-auto pr-2"},[e("div",ie,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Student ID",-1)),b(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=n=>l.value.studid=n),onInput:q,placeholder:"e.g. 2024-0001",maxlength:"9",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},null,544),[[V,l.value.studid]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"First Name",-1)),b(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>l.value.fname=n),placeholder:"e.g. Hasan",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},null,512),[[V,l.value.fname]])]),e("div",de,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Middle Name",-1)),b(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>l.value.mname=n),placeholder:"Leave Blank if N/A",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition"},null,512),[[V,l.value.mname]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Last Name",-1)),b(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=n=>l.value.lname=n),placeholder:"e.g. Syed",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},null,512),[[V,l.value.lname]])]),e("div",ce,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Email",-1)),b(e("input",{type:"email","onUpdate:modelValue":t[4]||(t[4]=n=>l.value.email=n),placeholder:"e.g. hasanmangubat@gmail.com",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition"},null,512),[[V,l.value.email]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Year",-1)),b(e("select",{"onUpdate:modelValue":t[5]||(t[5]=n=>l.value.year=n),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},[t[18]||(t[18]=e("option",{value:"",disabled:""},"Select Year",-1)),(a(),u(C,null,$([1,2,3,4],n=>e("option",{key:n,value:n},i(n),9,me)),64))],512),[[j,l.value.year]])]),e("div",ve,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Section",-1)),b(e("select",{"onUpdate:modelValue":t[6]||(t[6]=n=>l.value.section=n),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},[t[20]||(t[20]=e("option",{value:"",disabled:""},"Select Section",-1)),(a(!0),u(C,null,$(c.value,n=>(a(),u("option",{key:n,value:n},i(n),9,be))),128))],512),[[j,l.value.section]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Semester",-1)),b(e("select",{"onUpdate:modelValue":t[7]||(t[7]=n=>l.value.semester=n),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},t[22]||(t[22]=[e("option",{value:"",disabled:""},"Select Semester",-1),e("option",{value:"First Semester"},"First Semester",-1),e("option",{value:"Second Semester"},"Second Semester",-1),e("option",{value:"Summer"},"Summer",-1)]),512),[[j,l.value.semester]])]),e("div",fe,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Academic Year",-1)),b(e("select",{"onUpdate:modelValue":t[8]||(t[8]=n=>l.value.ay=n),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},[t[24]||(t[24]=e("option",{value:"",disabled:""},"Select Academic Year",-1)),(a(!0),u(C,null,$(U.value,n=>(a(),u("option",{key:n,value:n},i(n),9,pe))),128))],512),[[j,l.value.ay]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Gender",-1)),b(e("select",{"onUpdate:modelValue":t[9]||(t[9]=n=>l.value.gender=n),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},t[26]||(t[26]=[e("option",{value:"",disabled:""},"Select Gender",-1),e("option",{value:"Male"},"Male",-1),e("option",{value:"Female"},"Female",-1)]),512),[[j,l.value.gender]])]),e("div",ge,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Student Type",-1)),b(e("select",{"onUpdate:modelValue":t[10]||(t[10]=n=>l.value.regular=n),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition"},t[28]||(t[28]=[e("option",{value:1},"Regular",-1),e("option",{value:0},"Irregular",-1)]),512),[[j,l.value.regular]])]),e("div",ye,[e("button",{type:"button",onClick:M,class:"text-gray-500 hover:text-red-500 transition"}," Cancel "),e("button",xe,i(l.value.regular==0?"Next":"Save"),1)])],32)):S("",!0)]),_:1}),O(H,{name:"slide-left-right"},{default:A(()=>[h.value===2?(a(),u("div",we,[e("div",he,[e("h2",ke,i(l.value.fname)+" "+i(l.value.lname)+" - Subjects",1)]),e("div",Se,[b(e("input",{"onUpdate:modelValue":t[11]||(t[11]=n=>y.value=n),onInput:F,placeholder:"Type to search subject",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition"},null,544),[[V,y.value]]),x.value.length?(a(),u("div",Ce,[(a(!0),u(C,null,$(x.value,n=>(a(),u("div",{key:n.id,onClick:W=>P(n),class:"px-3 py-2 hover:bg-gray-200 text-gray-800 cursor-pointer"},i(n.title),9,$e))),128))])):S("",!0)]),e("ul",_e,[(a(!0),u(C,null,$(g.value,n=>(a(),u("li",{key:n.id,class:"flex justify-between items-center bg-gray-100 text-gray-800 px-3 py-2 mb-2 rounded-md"},[e("span",null,i(n.title),1),e("button",{onClick:W=>Y(n),class:"text-red-500 hover:text-red-700"},"-",8,je)]))),128))]),e("div",{class:"flex justify-end gap-4 mt-auto pt-4"},[e("button",{onClick:G,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded-md transition"}," Save ")])])):S("",!0)]),_:1})]),e("button",{onClick:M,class:"absolute top-4 right-4 text-gray-500 text-2xl hover:text-red-500 transition mt-[6px]"}," × ")])])):S("",!0)]),_:1})]))}},Me=le(Ee,[["__scopeId","data-v-d84a5812"]]),Ve={class:"flex flex-col md:flex-row justify-between select-none items-center p-5"},Te={class:"mb-2 md:mb-0"},Ue=["value"],Be={class:"flex flex-col md:flex-row gap-2 items-center"},Fe={class:"p-4 space-y-6 animate-slide-in-top"},Ne={class:"overflow-x-auto rounded-lg border shadow"},Ie={class:"min-w-full bg-white"},Le={class:"bg-mcclightblue text-white"},qe=["onClick"],Ae={key:0},De={key:0,class:"px-4 py-2 text-center"},Pe={class:"px-4 py-2 text-center"},Ye={class:"px-4 py-2"},ze={class:"px-4 py-2 text-center"},Ge={class:"px-4 py-2 text-center"},Oe={key:0,class:"px-4 py-2 text-center space-x-2"},He=["onClick"],Re=["onClick"],Je={key:0},Ke={class:"flex justify-between bg-mcclightblue items-center px-2 text-sm text-white select-none"},Qe={class:"font-semibold"},We={class:"font-semibold"},Xe={class:"font-semibold"},Ze={class:"flex gap-1 items-center"},et=["disabled"],tt=["onClick"],st=["value"],ot=["disabled"],ut={__name:"CourseStudents",setup(D){const E=ee().props.course,v=d(""),p=d(""),h=d(""),T=d([]),g=d(""),y=d([{key:"studid",direction:"asc"}]),x=d(10),c=d(1),U=d(!1),F=d(null),P=[{key:"studid",label:"Student ID"},{key:"name",label:"Name"},{key:"gender",label:"Gender"},{key:"year",label:"Year"}],Y=async()=>{try{const m=await f.get("/session");v.value=m.data.fullname,p.value=m.data.level,h.value=m.data.username,(!v.value||!p.value)&&(window.location.href="/")}catch{window.location.href="/"}},l=async()=>{const m=await f.get(`/api/students/${E}`);T.value=m.data,c.value=1,q()},_=R(()=>[...T.value].sort((r,s)=>{for(const w of y.value){const o=w.key,t=w.direction;if(r[o]<s[o])return t==="asc"?-1:1;if(r[o]>s[o])return t==="asc"?1:-1}return 0}).filter(r=>Object.values(r).join(" ").toLowerCase().includes(g.value.toLowerCase()))),B=R(()=>{const m=(c.value-1)*x.value;return _.value.slice(m,m+x.value)}),M=R(()=>Math.ceil(_.value.length/x.value)),I=()=>{c.value=1},z=m=>{const r=y.value.findIndex(s=>s.key===m);r!==-1?y.value[r].direction=y.value[r].direction==="asc"?"desc":"asc":y.value.push({key:m,direction:"asc"})},L=async m=>{if((await k.fire({title:"Move to Trash?",text:"Move student record to trash?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#e3342f",cancelButtonColor:"#6c757d",confirmButtonText:"Yes"})).isConfirmed)try{await f.delete(`/students/${m}`),await l(),k.fire({icon:"success",title:"Moved to Trash",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})}catch{k.fire("Error","Could not delete student","error")}},G=m=>{U.value=!0,F.value={...m}},q=()=>{U.value=!1,F.value=null};return te(()=>{Y(),l()}),(m,r)=>(a(),K(oe,{fullname:v.value,userLevel:p.value,title:`Students – ${Q(E)}`},{default:A(()=>[e("div",Ve,[e("div",Te,[r[7]||(r[7]=e("label",{class:"mr-2"},"Show",-1)),b(e("select",{"onUpdate:modelValue":r[0]||(r[0]=s=>x.value=s),onChange:I,class:"border py-1 rounded"},[(a(),u(C,null,$([10,25,50,100],s=>e("option",{key:s,value:s},i(s),9,Ue)),64))],544),[[j,x.value]]),r[8]||(r[8]=e("span",{class:"ml-2"},"entries",-1))]),e("div",Be,[b(e("input",{"onUpdate:modelValue":r[1]||(r[1]=s=>g.value=s),onInput:I,type:"text",placeholder:"Search students...",class:"border px-3 py-1 rounded w-full md:w-64"},null,544),[[V,g.value]]),p.value!=="registrar"?(a(),K(Me,{key:0,course:Q(E),class:"ml-4",onSubmitted:l,editMode:U.value,studentToEdit:F.value,onCancelEdit:q},null,8,["course","editMode","studentToEdit"])):S("",!0)])]),e("div",Fe,[e("div",Ne,[e("table",Ie,[e("thead",Le,[e("tr",null,[(a(),u(C,null,$(P,s=>e("th",{key:s.key,class:"px-4 py-2 text-center cursor-pointer",onClick:w=>z(s.key)},[N(i(s.label)+" ",1),y.value.find(w=>w.key===s.key)?(a(),u("span",Ae,i(y.value.find(w=>w.key===s.key).direction==="asc"?"▲":"▼"),1)):S("",!0)],8,qe)),64)),p.value!=="registrar"?(a(),u("th",De,"Actions")):S("",!0)])]),e("tbody",null,[(a(!0),u(C,null,$(B.value,s=>(a(),u("tr",{key:s.id,class:"hover:bg-gray-100"},[e("td",Pe,i(s.studid),1),e("td",Ye,i(s.fname)+" "+i(s.lname),1),e("td",ze,i(s.gender),1),e("td",Ge,i(s.year),1),p.value!=="registrar"?(a(),u("td",Oe,[e("button",{onClick:w=>G(s),class:"text-blue-600 hover:underline"},"Edit",8,He),e("button",{onClick:w=>L(s.id),class:"text-red-600 hover:underline"},"Delete",8,Re)])):S("",!0)]))),128)),B.value.length===0?(a(),u("tr",Je,r[9]||(r[9]=[e("td",{colspan:"5",class:"text-center py-4"},"No students found.",-1)]))):S("",!0)])]),e("div",Ke,[e("div",null,[r[10]||(r[10]=N(" Showing ")),e("span",Qe,i(B.value.length?(c.value-1)*x.value+1:0),1),r[11]||(r[11]=N(" to ")),e("span",We,i((c.value-1)*x.value+B.value.length),1),r[12]||(r[12]=N(" of ")),e("span",Xe,i(_.value.length),1),r[13]||(r[13]=N(" entries "))]),e("div",Ze,[e("button",{onClick:r[2]||(r[2]=s=>y.value=[]),class:"text-sm hover:bg-mccblue px-2 py-1 rounded transition"}," Clear Sorting "),e("button",{onClick:r[3]||(r[3]=s=>c.value=c.value-1),disabled:c.value===1,class:"px-3 py-1 border-0 rounded disabled:opacity-50 disabled:hover:bg-mcclightblue hover:bg-mccblue transition"}," Prev ",8,et),M.value<=10?(a(!0),u(C,{key:0},$(M.value,s=>(a(),u("button",{key:s,onClick:w=>c.value=s,class:se(["px-3 py-1 border-0 rounded",c.value===s?"bg-white text-mccblue font-bold":"hover:bg-mccblue transition"])},i(s),11,tt))),128)):b((a(),u("select",{key:1,"onUpdate:modelValue":r[4]||(r[4]=s=>c.value=s),onChange:r[5]||(r[5]=s=>c.value=parseInt(s.target.value)),class:"bg-white text-mccblue py-[0.5px] rounded border-none"},[(a(!0),u(C,null,$(M.value,s=>(a(),u("option",{key:s,value:s},i(s),9,st))),128))],544)),[[j,c.value]]),e("button",{onClick:r[6]||(r[6]=s=>c.value=c.value+1),disabled:c.value===M.value,class:"px-3 py-1 border-0 rounded disabled:opacity-50 disabled:hover:bg-mcclightblue hover:bg-mccblue transition"}," Next ",8,ot)])])])])]),_:1},8,["fullname","userLevel","title"]))}};export{ut as default};
