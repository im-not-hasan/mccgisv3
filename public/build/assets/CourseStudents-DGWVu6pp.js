import{r as d,L as W,a as f,g as u,d as r,e,l as q,w as A,k as M,t as i,T as H,p as X,f as v,i as V,F as k,h as S,v as _,N as Z,c as R,o as ee,b as te,u as K,j as N,n as se}from"./app-BvAkt5Y3.js";import{S as $}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as le}from"./DashboardLayout-C2guQ68G.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ae={class:"bg-white w-full max-w-3xl p-6 rounded-xl shadow-lg relative animate-fade-in-up"},re={class:"text-xl font-bold mb-4 text-mccblue select-none text-center"},ue={class:"relative w-full h-[600px] overflow-hidden"},ie={class:"ml-1"},de={class:"ml-1"},ce={class:"ml-1"},me=["value"],be={class:"ml-1"},ve=["value"],fe={class:"ml-1"},pe=["value"],ge={class:"ml-1"},ye={class:"md:col-span-2 flex justify-end gap-4 pt-4"},xe={type:"submit",class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded-md transition"},we={key:0,class:"absolute top-0 left-0 w-full h-full p-4 flex flex-col"},he={class:"flex items-center justify-between mb-4"},ke={class:"text-xl font-bold text-mccblue select-none"},Se={class:"relative mb-4"},$e={key:0,class:"absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-40 overflow-y-auto"},Ce=["onClick"],_e={class:"mb-4 flex-1 overflow-y-auto"},je=["onClick"],Ee={__name:"StudentForm",props:{course:String,editMode:Boolean,studentToEdit:Object},emits:["submitted","cancelEdit"],setup(P,{emit:J}){const j=J,b=P,w=d(!1),h=d(1),U=d([]),p=d([]);d(null);const g=d(""),y=d([]),c=d([]),F=d([]),B=()=>{const s=g.value.toLowerCase();y.value=U.value.filter(t=>t.title.toLowerCase().includes(s))},Y=s=>{p.value.some(t=>t.id===s.id)||p.value.push(s),g.value="",y.value=[]},z=s=>{p.value=p.value.filter(t=>t.id!==s.id)},o=d({studid:"",fname:"",mname:"",lname:"",email:"",course:b.course||"",year:"",section:"",semester:"",ay:"",gender:"",regular:1}),C=()=>{o.value={studid:"",fname:"",mname:"",lname:"",email:"",course:b.course||"",year:"",section:"",semester:"",ay:"",gender:"",regular:1},h.value=1,U.value=[],p.value=[]},T=async()=>{b.editMode||(C(),w.value=!0),await n(),await l()},E=()=>{w.value=!1,C(),j("cancelEdit")};W(()=>b.studentToEdit,async s=>{b.editMode&&s&&(await n(),await l(),o.value={...s},w.value=!0,s.regular==0&&(await L(),await m(s.studid)))},{immediate:!0});const I=async()=>{var s;if(!b.editMode&&await x(o.value.studid)){$.fire("Error","Student ID already exists. Please use a unique ID.","error");return}if(o.value.regular==0&&h.value==1){await L(),h.value=2;return}try{b.editMode&&((s=b.studentToEdit)!=null&&s.id)?(await f.put(`/students/${b.studentToEdit.id}`,o.value),$.fire({icon:"success",title:"Student Updated",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})):(console.log("Form payload:",o.value),await f.post("/students",o.value),$.fire({icon:"success",title:"Student Added",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1})),C(),w.value=!1,j("submitted")}catch(t){t.response&&t.response.status===422?(console.error("Validation errors:",t.response.data.errors),$.fire("Validation Error","Please check form fields.","error")):(console.error("Error saving student:",t),$.fire("Error","Could not save student","error"))}},G=()=>{h.value=1},L=async()=>{try{const s=await f.get(`/api/allsubjects/${o.value.course}`);U.value=s.data}catch(s){console.error("Failed to load subjects",s)}},O=async()=>{try{b.editMode?(await f.put(`/students/${b.studentToEdit.id}`,o.value),await f.put(`/api/irregstudentsubject/${o.value.studid}`,{subjects:p.value})):(await f.post("/students",o.value),await f.post("/api/irregstudentsubject",{studid:o.value.studid,subjects:p.value})),$.fire({icon:"success",title:b.editMode?"Student Updated":"Student Added",toast:!0,position:"top-end",timer:2e3,showConfirmButton:!1}),C(),w.value=!1,j("submitted")}catch(s){console.error("Error saving irregular subjects:",s),$.fire("Error","Could not save irregular student subjects","error")}},D=()=>{let s=o.value.studid.replace(/\D/g,"");s.length>8&&(s=s.slice(0,8)),s.length>4&&(s=s.slice(0,4)+"-"+s.slice(4)),o.value.studid=s},m=async s=>{try{const t=await f.get(`/api/irregstudentsubject/${s}`);p.value=t.data}catch(t){console.error("Failed to load existing irregular subjects:",t)}},n=async()=>{try{const s=await f.get("/api/sections");c.value=s.data}catch(s){console.error("Failed to fetch sections:",s)}},l=async()=>{try{const s=await f.get("/api/academicyears");F.value=s.data}catch(s){console.error("Failed to fetch academic years:",s)}},x=async s=>{try{return(await f.get(`/api/students/check/${s}`)).data.exists}catch(t){return console.error("Failed to check studid:",t),!1}};return(s,t)=>(r(),u("div",null,[e("button",{onClick:T,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded-lg shadow-md transition"},t[12]||(t[12]=[e("p",{class:"text-xs md:text-base select-none"},"+ Add Student",-1)])),q(H,{name:"fade"},{default:A(()=>[w.value?(r(),u("div",ne,[e("div",ae,[h.value===2?(r(),u("button",{key:0,onClick:G,class:"absolute top-4 left-4 text-gray-500 text-lg hover:text-mccblue transition mt-[9px]"}," ← Back ")):M("",!0),e("h2",re,i(h.value===1?P.editMode?"Edit Student":"Add New Student":"Select Subjects for "+o.value.fname+" "+o.value.lname),1),e("div",ue,[q(H,{name:"slide-left-right"},{default:A(()=>[h.value===1?(r(),u("form",{key:0,onSubmit:X(I,["prevent"]),class:"absolute top-0 left-0 w-full h-full grid grid-cols-1 md:grid-cols-2 gap-4 overflow-y-auto pr-2"},[e("div",ie,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Student ID",-1)),v(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>o.value.studid=a),onInput:D,placeholder:"e.g. 2024-0001",maxlength:"9",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},null,544),[[V,o.value.studid]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"First Name",-1)),v(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=a=>o.value.fname=a),placeholder:"e.g. Hasan",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},null,512),[[V,o.value.fname]])]),e("div",de,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Middle Name",-1)),v(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>o.value.mname=a),placeholder:"Leave Blank if N/A",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition"},null,512),[[V,o.value.mname]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Last Name",-1)),v(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=a=>o.value.lname=a),placeholder:"e.g. Syed",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},null,512),[[V,o.value.lname]])]),e("div",ce,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Email",-1)),v(e("input",{type:"email","onUpdate:modelValue":t[4]||(t[4]=a=>o.value.email=a),placeholder:"e.g. hasanmangubat@gmail.com",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition"},null,512),[[V,o.value.email]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Year",-1)),v(e("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>o.value.year=a),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},[t[18]||(t[18]=e("option",{value:"",disabled:""},"Select Year",-1)),(r(),u(k,null,S([1,2,3,4],a=>e("option",{key:a,value:a},i(a),9,me)),64))],512),[[_,o.value.year]])]),e("div",be,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Section",-1)),v(e("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>o.value.section=a),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},[t[20]||(t[20]=e("option",{value:"",disabled:""},"Select Section",-1)),(r(!0),u(k,null,S(c.value,a=>(r(),u("option",{key:a,value:a},i(a),9,ve))),128))],512),[[_,o.value.section]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Semester",-1)),v(e("select",{"onUpdate:modelValue":t[7]||(t[7]=a=>o.value.semester=a),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},t[22]||(t[22]=[e("option",{value:"",disabled:""},"Select Semester",-1),e("option",{value:"First Semester"},"First Semester",-1),e("option",{value:"Second Semester"},"Second Semester",-1),e("option",{value:"Summer"},"Summer",-1)]),512),[[_,o.value.semester]])]),e("div",fe,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Academic Year",-1)),v(e("select",{"onUpdate:modelValue":t[8]||(t[8]=a=>o.value.ay=a),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},[t[24]||(t[24]=e("option",{value:"",disabled:""},"Select Academic Year",-1)),(r(!0),u(k,null,S(F.value,a=>(r(),u("option",{key:a,value:a},i(a),9,pe))),128))],512),[[_,o.value.ay]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Gender",-1)),v(e("select",{"onUpdate:modelValue":t[9]||(t[9]=a=>o.value.gender=a),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition",required:""},t[26]||(t[26]=[e("option",{value:"",disabled:""},"Select Gender",-1),e("option",{value:"Male"},"Male",-1),e("option",{value:"Female"},"Female",-1)]),512),[[_,o.value.gender]])]),e("div",ge,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 select-none"},"Student Type",-1)),v(e("select",{"onUpdate:modelValue":t[10]||(t[10]=a=>o.value.regular=a),class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition"},t[28]||(t[28]=[e("option",{value:1},"Regular",-1),e("option",{value:0},"Irregular",-1)]),512),[[_,o.value.regular]])]),e("div",ye,[e("button",{type:"button",onClick:E,class:"text-gray-500 hover:text-red-500 transition"}," Cancel "),e("button",xe,i(o.value.regular==0?"Next":"Save"),1)])],32)):M("",!0)]),_:1}),q(H,{name:"slide-left-right"},{default:A(()=>[h.value===2?(r(),u("div",we,[e("div",he,[e("h2",ke,i(o.value.fname)+" "+i(o.value.lname)+" - Subjects",1)]),e("div",Se,[v(e("input",{"onUpdate:modelValue":t[11]||(t[11]=a=>g.value=a),onInput:B,placeholder:"Type to search subject",class:"w-full rounded-md border border-gray-300 bg-white text-gray-800 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-mccblue focus:border-mccblue transition"},null,544),[[V,g.value]]),y.value.length?(r(),u("div",$e,[(r(!0),u(k,null,S(y.value,a=>(r(),u("div",{key:a.id,onClick:Q=>Y(a),class:"px-3 py-2 hover:bg-gray-200 text-gray-800 cursor-pointer"},i(a.title),9,Ce))),128))])):M("",!0)]),e("ul",_e,[(r(!0),u(k,null,S(p.value,a=>(r(),u("li",{key:a.id,class:"flex justify-between items-center bg-gray-100 text-gray-800 px-3 py-2 mb-2 rounded-md"},[e("span",null,i(a.title),1),e("button",{onClick:Q=>z(a),class:"text-red-500 hover:text-red-700"},"-",8,je)]))),128))]),e("div",{class:"flex justify-end gap-4 mt-auto pt-4"},[e("button",{onClick:O,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded-md transition"}," Save ")])])):M("",!0)]),_:1})]),e("button",{onClick:E,class:"absolute top-4 right-4 text-gray-500 text-2xl hover:text-red-500 transition mt-[6px]"}," × ")])])):M("",!0)]),_:1})]))}},Ve=oe(Ee,[["__scopeId","data-v-d84a5812"]]),Me={class:"flex flex-col md:flex-row justify-between select-none items-center p-5"},Ue={class:"mb-2 md:mb-0"},Fe=["value"],Te={class:"flex flex-col md:flex-row gap-2 items-center"},Be={class:"p-4 space-y-6 animate-slide-in-top"},Ne={class:"overflow-x-auto rounded-lg border shadow"},Ie={class:"min-w-full bg-white"},Le={class:"bg-mcclightblue text-white"},De=["onClick"],qe={key:0},Ae={class:"px-4 py-2 text-center"},Pe={class:"px-4 py-2"},Ye={class:"px-4 py-2 text-center"},ze={class:"px-4 py-2 text-center"},Ge={class:"px-4 py-2 text-center space-x-2"},Oe=["onClick"],He=["onClick"],Re={key:0},Je={class:"flex justify-between bg-mcclightblue items-center px-2 text-sm text-white select-none"},Ke={class:"font-semibold"},Qe={class:"font-semibold"},We={class:"font-semibold"},Xe={class:"flex gap-1 items-center"},Ze=["disabled"],et=["onClick"],tt=["value"],st=["disabled"],rt={__name:"CourseStudents",setup(P){const j=Z().props.course,b=d(""),w=d(""),h=d(""),U=d([]),p=d(""),g=d([{key:"studid",direction:"asc"}]),y=d(10),c=d(1),F=d(!1),B=d(null),Y=[{key:"studid",label:"Student ID"},{key:"name",label:"Name"},{key:"gender",label:"Gender"},{key:"year",label:"Year"}],z=async()=>{try{const m=await f.get("/session");b.value=m.data.fullname,w.value=m.data.level,h.value=m.data.username,(!b.value||!w.value)&&(window.location.href="/")}catch{window.location.href="/"}},o=async()=>{const m=await f.get(`/api/students/${j}`);U.value=m.data,c.value=1,D()},C=R(()=>[...U.value].sort((n,l)=>{for(const x of g.value){const s=x.key,t=x.direction;if(n[s]<l[s])return t==="asc"?-1:1;if(n[s]>l[s])return t==="asc"?1:-1}return 0}).filter(n=>Object.values(n).join(" ").toLowerCase().includes(p.value.toLowerCase()))),T=R(()=>{const m=(c.value-1)*y.value;return C.value.slice(m,m+y.value)}),E=R(()=>Math.ceil(C.value.length/y.value)),I=()=>{c.value=1},G=m=>{const n=g.value.findIndex(l=>l.key===m);n!==-1?g.value[n].direction=g.value[n].direction==="asc"?"desc":"asc":g.value.push({key:m,direction:"asc"})},L=async m=>{(await $.fire({title:"Delete this student?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes"})).isConfirmed&&(await f.delete(`/students/${m}`),await o(),$.fire({toast:!0,title:"Deleted",icon:"success",position:"top-end",timer:2e3,showConfirmButton:!1}))},O=m=>{F.value=!0,B.value={...m}},D=()=>{F.value=!1,B.value=null};return ee(()=>{z(),o()}),(m,n)=>(r(),te(le,{fullname:b.value,userLevel:w.value,title:`Students – ${K(j)}`},{default:A(()=>[e("div",Me,[e("div",Ue,[n[7]||(n[7]=e("label",{class:"mr-2"},"Show",-1)),v(e("select",{"onUpdate:modelValue":n[0]||(n[0]=l=>y.value=l),onChange:I,class:"border py-1 rounded"},[(r(),u(k,null,S([10,25,50,100],l=>e("option",{key:l,value:l},i(l),9,Fe)),64))],544),[[_,y.value]]),n[8]||(n[8]=e("span",{class:"ml-2"},"entries",-1))]),e("div",Te,[v(e("input",{"onUpdate:modelValue":n[1]||(n[1]=l=>p.value=l),onInput:I,type:"text",placeholder:"Search students...",class:"border px-3 py-1 rounded w-full md:w-64"},null,544),[[V,p.value]]),q(Ve,{course:K(j),class:"ml-4",onSubmitted:o,editMode:F.value,studentToEdit:B.value,onCancelEdit:D},null,8,["course","editMode","studentToEdit"])])]),e("div",Be,[e("div",Ne,[e("table",Ie,[e("thead",Le,[e("tr",null,[(r(),u(k,null,S(Y,l=>e("th",{key:l.key,class:"px-4 py-2 text-center cursor-pointer",onClick:x=>G(l.key)},[N(i(l.label)+" ",1),g.value.find(x=>x.key===l.key)?(r(),u("span",qe,i(g.value.find(x=>x.key===l.key).direction==="asc"?"▲":"▼"),1)):M("",!0)],8,De)),64)),n[9]||(n[9]=e("th",{class:"px-4 py-2 text-center"},"Actions",-1))])]),e("tbody",null,[(r(!0),u(k,null,S(T.value,l=>(r(),u("tr",{key:l.id,class:"hover:bg-gray-100"},[e("td",Ae,i(l.studid),1),e("td",Pe,i(l.fname)+" "+i(l.lname),1),e("td",Ye,i(l.gender),1),e("td",ze,i(l.year),1),e("td",Ge,[e("button",{onClick:x=>O(l),class:"text-blue-600 hover:underline"},"Edit",8,Oe),e("button",{onClick:x=>L(l.id),class:"text-red-600 hover:underline"},"Delete",8,He)])]))),128)),T.value.length===0?(r(),u("tr",Re,n[10]||(n[10]=[e("td",{colspan:"5",class:"text-center py-4"},"No students found.",-1)]))):M("",!0)])]),e("div",Je,[e("div",null,[n[11]||(n[11]=N(" Showing ")),e("span",Ke,i(T.value.length?(c.value-1)*y.value+1:0),1),n[12]||(n[12]=N(" to ")),e("span",Qe,i((c.value-1)*y.value+T.value.length),1),n[13]||(n[13]=N(" of ")),e("span",We,i(C.value.length),1),n[14]||(n[14]=N(" entries "))]),e("div",Xe,[e("button",{onClick:n[2]||(n[2]=l=>g.value=[]),class:"text-sm hover:bg-mccblue px-2 py-1 rounded transition"}," Clear Sorting "),e("button",{onClick:n[3]||(n[3]=l=>c.value=c.value-1),disabled:c.value===1,class:"px-3 py-1 border-0 rounded disabled:opacity-50 disabled:hover:bg-mcclightblue hover:bg-mccblue transition"}," Prev ",8,Ze),E.value<=10?(r(!0),u(k,{key:0},S(E.value,l=>(r(),u("button",{key:l,onClick:x=>c.value=l,class:se(["px-3 py-1 border-0 rounded",c.value===l?"bg-white text-mccblue font-bold":"hover:bg-mccblue transition"])},i(l),11,et))),128)):v((r(),u("select",{key:1,"onUpdate:modelValue":n[4]||(n[4]=l=>c.value=l),onChange:n[5]||(n[5]=l=>c.value=parseInt(l.target.value)),class:"bg-white text-mccblue py-[0.5px] rounded border-none"},[(r(!0),u(k,null,S(E.value,l=>(r(),u("option",{key:l,value:l},i(l),9,tt))),128))],544)),[[_,c.value]]),e("button",{onClick:n[6]||(n[6]=l=>c.value=c.value+1),disabled:c.value===E.value,class:"px-3 py-1 border-0 rounded disabled:opacity-50 disabled:hover:bg-mcclightblue hover:bg-mccblue transition"}," Next ",8,st)])])])])]),_:1},8,["fullname","userLevel","title"]))}};export{rt as default};
