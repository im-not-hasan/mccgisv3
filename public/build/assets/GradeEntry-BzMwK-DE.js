import{r as p,c as de,N as pt,L as Ae,o as mt,g as i,d as c,i as y,e as a,n as b,t as d,u as he,k as me,F as A,h as F,f as w,j as z,a as X,$ as k,p as _}from"./app-yhYp1Hqu.js";import{S as N}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as vt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const gt={class:"p-6 bg-whitebg"},ft={key:0},yt={key:1},xt={key:2},ht={key:3},wt={class:"grid grid-cols-3 gap-6 mb-6"},zt={class:"bg-blue-100 text-mcclightblue rounded-md p-4 shadow-md flex flex-col justify-between"},kt={class:"text-xl text-mccblue font-bold"},_t={class:"bg-blue-100 text-mcclightblue rounded-md p-4 shadow-md flex flex-col justify-between"},qt={class:"text-xl text-mccblue font-bold"},Ct={class:"text-md font-bold"},Et={class:"bg-blue-100 text-mcclightblue rounded-md p-4 shadow-md flex flex-col justify-between"},St={class:"text-xl text-mccblue font-bold"},At={class:"text-md font-bold"},Ft={key:0,class:"min-w-full border-collapse text-xs"},Nt=["colspan"],It=["disabled"],Ut=["colspan"],$t=["disabled"],Rt=["onUpdate:modelValue","disabled"],Gt={class:"border p-1 bg-gray-300 text-center font-semibold sticky top-8 z-30"},Vt=["onUpdate:modelValue","disabled"],Mt={class:"border p-1 bg-gray-300 text-center font-semibold sticky top-8 z-30"},Tt=["disabled"],Pt=["disabled"],Bt=["disabled"],Qt={class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},Lt={key:0},Dt=["colspan"],Ht={class:"border-none p-1 text-center bg-white"},Kt={class:"border-none p-1 sticky left-0 bg-white z-40 w-36"},Ot={class:"border-none p-1 sticky left-20 bg-white z-40 w-3"},jt={class:"border-none p-1 sticky left-40 bg-white z-40 w-36"},Yt={key:0,class:"ml-1 px-1 text-xs bg-red-100 text-red-600 rounded"},Zt=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],Jt={class:"border p-1 text-center font-semibold bg-gray-200"},Xt={class:"border p-1 text-center font-semibold bg-gray-200"},Wt={class:"border p-1 text-center font-semibold bg-gray-200"},er=["onUpdate:modelValue","disabled","onInput","data-row","data-col","onKeydown"],tr={class:"border p-1 text-center font-semibold bg-gray-200"},rr={class:"border p-1 text-center font-semibold bg-gray-200"},ar={class:"border p-1 text-center font-semibold bg-gray-200"},or=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],nr={class:"border p-1 text-center font-semibold bg-gray-200"},lr={class:"border p-1 text-center font-semibold bg-gray-200"},sr=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],ur=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],dr={class:"border p-1 text-center font-semibold bg-gray-200"},ir={class:"border p-1 text-center font-semibold bg-gray-200"},cr={class:"border p-1 text-center font-semibold bg-gray-200"},br={class:"border p-1 text-center font-semibold bg-gray-200"},pr={class:"border p-1 text-center font-semibold bg-gray-200"},mr={key:1,class:"min-w-full border-collapse text-xs"},vr=["colspan"],gr=["disabled"],fr=["colspan"],yr=["disabled"],xr=["onUpdate:modelValue","disabled"],hr={class:"border p-1 bg-gray-300 text-center font-semibold sticky top-8 z-30"},wr=["onUpdate:modelValue","disabled"],zr={class:"border p-1 bg-gray-300 text-center font-semibold sticky top-8 z-30"},kr=["disabled"],_r=["disabled"],qr={key:0},Cr=["colspan"],Er={class:"border-none p-1 text-center bg-white"},Sr={class:"border-none p-1 sticky left-0 bg-white z-40 w-36"},Ar={class:"border-none p-1 sticky left-20 bg-white z-40 w-36"},Fr={class:"border-none p-1 sticky left-40 bg-white z-40 w-36"},Nr=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],Ir={class:"border p-1 text-center font-semibold bg-gray-200"},Ur={class:"border p-1 text-center font-semibold bg-gray-200"},$r={class:"border p-1 text-center font-semibold bg-gray-200"},Rr=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],Gr={class:"border p-1 text-center font-semibold bg-gray-200"},Vr={class:"border p-1 text-center font-semibold bg-gray-200"},Mr={class:"border p-1 text-center font-semibold bg-gray-200"},Tr=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],Pr={class:"border p-1 text-center font-semibold bg-gray-200"},Br={class:"border p-1 text-center font-semibold bg-gray-200"},Qr=["onUpdate:modelValue","max","disabled","onInput","data-row","data-col","onKeydown"],Lr={class:"border p-1 text-center font-semibold bg-gray-200"},Dr={class:"border p-1 text-center font-semibold bg-gray-200"},Hr={class:"border p-1 text-center font-semibold bg-gray-200"},Kr={class:"border p-1 text-center font-semibold bg-gray-200"},Or={class:"border p-1 text-center font-semibold bg-gray-200"},jr={class:"border p-1 text-center font-semibold bg-gray-200"},Yr={class:"border p-1 text-center font-semibold bg-gray-200"},Zr={class:"mt-4 text-right absolute bottom-2 right-2"},Jr=["disabled"],Xr=["disabled"],Wr=["disabled"],ea=["disabled"],ta={class:"absolute bottom-2 left-2 flex space-x-2"},ra={__name:"GradeEntry",setup(aa){const B=p("midterm"),o=p(!1),Fe=p(!1),Ne=p(!1),q=p("idle"),ve=p(new Map),we=p(null),Q=(t,e,r,l)=>{var s,u;if(!Fe.value||o.value)return;const n=`${l}-${t.studid}-${e}-${r}`;ve.value.set(n,{teacher_username:J.value,subject_code:L,course:D,year:H,section:K,ay_id:I.value.id,term:l,student_id:t.studid,component_type:e,component_index:r,score:e==="quiz"?(s=t.quizzes)==null?void 0:s[r-1]:e==="attendance"?(u=t.attendance)==null?void 0:u[r-1]:e==="performance"?t.performance:e==="exam"?l==="midterm"?r===1?t.prelimScore:t.midtermScore:t.finalExam:null}),q.value="waiting",we.value&&clearTimeout(we.value),we.value=setTimeout(je,5e3)},je=async()=>{if(ve.value.size!==0){q.value="saving";try{const t=Array.from(ve.value.values());await X.post("/grades/autosave",{teacher_username:J.value,subject_code:L,course:D,year:H,section:K,ay_id:I.value.id,changes:t}),ve.value.clear(),q.value="saved",setTimeout(()=>{q.value==="saved"&&(q.value="idle")},2e3)}catch(t){console.error("Autosave failed",t),q.value="error"}}},Ie=de(()=>4+(m.value+3)+(v.value+3)+3+5+3),{url:Ye}=pt(),ge=new URLSearchParams(Ye.split("?")[1]),L=ge.get("subject")||"",D=ge.get("course")||"",H=ge.get("year")||"",K=ge.get("section")||"",M=p(!0),m=p(5),v=p(10),$=p(Array(m.value).fill(0)),V=p(Array(v.value).fill(0)),O=p(100),W=p(100),ee=p(100),C=p([]),ze=de(()=>$.value.reduce((t,e)=>t+(Number(e)||0),0)),ke=de(()=>V.value.reduce((t,e)=>t+(Number(e)||0),0)),_e=de(()=>(Number(W.value)||0)+(Number(ee.value)||0)),f=p(5),x=p(10),E=p([]),R=p(Array(f.value).fill(0)),G=p(Array(x.value).fill(0)),j=p(100),Y=p(100),qe=de(()=>R.value.reduce((t,e)=>t+(Number(e)||0),0)),Ce=de(()=>G.value.reduce((t,e)=>t+(Number(e)||0),0)),h=(t,e,r,l)=>{const n=e==="midterm"?C.value:E.value;if(!n||!n.length)return;const s=n.length-1;let u=t==="down"?r+1:r-1;if(u<0||u>s)return;const T=`input[data-section="${e}"][data-row="${u}"][data-col="${l}"]`,g=document.querySelector(T);g&&(g.focus(),typeof g.select=="function"&&g.select())},Z=(t,e)=>{const r=Number(t),l=Number(e);return!l||Number.isNaN(l)||t===""||t===null||t===void 0?!1:!Number.isNaN(r)&&r>l},Ue=(t,e)=>{var r;return Z((r=t.quizzes)==null?void 0:r[e],$.value[e])},$e=(t,e)=>{var r;return Z((r=t.attendance)==null?void 0:r[e],V.value[e])},Re=t=>Z(t.performance,O.value),Ge=t=>Z(t.prelimScore,W.value),Ve=t=>Z(t.midtermScore,ee.value),Me=(t,e)=>{var r;return Z((r=t.quizzes)==null?void 0:r[e],R.value[e])},Te=(t,e)=>{var r;return Z((r=t.attendance)==null?void 0:r[e],G.value[e])},Pe=t=>Z(t.performance,j.value),Be=t=>Z(t.finalExam,Y.value),Qe=()=>{for(const t of C.value){for(let e=0;e<m.value;e++)if(Ue(t,e))return!0;for(let e=0;e<v.value;e++)if($e(t,e))return!0;if(Re(t)||Ge(t)||Ve(t))return!0}return!1},Le=()=>{for(const t of E.value){for(let e=0;e<f.value;e++)if(Me(t,e))return!0;for(let e=0;e<x.value;e++)if(Te(t,e))return!0;if(Pe(t)||Be(t))return!0}return!1};async function fe({typeLabel:t,columnLabel:e,hasHps:r,hasScores:l}){if(!r&&!l)return!0;const n=[];r&&n.push("an HPS value"),l&&n.push("scores entered for at least one student");const s=n.join(" and ");return(await N.fire({title:`Delete ${e}?`,html:`
      <p class="text-sm text-gray-700">
        This ${t.toLowerCase()} already has <b>${s}</b>.<br>
        Deleting it will permanently remove all data in this column.
      </p>
      <p class="mt-2 text-xs text-red-600">
        This action cannot be undone.
      </p>
    `,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete column",cancelButtonText:"Cancel",confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",reverseButtons:!0})).isConfirmed?(await N.fire({title:"Are you absolutely sure?",html:`
      <p class="text-sm text-gray-700">
        All scores and the HPS for <b>${e}</b> will be lost for every student.
      </p>
    `,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete anyway",cancelButtonText:"Go back",confirmButtonColor:"#b91c1c",cancelButtonColor:"#6b7280",reverseButtons:!0})).isConfirmed:!1}const Ze=()=>{m.value++,$.value.push(0),C.value.forEach(t=>{t.quizzes.push("")})},Je=()=>{v.value++,V.value.push(0),C.value.forEach(t=>{t.attendance.push("")})},Xe=async()=>{if(m.value<=1)return;const t=m.value-1,e=!!Number($.value[t]),r=C.value.some(n=>{var u;const s=(u=n.quizzes)==null?void 0:u[t];return s!==""&&s!==null&&s!==void 0&&!Number.isNaN(Number(s))});await fe({typeLabel:"Quiz column",columnLabel:`Q${m.value}`,hasHps:e,hasScores:r})&&(m.value--,$.value.pop(),C.value.forEach(n=>{n.quizzes.pop()}))},We=async()=>{if(v.value<=1)return;const t=v.value-1,e=!!Number(V.value[t]),r=C.value.some(n=>{var u;const s=(u=n.attendance)==null?void 0:u[t];return s!==""&&s!==null&&s!==void 0&&!Number.isNaN(Number(s))});await fe({typeLabel:"Attendance column",columnLabel:`A${v.value}`,hasHps:e,hasScores:r})&&(v.value--,V.value.pop(),C.value.forEach(n=>{n.attendance.pop()}))};function ie(t){for(const e in t)if(Array.isArray(t[e]))t[e]=t[e].map(r=>{if(r===""||r===null)return r;const l=Number(r);return Number.isInteger(l)?parseInt(l):l});else if(typeof t[e]=="object"&&t[e]!==null)ie(t[e]);else if(t[e]!==""&&t[e]!==null){const r=Number(t[e]);isNaN(r)||(t[e]=Number.isInteger(r)?parseInt(r):r)}}const et=()=>{f.value++,R.value.push(0),E.value.forEach(t=>{t.quizzes.push("")})},tt=()=>{x.value++,G.value.push(0),E.value.forEach(t=>{t.attendance.push("")})},rt=async()=>{if(f.value<=1)return;const t=f.value-1,e=!!Number(R.value[t]),r=E.value.some(n=>{var u;const s=(u=n.quizzes)==null?void 0:u[t];return s!==""&&s!==null&&s!==void 0&&!Number.isNaN(Number(s))});await fe({typeLabel:"Final quiz column",columnLabel:`Q${f.value}`,hasHps:e,hasScores:r})&&(f.value--,R.value.pop(),E.value.forEach(n=>{n.quizzes.pop()}))},at=async()=>{if(x.value<=1)return;const t=x.value-1,e=!!Number(G.value[t]),r=E.value.some(n=>{var u;const s=(u=n.attendance)==null?void 0:u[t];return s!==""&&s!==null&&s!==void 0&&!Number.isNaN(Number(s))});await fe({typeLabel:"Final attendance column",columnLabel:`A${x.value}`,hasHps:e,hasScores:r})&&(x.value--,G.value.pop(),E.value.forEach(n=>{n.attendance.pop()}))},ot=async()=>{var t,e,r,l,n,s,u,T;try{const g=await X.get("/session?source=gradeentry");if(ye.value=g.data.fullname,le.value=g.data.level,J.value=g.data.username,!ye.value||!le.value||le.value!=="teacher"){window.location.href="/";return}}catch{window.location.href="/";return}try{const g=`/grades/${encodeURIComponent(L)}/${encodeURIComponent(D)}/${encodeURIComponent(H)}/${encodeURIComponent(K)}`,ce=await X.get(g,{params:{teacher_username:J.value,ay_id:I.value.id}});o.value=!!ce.data.submitted,Ne.value=!!ce.data.hasComponents,Fe.value=Ne.value;const S=ce.data;ie(S.gradesData),ie(S.gradeComponents),m.value=S.quizCount??5,v.value=S.attendanceCount??10;const se=((t=S.gradeComponents)==null?void 0:t.quiz)||{};$.value=Array(m.value).fill(0).map((ae,U)=>se[U+1]??0);const P=((e=S.gradeComponents)==null?void 0:e.attendance)||{};V.value=Array(v.value).fill(0).map((ae,U)=>P[U+1]??0),O.value=((l=(r=S.gradeComponents)==null?void 0:r.performance)==null?void 0:l[1])??0,W.value=((s=(n=S.gradeComponents)==null?void 0:n.exam)==null?void 0:s[1])??0,ee.value=((T=(u=S.gradeComponents)==null?void 0:u.exam)==null?void 0:T[2])??0,C.value=S.students.map(ae=>{var ue,te,Ke,Oe;const U=((ue=S.gradesData)==null?void 0:ue[ae.studid])||{quizzes:[],attendance:[],performance:"",exams:[]},oe=((te=S.summaryGrades)==null?void 0:te[ae.studid])||{},xe=Array(m.value).fill("").map((bt,be)=>{var pe;return((pe=U.quizzes)==null?void 0:pe[be])!==void 0?U.quizzes[be]:""}),Se=Array(v.value).fill("").map((bt,be)=>{var pe;return((pe=U.attendance)==null?void 0:pe[be])!==void 0?U.attendance[be]:""});return{...ae,quizzes:xe,attendance:Se,performance:U.performance??"",prelimScore:((Ke=U.exams)==null?void 0:Ke[0])??"",midtermScore:((Oe=U.exams)==null?void 0:Oe[1])??"",midterm:oe.midterm??"",final:oe.final??"",overall:oe.overall??"",submitted:oe.submitted??0,totals:{quiz:0,attendance:0,exam:0},equivs:{quiz:0,attendance:0,performance:0,exam:0},percents:{quiz:0,attendance:0,performance:0,exam:0},midtermGrade:0,equivalent:0,remarks:""}})}catch(g){console.error("Failed to fetch grades:",g)}finally{}},nt=async()=>{var t,e,r,l,n,s;try{const u=await X.get("/session?source=gradeentry");if(ye.value=u.data.fullname,le.value=u.data.level,J.value=u.data.username,!ye.value||!le.value||le.value!=="teacher"){window.location.href="/";return}}catch{window.location.href="/";return}try{const u=`/finalgrades/${encodeURIComponent(L)}/${encodeURIComponent(D)}/${encodeURIComponent(H)}/${encodeURIComponent(K)}`,g=(await X.get(u,{params:{teacher_username:J.value,ay_id:I.value.id}})).data;ie(g.gradesData),ie(g.gradeComponents),f.value=g.quizCount??5,x.value=g.attendanceCount??10;const ce=((t=g.gradeComponents)==null?void 0:t.quiz)||{};R.value=Array(f.value).fill(0).map((se,P)=>ce[P+1]??0);const S=((e=g.gradeComponents)==null?void 0:e.attendance)||{};G.value=Array(x.value).fill(0).map((se,P)=>S[P+1]??0),j.value=((l=(r=g.gradeComponents)==null?void 0:r.performance)==null?void 0:l[1])??0,Y.value=((s=(n=g.gradeComponents)==null?void 0:n.exam)==null?void 0:s[1])??0,E.value=g.students.map(se=>{var oe,xe;const P=((oe=g.gradesData)==null?void 0:oe[se.studid])||{quizzes:[],attendance:[],performance:"",exams:[]},ae=Array(f.value).fill("").map((Se,ue)=>{var te;return((te=P.quizzes)==null?void 0:te[ue])??""}),U=Array(x.value).fill("").map((Se,ue)=>{var te;return((te=P.attendance)==null?void 0:te[ue])??""});return{...se,quizzes:ae,attendance:U,performance:P.performance??"",finalExam:((xe=P.exams)==null?void 0:xe[0])??"",totals:{quiz:0,attendance:0,exam:0},equivs:{quiz:0,attendance:0,performance:0,exam:0},percents:{quiz:0,attendance:0,performance:0,exam:0},finalGrade:0,equivalent:0,remarks:"Failed"}})}catch(u){console.error("Failed to fetch final grades:",u)}finally{}};function re(t){const e=C.value.find(r=>r.studid===t);return e&&e.midtermGrade||0}Ae(B,()=>{q.value="idle"});function ne(t){return t>94.45?1:t>93.45?1.1:t>92.45?1.2:t>91.45?1.3:t>90.45?1.4:t>89.45?1.5:t>88.45?1.6:t>87.45?1.7:t>86.45?1.8:t>85.45?1.9:t>84.45?2:t>83.45?2.1:t>82.45?2.2:t>81.45?2.3:t>80.45?2.4:t>79.45?2.5:t>78.45?2.6:t>77.45?2.7:t>76.45?2.8:t>75.45?2.9:t>74.45?3:t>73.45?3.1:t>72.45?3.2:t>71.45?3.3:t>70.45?3.4:(t>69.45,3.5)}const lt=()=>{C.value.forEach(t=>{const e=t.quizzes.reduce((u,T)=>u+(Number(T)||0),0);t.totals.quiz=e,t.equivs.quiz=ze.value?e*40/ze.value+60:0,t.percents.quiz=t.equivs.quiz*.3;const r=t.attendance.reduce((u,T)=>u+(Number(T)||0),0);t.totals.attendance=r,t.equivs.attendance=ke.value?r*100/ke.value:0,t.percents.attendance=t.equivs.attendance*.15,t.totals.performance=Number(t.performance)||0,t.equivs.performance=O.value?t.totals.performance*50/O.value+50:0,t.percents.performance=t.equivs.performance*.15;const l=Number(t.prelimScore)||0,n=Number(t.midtermScore)||0,s=l+n;t.totals.exam=s,t.equivs.exam=_e.value?s*40/_e.value+60:0,t.percents.exam=t.equivs.exam*.4,t.midtermGrade=(t.percents.quiz||0)+(t.percents.attendance||0)+(t.percents.performance||0)+(t.percents.exam||0),t.equivalent=Number(ne(t.midtermGrade).toFixed(1)),t.remarks=t.midtermGrade>=75?"Passed":"Failed"})},st=()=>{E.value.forEach(t=>{const e=t.quizzes.reduce((n,s)=>n+(Number(s)||0),0);t.totals.quiz=e,t.equivs.quiz=qe.value?e*40/qe.value+60:0,t.percents.quiz=t.equivs.quiz*.3;const r=t.attendance.reduce((n,s)=>n+(Number(s)||0),0);t.totals.attendance=r,t.equivs.attendance=Ce.value?r*100/Ce.value:0,t.percents.attendance=t.equivs.attendance*.15,t.totals.performance=Number(t.performance)||0,t.equivs.performance=j.value?t.totals.performance*40/j.value+60:0,t.percents.performance=t.equivs.performance*.15;const l=Number(t.finalExam)||0;t.totals.exam=l,t.equivs.exam=Y.value?l*40/Y.value+60:0,t.percents.exam=t.equivs.exam*.4,t.finalGrade=(t.percents.quiz||0)+(t.percents.attendance||0)+(t.percents.performance||0)+(t.percents.exam||0),t.equivalent=Number(ne(t.finalGrade).toFixed(1)),t.remarks=t.finalGrade>=75?"Passed":"Failed"})};Ae([C,$,V,O,W,ee],lt,{deep:!0,immediate:!0}),Ae([E,R,G,j,Y],st,{deep:!0,immediate:!0});const ut=async()=>{if(Qe()||Le()){await N.fire({icon:"error",title:"Scores Exceed HPS",html:`
        <p class="text-sm text-gray-700">
          Some scores are higher than their column HPS.<br>
          Please fix the <span class="font-semibold text-red-600">red-highlighted cells</span> before submitting.
        </p>
      `,confirmButtonColor:"#ef4444"});return}if((await N.fire({title:"Submit Grades?",html:`
      <p class="text-sm text-gray-700">
        Once submitted, <b>grades cannot be edited or modified</b>.<br>
        Are you sure you want to finalize and submit all grades for this class?
      </p>
    `,icon:"warning",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",confirmButtonColor:"#2563eb",cancelButtonColor:"#6b7280",reverseButtons:!0})).isConfirmed)try{await X.post("/grades/submit",{teacher_username:J.value,subject_code:L,course:D,year:H,section:K,ay_id:I.value.id}),o.value=!0,await N.fire({icon:"success",title:"Grades Submitted!",text:"All grades have been marked as submitted and are now locked.",confirmButtonColor:"#2563eb"})}catch(e){console.error(e),N.fire({icon:"error",title:"Submission Failed!",text:"An error occurred while submitting grades. Please try again later.",confirmButtonColor:"#ef4444"})}finally{M.value=!1}},De=async()=>{if(Qe()){await N.fire({icon:"error",title:"Scores Exceed HPS",html:`
        <p class="text-sm text-gray-700">
          At least one student has a score that is higher than the HPS for its column.<br>
          Please review the <span class="font-semibold text-red-600">red-highlighted cells</span> before saving.
        </p>
      `,confirmButtonColor:"#ef4444"});return}try{const t=[];$.value.forEach((n,s)=>{t.push({component_type:"quiz",component_index:s+1,hps:Number(n)||0})}),V.value.forEach((n,s)=>{t.push({component_type:"attendance",component_index:s+1,hps:Number(n)||0})}),t.push({component_type:"performance",component_index:1,hps:Number(O.value)||0}),t.push({component_type:"exam",component_index:1,hps:Number(W.value)||0}),t.push({component_type:"exam",component_index:2,hps:Number(ee.value)||0});const e=[];C.value.forEach(n=>{n.quizzes.forEach((s,u)=>{e.push({student_id:n.studid,component_type:"quiz",component_index:u+1,score:s})}),n.attendance.forEach((s,u)=>{e.push({student_id:n.studid,component_type:"attendance",component_index:u+1,score:s})}),e.push({student_id:n.studid,component_type:"performance",component_index:1,score:n.performance}),e.push({student_id:n.studid,component_type:"exam",component_index:1,score:n.prelimScore}),e.push({student_id:n.studid,component_type:"exam",component_index:2,score:n.midtermScore})});const r=C.value.map(n=>({student_id:n.studid,midterm:Number(n.equivalent)||0}));await X.post("/grades/save",{teacher_username:J.value,subject_code:L,course:D,year:H,section:K,ay_id:I.value.id,gradeComponents:t,gradesData:e,gradesSummary:r}),await N.fire({icon:"success",title:"Midterm Grades Saved!",text:"All midterm grades were successfully saved.",confirmButtonColor:"#2563eb"})}catch(t){console.error("Failed to save grades:",t),N.fire({icon:"error",title:"Failed to Save!",text:"There was an error saving midterm grades. Please try again.",confirmButtonColor:"#ef4444"})}},He=async()=>{if(Le()){await N.fire({icon:"error",title:"Scores Exceed HPS",html:`
        <p class="text-sm text-gray-700">
          At least one student has a score that is higher than the HPS for its column.<br>
          Please review the <span class="font-semibold text-red-600">red-highlighted cells</span> before saving.
        </p>
      `,confirmButtonColor:"#ef4444"});return}try{const t=[];R.value.forEach((l,n)=>{t.push({component_type:"quiz",component_index:n+1,hps:Number(l)||0})}),G.value.forEach((l,n)=>{t.push({component_type:"attendance",component_index:n+1,hps:Number(l)||0})}),t.push({component_type:"performance",component_index:1,hps:Number(j.value)||0}),t.push({component_type:"exam",component_index:1,hps:Number(Y.value)||0});const e=[];E.value.forEach(l=>{l.quizzes.forEach((n,s)=>{e.push({student_id:l.studid,component_type:"quiz",component_index:s+1,score:n})}),l.attendance.forEach((n,s)=>{e.push({student_id:l.studid,component_type:"attendance",component_index:s+1,score:n})}),e.push({student_id:l.studid,component_type:"performance",component_index:1,score:l.performance}),e.push({student_id:l.studid,component_type:"exam",component_index:1,score:l.finalExam})});const r=E.value.map(l=>{const n=re(l.studid),s=ne(Number(l.finalGrade))||0,u=(ne(n)*.3+s*.7).toFixed(2);return{student_id:l.studid,final:s,overall:u}});await X.post("/finalgrades/save",{teacher_username:J.value,subject_code:L,course:D,year:H,section:K,ay_id:I.value.id,gradeComponents:t,gradesData:e,gradesSummary:r,term:"final"}),await N.fire({icon:"success",title:"Final Grades Saved!",text:"All final grades were successfully saved.",confirmButtonColor:"#2563eb"})}catch(t){console.error("Failed to save final grades:",t),N.fire({icon:"error",title:"Save Failed!",text:"There was an error saving final grades. Please try again.",confirmButtonColor:"#ef4444"})}},dt=async()=>{try{await Promise.all([De(),He()]),await N.fire({icon:"success",title:"All Grades Saved!",text:"Both Midterm and Final Grades were successfully saved.",confirmButtonColor:"#2563eb"})}catch(t){console.error("Failed to save both grade sets:",t),N.fire({icon:"error",title:"Save Failed!",text:"Something went wrong while saving both grade sets.",confirmButtonColor:"#ef4444"})}finally{M.value=!1}},Ee=p(null);function it(){Ee.value&&(document.fullscreenElement?document.exitFullscreen():Ee.value.requestFullscreen().catch(t=>{console.error(`Error attempting fullscreen: ${t.message}`)}))}const I=p({id:null,academicyear:"",semester:""}),ye=p(""),le=p(""),J=p(""),ct=async()=>{try{const t=await X.get("/api/active-ay");t.data&&(I.value=t.data)}catch(t){console.error("Failed to fetch active academic year",t)}};return mt(async()=>{var t;await ct(),L&&D&&H&&K&&((t=I.value)!=null&&t.id)&&(M.value=!0,await ot(),M.value=!1,await nt())}),(t,e)=>(c(),i("div",gt,[q.value!=="idle"?(c(),i("div",{key:0,class:b(["fixed top-4 right-6 z-50 flex items-center gap-2 px-3 py-1 rounded shadow text-sm transition",{"bg-yellow-100 text-yellow-800":q.value==="saving","bg-green-100 text-green-700":q.value==="saved","bg-red-100 text-red-700":q.value==="error"}])},[q.value==="waiting"?(c(),i("span",ft,"âŒ› Waiting to saveâ€¦")):y("",!0),q.value==="saving"?(c(),i("span",yt,"ðŸ’¾ Savingâ€¦")):y("",!0),q.value==="saved"?(c(),i("span",xt,"âœ… Saved")):y("",!0),q.value==="error"?(c(),i("span",ht,"âš  Save failed")):y("",!0)],2)):y("",!0),a("div",wt,[a("div",zt,[a("div",kt,"Subject Code: "+d(he(L)),1),e[7]||(e[7]=a("div",{class:"text-md font-bold"},null,-1))]),a("div",_t,[a("div",qt,"Course & Year: "+d(he(D))+" - "+d(he(H)),1),a("div",Ct,"Section: "+d(he(K)),1)]),a("div",Et,[a("div",St," Semester: "+d(I.value.semester==="1"?"First Semester":I.value.semester==="2"?"Second Semester":I.value.semester==="3"?"Summer":"Loading..."),1),a("div",At,"Academic Year: "+d(I.value.academicyear),1)])]),a("div",{class:"overflow-auto border rounded-lg max-h-[535px]",ref_key:"gradesTable",ref:Ee},[B.value==="midterm"?(c(),i("table",Ft,[a("thead",null,[a("tr",null,[e[10]||(e[10]=a("th",{rowspan:"3",class:"bg-gray-300 border p-2"},"No.",-1)),e[11]||(e[11]=a("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-0 top-0 z-40 w-36"},"LASTNAME",-1)),e[12]||(e[12]=a("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-20 top-0 z-40 w-36"},"FIRSTNAME",-1)),e[13]||(e[13]=a("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-40 top-0 z-40 w-36"},"MIDDLENAME",-1)),a("th",{colspan:m.value+3,class:"bg-gray-300 border p-2"},[e[8]||(e[8]=me(" QUIZZES ")),o.value?y("",!0):(c(),i("button",{key:0,onClick:Ze,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Quiz Column"}," + ")),o.value?y("",!0):(c(),i("button",{key:1,onClick:Xe,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Quiz Column",disabled:m.value<=1}," - ",8,It))],8,Nt),a("th",{colspan:v.value+3,class:"bg-gray-300 border p-2"},[e[9]||(e[9]=me(" ATTENDANCE ")),o.value?y("",!0):(c(),i("button",{key:0,onClick:Je,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Attendance Column"}," + ")),o.value?y("",!0):(c(),i("button",{key:1,onClick:We,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Attendance Column",disabled:v.value<=1}," - ",8,$t))],8,Ut),e[14]||(e[14]=a("th",{colspan:"3",class:"bg-gray-300 border p-2"},"PERFORMANCE",-1)),e[15]||(e[15]=a("th",{colspan:"5",class:"bg-gray-300 border p-2"},"MAJOR EXAM",-1)),e[16]||(e[16]=a("th",{colspan:"3",class:"bg-gray-300 border p-2"},"PRELIM",-1))]),a("tr",null,[(c(!0),i(A,null,F(m.value,r=>(c(),i("th",{key:"q-label-"+r,class:b(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])}," Q"+d(r),3))),128)),e[17]||(e[17]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[18]||(e[18]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[19]||(e[19]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"30%",-1)),(c(!0),i(A,null,F(v.value,r=>(c(),i("th",{key:"a-label-"+r,class:b(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])}," A"+d(r),3))),128)),e[20]||(e[20]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[21]||(e[21]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[22]||(e[22]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"15%",-1)),a("th",{class:b(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"100",2),e[23]||(e[23]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[24]||(e[24]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"15%",-1)),a("th",{class:b(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"PRELIM SCORE",2),a("th",{class:b(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"MIDTERM SCORE",2),e[25]||(e[25]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[26]||(e[26]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[27]||(e[27]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"40%",-1)),e[28]||(e[28]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"MIDTERM GRADE",-1)),e[29]||(e[29]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIVALENT",-1)),e[30]||(e[30]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"REMARKS",-1))]),a("tr",null,[(c(!0),i(A,null,F($.value,(r,l)=>(c(),i("td",{key:"hps-quiz-"+l,class:b(["border p-1 bg-blue-200 sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[w(a("input",{"onUpdate:modelValue":n=>$.value[l]=n,type:"number",min:"0",class:b(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,Rt),[[z,$.value[l],void 0,{number:!0}]])],2))),128)),a("td",Gt,d(ze.value.toFixed(0)),1),e[31]||(e[31]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[32]||(e[32]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"30",-1)),(c(!0),i(A,null,F(V.value,(r,l)=>(c(),i("td",{key:"hps-attendance-"+l,class:b(["border p-1 bg-blue-200 sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[w(a("input",{"onUpdate:modelValue":n=>V.value[l]=n,type:"number",min:"0",class:b(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,Vt),[[z,V.value[l],void 0,{number:!0}]])],2))),128)),a("td",Mt,d(ke.value.toFixed(0)),1),e[33]||(e[33]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[34]||(e[34]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"15",-1)),a("td",{class:b(["border p-1 bg-blue-200 text-center sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[w(a("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>O.value=r),type:"number",min:"0",class:b(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,Tt),[[z,O.value,void 0,{number:!0}]])],2),e[35]||(e[35]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[36]||(e[36]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"15",-1)),a("td",{class:b(["border p-1 bg-blue-200 text-center sticky top-8 z-30",{"bg-gray-300 ":o.value,"bg-blue-200":!o.value}])},[w(a("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>W.value=r),type:"number",min:"0",class:b(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,Pt),[[z,W.value,void 0,{number:!0}]])],2),a("td",{class:b(["border p-1 bg-blue-200 text-center sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[w(a("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>ee.value=r),type:"number",min:"0",class:b(["w-12 border px-1 text-center bg-blue-200 sticky top-8 z-30 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,Bt),[[z,ee.value,void 0,{number:!0}]])],2),a("td",Qt,d(_e.value.toFixed(0)),1),e[37]||(e[37]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[38]||(e[38]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"40",-1)),e[39]||(e[39]=a("td",{colspan:"2",class:"border p-1 bg-gray-300 sticky top-8 z-30"},null,-1)),e[40]||(e[40]=a("td",{colspan:"1",class:"border p-1 bg-gray-300 sticky top-8 z-30"},null,-1))])]),a("tbody",null,[M.value?(c(),i("tr",Lt,[a("td",{colspan:Ie.value,class:"text-center p-4"},"Loading student data...",8,Dt)])):y("",!0),(c(!0),i(A,null,F(C.value,(r,l)=>(c(),i("tr",{key:r.id},[a("td",Ht,d(l+1),1),a("td",Kt,d(r.lname),1),a("td",Ot,d(r.fname),1),a("td",jt,[me(d(r.mname)+" ",1),r.is_irregular?(c(),i("span",Yt," IRREG ")):y("",!0)]),(c(!0),i(A,null,F(r.quizzes,(n,s)=>(c(),i("td",{key:"quiz-"+l+"-"+s,class:b(["border p-1",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[w(a("input",{"onUpdate:modelValue":u=>r.quizzes[s]=u,type:"number",min:"0",max:$.value[s]||100,disabled:o.value,onInput:u=>Q(r,"quiz",s+1,"midterm"),"data-section":"midterm","data-row":l,"data-col":s,onKeydown:[k(_(u=>h("down","midterm",l,s),["prevent"]),["enter"]),k(_(u=>h("up","midterm",l,s),["shift","prevent"]),["enter"])],class:b(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Ue(r,s)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Zt),[[z,r.quizzes[s],void 0,{number:!0}]])],2))),128)),a("td",Jt,d(r.totals.quiz.toFixed(0)),1),a("td",Xt,d(r.equivs.quiz.toFixed(0)),1),a("td",Wt,d(r.percents.quiz.toFixed(0)),1),(c(!0),i(A,null,F(r.attendance,(n,s)=>(c(),i("td",{key:"att-"+l+"-"+s,class:b(["border p-1 bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[w(a("input",{"onUpdate:modelValue":u=>r.attendance[s]=u,type:"number",disabled:o.value,onInput:u=>Q(r,"attendance",s+1,"midterm"),"data-section":"midterm","data-row":l,"data-col":m.value+s,onKeydown:[k(_(u=>h("down","midterm",l,m.value+s),["prevent"]),["enter"]),k(_(u=>h("up","midterm",l,m.value+s),["shift","prevent"]),["enter"])],class:b(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",$e(r,s)?"bg-red-200 border-red-500 text-red-800":""])},null,42,er),[[z,r.attendance[s],void 0,{number:!0}]])],2))),128)),a("td",tr,d(r.totals.attendance.toFixed(0)),1),a("td",rr,d(r.equivs.attendance.toFixed(0)),1),a("td",ar,d(r.percents.attendance.toFixed(0)),1),a("td",{class:b(["border p-1 text-center bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[w(a("input",{"onUpdate:modelValue":n=>r.performance=n,type:"number",min:"0",max:O.value,disabled:o.value,onInput:n=>Q(r,"performance",1,"midterm"),"data-section":"midterm","data-row":l,"data-col":m.value+v.value,onKeydown:[k(_(n=>h("down","midterm",l,m.value+v.value),["prevent"]),["enter"]),k(_(n=>h("up","midterm",l,m.value+v.value),["shift","prevent"]),["enter"])],class:b(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Re(r)?"bg-red-200 border-red-500 text-red-800":""])},null,42,or),[[z,r.performance,void 0,{number:!0}]])],2),a("td",nr,d(r.equivs.performance.toFixed(0)),1),a("td",lr,d(r.percents.performance.toFixed(0)),1),a("td",{class:b(["border p-1 text-center bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[w(a("input",{"onUpdate:modelValue":n=>r.prelimScore=n,type:"number",min:"0",max:W.value,disabled:o.value,onInput:n=>Q(r,"exam",1,"midterm"),"data-section":"midterm","data-row":l,"data-col":m.value+v.value+1,onKeydown:[k(_(n=>h("down","midterm",l,m.value+v.value+1),["prevent"]),["enter"]),k(_(n=>h("up","midterm",l,m.value+v.value+1),["shift","prevent"]),["enter"])],class:b(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Ge(r)?"bg-red-200 border-red-500 text-red-800":""])},null,42,sr),[[z,r.prelimScore,void 0,{number:!0}]])],2),a("td",{class:b(["border p-1 text-center bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[w(a("input",{"onUpdate:modelValue":n=>r.midtermScore=n,type:"number",min:"0",max:ee.value,disabled:o.value,onInput:n=>Q(r,"exam",2,"midterm"),"data-section":"midterm","data-row":l,"data-col":m.value+v.value+2,onKeydown:[k(_(n=>h("down","midterm",l,m.value+v.value+2),["prevent"]),["enter"]),k(_(n=>h("up","midterm",l,m.value+v.value+2),["shift","prevent"]),["enter"])],class:b(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Ve(r)?"bg-red-200 border-red-500 text-red-800":""])},null,42,ur),[[z,r.midtermScore,void 0,{number:!0}]])],2),a("td",dr,d(r.totals.exam.toFixed(0)),1),a("td",ir,d(r.equivs.exam.toFixed(0)),1),a("td",cr,d(r.percents.exam.toFixed(0)),1),a("td",br,d(r.midtermGrade.toFixed(0)),1),a("td",pr,d(r.equivalent.toFixed(1)),1),a("td",{class:b(["border p-1 text-center font-semibold",{"text-green-700 bg-green-100":r.remarks==="Passed","text-red-700 bg-red-100":r.remarks==="Failed"}])},d(r.remarks),3)]))),128))])])):y("",!0),B.value==="finals"?(c(),i("table",mr,[a("thead",null,[a("tr",null,[e[43]||(e[43]=a("th",{rowspan:"3",class:"bg-gray-300 border p-2"},"No.",-1)),e[44]||(e[44]=a("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-0 top-0 z-40 w-36"},"LASTNAME",-1)),e[45]||(e[45]=a("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-20 top-0 z-40 w-36"},"FIRSTNAME",-1)),e[46]||(e[46]=a("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-40 top-0 z-40 w-36"},"MIDDLENAME",-1)),a("th",{colspan:f.value+3,class:"bg-gray-300 border p-2"},[e[41]||(e[41]=me(" QUIZZES ")),o.value?y("",!0):(c(),i("button",{key:0,onClick:et,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Quiz Column"},"+")),o.value?y("",!0):(c(),i("button",{key:1,onClick:rt,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Quiz Column",disabled:f.value<=1},"-",8,gr))],8,vr),a("th",{colspan:x.value+3,class:"bg-gray-300 border p-2"},[e[42]||(e[42]=me(" ATTENDANCE ")),o.value?y("",!0):(c(),i("button",{key:0,onClick:tt,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Attendance Column"},"+")),o.value?y("",!0):(c(),i("button",{key:1,onClick:at,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Attendance Column",disabled:x.value<=1},"-",8,yr))],8,fr),e[47]||(e[47]=a("th",{colspan:"3",class:"bg-gray-300 border p-2"},"PERFORMANCE",-1)),e[48]||(e[48]=a("th",{colspan:"3",class:"bg-gray-300 border p-2"},"MAJOR EXAM",-1)),e[49]||(e[49]=a("th",{colspan:"3",class:"bg-gray-300 border p-2"},"FINAL SUMMARY",-1)),e[50]||(e[50]=a("th",{colspan:"4",class:"bg-gray-300 border p-2"},"MIDTERM REFERENCE",-1))]),a("tr",null,[(c(!0),i(A,null,F(f.value,r=>(c(),i("th",{key:"fq-label-"+r,class:b(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"Q"+d(r),3))),128)),e[51]||(e[51]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[52]||(e[52]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[53]||(e[53]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"30%",-1)),(c(!0),i(A,null,F(x.value,r=>(c(),i("th",{key:"fa-label-"+r,class:b(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"A"+d(r),3))),128)),e[54]||(e[54]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[55]||(e[55]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[56]||(e[56]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"15%",-1)),a("th",{class:b(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"100",2),e[57]||(e[57]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[58]||(e[58]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"15%",-1)),a("th",{class:b(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"FINAL SCORE",2),e[59]||(e[59]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[60]||(e[60]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"40%",-1)),e[61]||(e[61]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"FINAL GRADE",-1)),e[62]||(e[62]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIVALENT",-1)),e[63]||(e[63]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"REMARKS",-1)),e[64]||(e[64]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"MIDTERM GRADE",-1)),e[65]||(e[65]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"FINAL RATING",-1)),e[66]||(e[66]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIVALENT",-1)),e[67]||(e[67]=a("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"REMARKS",-1))]),a("tr",null,[(c(!0),i(A,null,F(R.value,(r,l)=>(c(),i("td",{key:"fhps-quiz-"+l,class:b(["border p-1 bg-blue-200 sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[w(a("input",{"onUpdate:modelValue":n=>R.value[l]=n,type:"number",min:"0",class:b(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,xr),[[z,R.value[l],void 0,{number:!0}]])],2))),128)),a("td",hr,d(qe.value.toFixed(0)),1),e[68]||(e[68]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[69]||(e[69]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"30",-1)),(c(!0),i(A,null,F(G.value,(r,l)=>(c(),i("td",{key:"fhps-att-"+l,class:b(["border p-1 bg-blue-200 sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[w(a("input",{"onUpdate:modelValue":n=>G.value[l]=n,type:"number",min:"0",class:b(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,wr),[[z,G.value[l],void 0,{number:!0}]])],2))),128)),a("td",zr,d(Ce.value.toFixed(0)),1),e[70]||(e[70]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[71]||(e[71]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"15",-1)),a("td",{class:b(["border p-1 bg-blue-200 text-center sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[w(a("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>j.value=r),type:"number",min:"0",class:b(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,kr),[[z,j.value,void 0,{number:!0}]])],2),e[72]||(e[72]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[73]||(e[73]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"15",-1)),a("td",{class:b(["border p-1 bg-blue-200 text-center sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[w(a("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>Y.value=r),type:"number",min:"0",class:b(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,_r),[[z,Y.value,void 0,{number:!0}]])],2),e[74]||(e[74]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[75]||(e[75]=a("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"40",-1)),e[76]||(e[76]=a("td",{colspan:"7",class:"border p-1 bg-gray-300 sticky top-8 z-30"},null,-1))])]),a("tbody",null,[M.value?(c(),i("tr",qr,[a("td",{colspan:Ie.value,class:"text-center p-4"},"Loading student data...",8,Cr)])):y("",!0),(c(!0),i(A,null,F(E.value,(r,l)=>(c(),i("tr",{key:r.id},[a("td",Er,d(l+1),1),a("td",Sr,d(r.lname),1),a("td",Ar,d(r.fname),1),a("td",Fr,d(r.mname),1),(c(!0),i(A,null,F(r.quizzes,(n,s)=>(c(),i("td",{key:"fquiz-"+l+"-"+s,class:b(["border p-1 bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[w(a("input",{"onUpdate:modelValue":u=>r.quizzes[s]=u,type:"number",min:"0",max:R.value[s]||100,disabled:o.value,onInput:u=>Q(r,"quiz",s+1,"final"),"data-section":"finals","data-row":l,"data-col":s,onKeydown:[k(_(u=>h("down","finals",l,s),["prevent"]),["enter"]),k(_(u=>h("up","finals",l,s),["shift","prevent"]),["enter"])],class:b(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Me(r,s)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Nr),[[z,r.quizzes[s],void 0,{number:!0}]])],2))),128)),a("td",Ir,d(r.totals.quiz.toFixed(0)),1),a("td",Ur,d(r.equivs.quiz.toFixed(0)),1),a("td",$r,d(r.percents.quiz.toFixed(0)),1),(c(!0),i(A,null,F(r.attendance,(n,s)=>(c(),i("td",{key:"fatt-"+l+"-"+s,class:b(["border p-1 bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[w(a("input",{"onUpdate:modelValue":u=>r.attendance[s]=u,type:"number",min:"0",max:G.value[s]||1,disabled:o.value,onInput:u=>Q(r,"attendance",s+1,"final"),"data-section":"finals","data-row":l,"data-col":f.value+s,onKeydown:[k(_(u=>h("down","finals",l,f.value+s),["prevent"]),["enter"]),k(_(u=>h("up","finals",l,f.value+s),["shift","prevent"]),["enter"])],class:b(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Te(r,s)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Rr),[[z,r.attendance[s],void 0,{number:!0}]])],2))),128)),a("td",Gr,d(r.totals.attendance.toFixed(0)),1),a("td",Vr,d(r.equivs.attendance.toFixed(0)),1),a("td",Mr,d(r.percents.attendance.toFixed(0)),1),a("td",{class:b(["border p-1 text-center bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[w(a("input",{"onUpdate:modelValue":n=>r.performance=n,type:"number",min:"0",max:j.value,disabled:o.value,onInput:n=>Q(r,"performance",1,"final"),"data-section":"finals","data-row":l,"data-col":f.value+x.value,onKeydown:[k(_(n=>h("down","finals",l,f.value+x.value),["prevent"]),["enter"]),k(_(n=>h("up","finals",l,f.value+x.value),["shift","prevent"]),["enter"])],class:b(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Pe(r)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Tr),[[z,r.performance,void 0,{number:!0}]])],2),a("td",Pr,d(r.equivs.performance.toFixed(0)),1),a("td",Br,d(r.percents.performance.toFixed(0)),1),a("td",{class:b(["border p-1 text-center bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[w(a("input",{"onUpdate:modelValue":n=>r.finalExam=n,type:"number",min:"0",max:Y.value,disabled:o.value,onInput:n=>Q(r,"exam",1,"final"),"data-section":"finals","data-row":l,"data-col":f.value+x.value+1,onKeydown:[k(_(n=>h("down","finals",l,f.value+x.value+1),["prevent"]),["enter"]),k(_(n=>h("up","finals",l,f.value+x.value+1),["shift","prevent"]),["enter"])],class:b(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Be(r)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Qr),[[z,r.finalExam,void 0,{number:!0}]])],2),a("td",Lr,d(r.equivs.exam.toFixed(0)),1),a("td",Dr,d(r.percents.exam.toFixed(0)),1),a("td",Hr,d(r.finalGrade.toFixed(0)),1),a("td",Kr,d(r.equivalent.toFixed(1)),1),a("td",{class:b(["border p-1 text-center font-semibold bg-gray-200",{"text-green-700 bg-green-100":r.remarks==="Passed","text-red-700 bg-red-100":r.remarks==="Failed"}])},d(r.remarks),3),a("td",Or,d(re(r.studid).toFixed(0)),1),a("td",jr,d((re(r.studid)*.3+r.finalGrade*.7).toFixed(0)),1),a("td",Yr,d((ne(re(r.studid))*.3+ne(r.finalGrade)*.7).toFixed(1)),1),a("td",{class:b(["border p-1 text-center font-semibold bg-gray-200",{"text-green-700 bg-green-100":re(r.studid)*.3+r.finalGrade*.7>=75,"text-red-700 bg-red-100":re(r.studid)*.3+r.finalGrade*.7<75}])},d(re(r.studid)*.3+r.finalGrade*.7>=75?"Passed":"Failed"),3)]))),128))])])):y("",!0)],512),a("div",Zr,[o.value?y("",!0):(c(),i("button",{key:0,onClick:De,disabled:M.value,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded transition mr-3"}," Save Midterm Grades ",8,Jr)),o.value?y("",!0):(c(),i("button",{key:1,onClick:He,disabled:M.value,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded transition mr-3"}," Save Final Grades ",8,Xr)),o.value?y("",!0):(c(),i("button",{key:2,onClick:dt,disabled:M.value,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded transition mr-3"}," Save All Grades ",8,Wr)),o.value?y("",!0):(c(),i("button",{key:3,onClick:ut,disabled:M.value,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded transition"}," Mark as Submitted ",8,ea))]),a("div",ta,[a("button",{onClick:e[5]||(e[5]=r=>B.value="midterm"),class:b([{"bg-gray-300 text-black":B.value==="midterm","bg-gray-100 text-gray-600":B.value!=="midterm"},"px-3 py-1 rounded border"])}," Prelim-Midterm ",2),a("button",{onClick:e[6]||(e[6]=r=>B.value="finals"),class:b([{"bg-gray-300 text-black":B.value==="finals","bg-gray-100 text-gray-600":B.value!=="finals"},"px-3 py-1 rounded border"])}," Finals ",2),a("button",{onClick:it,class:"fullscreen-btn mr-5 px-2 py-2"}," â›¶ Fullscreen ")])]))}},sa=vt(ra,[["__scopeId","data-v-df21d92e"]]);export{sa as default};
