import{r as g,c as se,N as lt,L as Qe,o as st,g as c,d as b,e as r,t as d,u as ge,i as _,k as ye,F as A,h as F,n as i,f as h,j as w,a as j,$ as z,p as k}from"./app-DOM9QA2n.js";import{S}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ut={class:"p-6 bg-whitebg"},it={class:"grid grid-cols-3 gap-6 mb-6"},ct={class:"bg-blue-100 text-mcclightblue rounded-md p-4 shadow-md flex flex-col justify-between"},bt={class:"text-xl text-mccblue font-bold"},pt={class:"bg-blue-100 text-mcclightblue rounded-md p-4 shadow-md flex flex-col justify-between"},mt={class:"text-xl text-mccblue font-bold"},vt={class:"text-md font-bold"},gt={class:"bg-blue-100 text-mcclightblue rounded-md p-4 shadow-md flex flex-col justify-between"},yt={class:"text-xl text-mccblue font-bold"},ft={class:"text-md font-bold"},xt={key:0,class:"min-w-full border-collapse text-xs"},ht=["colspan"],wt=["disabled"],zt=["colspan"],kt=["disabled"],_t=["onUpdate:modelValue","disabled"],Ct={class:"border p-1 bg-gray-300 text-center font-semibold sticky top-8 z-30"},qt=["onUpdate:modelValue","disabled"],Et={class:"border p-1 bg-gray-300 text-center font-semibold sticky top-8 z-30"},At=["disabled"],Ft=["disabled"],St=["disabled"],Nt={class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},Ut={key:0},It=["colspan"],Rt={class:"border-none p-1 text-center bg-white"},Vt={class:"border-none p-1 sticky left-0 bg-white z-40 w-36"},Gt={class:"border-none p-1 sticky left-20 bg-white z-40 w-3"},Mt={class:"border-none p-1 sticky left-40 bg-white z-40 w-36"},Tt=["onUpdate:modelValue","max","disabled","data-row","data-col","onKeydown"],$t={class:"border p-1 text-center font-semibold bg-gray-200"},Pt={class:"border p-1 text-center font-semibold bg-gray-200"},Qt={class:"border p-1 text-center font-semibold bg-gray-200"},Bt=["onUpdate:modelValue","disabled","data-row","data-col","onKeydown"],Lt={class:"border p-1 text-center font-semibold bg-gray-200"},Dt={class:"border p-1 text-center font-semibold bg-gray-200"},Ht={class:"border p-1 text-center font-semibold bg-gray-200"},Kt=["onUpdate:modelValue","max","disabled","data-row","data-col","onKeydown"],Ot={class:"border p-1 text-center font-semibold bg-gray-200"},jt={class:"border p-1 text-center font-semibold bg-gray-200"},Yt=["onUpdate:modelValue","max","disabled","data-row","data-col","onKeydown"],Zt=["onUpdate:modelValue","max","disabled","data-row","data-col","onKeydown"],Jt={class:"border p-1 text-center font-semibold bg-gray-200"},Xt={class:"border p-1 text-center font-semibold bg-gray-200"},Wt={class:"border p-1 text-center font-semibold bg-gray-200"},er={class:"border p-1 text-center font-semibold bg-gray-200"},tr={class:"border p-1 text-center font-semibold bg-gray-200"},rr={key:1,class:"min-w-full border-collapse text-xs"},ar=["colspan"],or=["disabled"],nr=["colspan"],lr=["disabled"],sr=["onUpdate:modelValue","disabled"],dr={class:"border p-1 bg-gray-300 text-center font-semibold sticky top-8 z-30"},ur=["onUpdate:modelValue","disabled"],ir={class:"border p-1 bg-gray-300 text-center font-semibold sticky top-8 z-30"},cr=["disabled"],br=["disabled"],pr={key:0},mr=["colspan"],vr={class:"border-none p-1 text-center bg-white"},gr={class:"border-none p-1 sticky left-0 bg-white z-40 w-36"},yr={class:"border-none p-1 sticky left-20 bg-white z-40 w-36"},fr={class:"border-none p-1 sticky left-40 bg-white z-40 w-36"},xr=["onUpdate:modelValue","max","disabled","data-row","data-col","onKeydown"],hr={class:"border p-1 text-center font-semibold bg-gray-200"},wr={class:"border p-1 text-center font-semibold bg-gray-200"},zr={class:"border p-1 text-center font-semibold bg-gray-200"},kr=["onUpdate:modelValue","max","disabled","data-row","data-col","onKeydown"],_r={class:"border p-1 text-center font-semibold bg-gray-200"},Cr={class:"border p-1 text-center font-semibold bg-gray-200"},qr={class:"border p-1 text-center font-semibold bg-gray-200"},Er=["onUpdate:modelValue","max","disabled","data-row","data-col","onKeydown"],Ar={class:"border p-1 text-center font-semibold bg-gray-200"},Fr={class:"border p-1 text-center font-semibold bg-gray-200"},Sr=["onUpdate:modelValue","max","disabled","data-row","data-col","onKeydown"],Nr={class:"border p-1 text-center font-semibold bg-gray-200"},Ur={class:"border p-1 text-center font-semibold bg-gray-200"},Ir={class:"border p-1 text-center font-semibold bg-gray-200"},Rr={class:"border p-1 text-center font-semibold bg-gray-200"},Vr={class:"border p-1 text-center font-semibold bg-gray-200"},Gr={class:"border p-1 text-center font-semibold bg-gray-200"},Mr={class:"border p-1 text-center font-semibold bg-gray-200"},Tr={class:"mt-4 text-right absolute bottom-2 right-2"},$r=["disabled"],Pr=["disabled"],Qr=["disabled"],Br=["disabled"],Lr={class:"absolute bottom-2 left-2 flex space-x-2"},Dr={__name:"GradeEntry",setup(Hr){const D=g("midterm"),o=g(!1),Ce=se(()=>4+(p.value+3)+(m.value+3)+3+5+3),{url:Be}=lt(),ce=new URLSearchParams(Be.split("?")[1]),Y=ce.get("subject")||"",Z=ce.get("course")||"",J=ce.get("year")||"",X=ce.get("section")||"",M=g(!0),p=g(5),m=g(10),U=g(Array(p.value).fill(0)),V=g(Array(m.value).fill(0)),P=g(100),H=g(100),K=g(100),C=g([]),fe=se(()=>U.value.reduce((t,e)=>t+(Number(e)||0),0)),xe=se(()=>V.value.reduce((t,e)=>t+(Number(e)||0),0)),he=se(()=>(Number(H.value)||0)+(Number(K.value)||0)),y=g(5),f=g(10),q=g([]),I=g(Array(y.value).fill(0)),R=g(Array(f.value).fill(0)),Q=g(100),B=g(100),we=se(()=>I.value.reduce((t,e)=>t+(Number(e)||0),0)),ze=se(()=>R.value.reduce((t,e)=>t+(Number(e)||0),0)),x=(t,e,a,n)=>{const l=e==="midterm"?C.value:q.value;if(!l||!l.length)return;const s=l.length-1;let u=t==="down"?a+1:a-1;if(u<0||u>s)return;const T=`input[data-section="${e}"][data-row="${u}"][data-col="${n}"]`,v=document.querySelector(T);v&&(v.focus(),typeof v.select=="function"&&v.select())},L=(t,e)=>{const a=Number(t),n=Number(e);return!n||Number.isNaN(n)||t===""||t===null||t===void 0?!1:!Number.isNaN(a)&&a>n},qe=(t,e)=>{var a;return L((a=t.quizzes)==null?void 0:a[e],U.value[e])},Ee=(t,e)=>{var a;return L((a=t.attendance)==null?void 0:a[e],V.value[e])},Ae=t=>L(t.performance,P.value),Fe=t=>L(t.prelimScore,H.value),Se=t=>L(t.midtermScore,K.value),Ne=(t,e)=>{var a;return L((a=t.quizzes)==null?void 0:a[e],I.value[e])},Ue=(t,e)=>{var a;return L((a=t.attendance)==null?void 0:a[e],R.value[e])},Ie=t=>L(t.performance,Q.value),Re=t=>L(t.finalExam,B.value),Ve=()=>{for(const t of C.value){for(let e=0;e<p.value;e++)if(qe(t,e))return!0;for(let e=0;e<m.value;e++)if(Ee(t,e))return!0;if(Ae(t)||Fe(t)||Se(t))return!0}return!1},Ge=()=>{for(const t of q.value){for(let e=0;e<y.value;e++)if(Ne(t,e))return!0;for(let e=0;e<f.value;e++)if(Ue(t,e))return!0;if(Ie(t)||Re(t))return!0}return!1};async function be({typeLabel:t,columnLabel:e,hasHps:a,hasScores:n}){if(!a&&!n)return!0;const l=[];a&&l.push("an HPS value"),n&&l.push("scores entered for at least one student");const s=l.join(" and ");return(await S.fire({title:`Delete ${e}?`,html:`
      <p class="text-sm text-gray-700">
        This ${t.toLowerCase()} already has <b>${s}</b>.<br>
        Deleting it will permanently remove all data in this column.
      </p>
      <p class="mt-2 text-xs text-red-600">
        This action cannot be undone.
      </p>
    `,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete column",cancelButtonText:"Cancel",confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",reverseButtons:!0})).isConfirmed?(await S.fire({title:"Are you absolutely sure?",html:`
      <p class="text-sm text-gray-700">
        All scores and the HPS for <b>${e}</b> will be lost for every student.
      </p>
    `,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete anyway",cancelButtonText:"Go back",confirmButtonColor:"#b91c1c",cancelButtonColor:"#6b7280",reverseButtons:!0})).isConfirmed:!1}const Le=()=>{p.value++,U.value.push(0),C.value.forEach(t=>{t.quizzes.push("")})},De=()=>{m.value++,V.value.push(0),C.value.forEach(t=>{t.attendance.push("")})},He=async()=>{if(p.value<=1)return;const t=p.value-1,e=!!Number(U.value[t]),a=C.value.some(l=>{var u;const s=(u=l.quizzes)==null?void 0:u[t];return s!==""&&s!==null&&s!==void 0&&!Number.isNaN(Number(s))});await be({typeLabel:"Quiz column",columnLabel:`Q${p.value}`,hasHps:e,hasScores:a})&&(p.value--,U.value.pop(),C.value.forEach(l=>{l.quizzes.pop()}))},Ke=async()=>{if(m.value<=1)return;const t=m.value-1,e=!!Number(V.value[t]),a=C.value.some(l=>{var u;const s=(u=l.attendance)==null?void 0:u[t];return s!==""&&s!==null&&s!==void 0&&!Number.isNaN(Number(s))});await be({typeLabel:"Attendance column",columnLabel:`A${m.value}`,hasHps:e,hasScores:a})&&(m.value--,V.value.pop(),C.value.forEach(l=>{l.attendance.pop()}))};function de(t){for(const e in t)if(Array.isArray(t[e]))t[e]=t[e].map(a=>{if(a===""||a===null)return a;const n=Number(a);return Number.isInteger(n)?parseInt(n):n});else if(typeof t[e]=="object"&&t[e]!==null)de(t[e]);else if(t[e]!==""&&t[e]!==null){const a=Number(t[e]);isNaN(a)||(t[e]=Number.isInteger(a)?parseInt(a):a)}}const Oe=()=>{y.value++,I.value.push(0),q.value.forEach(t=>{t.quizzes.push("")})},je=()=>{f.value++,R.value.push(0),q.value.forEach(t=>{t.attendance.push("")})},Ye=async()=>{if(y.value<=1)return;const t=y.value-1,e=!!Number(I.value[t]),a=q.value.some(l=>{var u;const s=(u=l.quizzes)==null?void 0:u[t];return s!==""&&s!==null&&s!==void 0&&!Number.isNaN(Number(s))});await be({typeLabel:"Final quiz column",columnLabel:`Q${y.value}`,hasHps:e,hasScores:a})&&(y.value--,I.value.pop(),q.value.forEach(l=>{l.quizzes.pop()}))},Ze=async()=>{if(f.value<=1)return;const t=f.value-1,e=!!Number(R.value[t]),a=q.value.some(l=>{var u;const s=(u=l.attendance)==null?void 0:u[t];return s!==""&&s!==null&&s!==void 0&&!Number.isNaN(Number(s))});await be({typeLabel:"Final attendance column",columnLabel:`A${f.value}`,hasHps:e,hasScores:a})&&(f.value--,R.value.pop(),q.value.forEach(l=>{l.attendance.pop()}))},Je=async()=>{var t,e,a,n,l,s,u,T;try{const v=await j.get("/session?source=gradeentry");if(pe.value=v.data.fullname,oe.value=v.data.level,ee.value=v.data.username,!pe.value||!oe.value||oe.value!=="teacher"){window.location.href="/";return}}catch{window.location.href="/";return}try{const v=`/grades/${encodeURIComponent(Y)}/${encodeURIComponent(Z)}/${encodeURIComponent(J)}/${encodeURIComponent(X)}`,me=await j.get(v,{params:{teacher_username:ee.value,ay_id:G.value.id}});o.value=!!me.data.submitted;const E=me.data;de(E.gradesData),de(E.gradeComponents),p.value=E.quizCount??5,m.value=E.attendanceCount??10;const ne=((t=E.gradeComponents)==null?void 0:t.quiz)||{};U.value=Array(p.value).fill(0).map((te,N)=>ne[N+1]??0);const $=((e=E.gradeComponents)==null?void 0:e.attendance)||{};V.value=Array(m.value).fill(0).map((te,N)=>$[N+1]??0),P.value=((n=(a=E.gradeComponents)==null?void 0:a.performance)==null?void 0:n[1])??0,H.value=((s=(l=E.gradeComponents)==null?void 0:l.exam)==null?void 0:s[1])??0,K.value=((T=(u=E.gradeComponents)==null?void 0:u.exam)==null?void 0:T[2])??0,C.value=E.students.map(te=>{var le,O,$e,Pe;const N=((le=E.gradesData)==null?void 0:le[te.studid])||{quizzes:[],attendance:[],performance:"",exams:[]},re=((O=E.summaryGrades)==null?void 0:O[te.studid])||{},ve=Array(p.value).fill("").map((nt,ue)=>{var ie;return((ie=N.quizzes)==null?void 0:ie[ue])!==void 0?N.quizzes[ue]:""}),_e=Array(m.value).fill("").map((nt,ue)=>{var ie;return((ie=N.attendance)==null?void 0:ie[ue])!==void 0?N.attendance[ue]:""});return{...te,quizzes:ve,attendance:_e,performance:N.performance??"",prelimScore:(($e=N.exams)==null?void 0:$e[0])??"",midtermScore:((Pe=N.exams)==null?void 0:Pe[1])??"",midterm:re.midterm??"",final:re.final??"",overall:re.overall??"",submitted:re.submitted??0,totals:{quiz:0,attendance:0,exam:0},equivs:{quiz:0,attendance:0,performance:0,exam:0},percents:{quiz:0,attendance:0,performance:0,exam:0},midtermGrade:0,equivalent:0,remarks:""}})}catch(v){console.error("Failed to fetch grades:",v)}finally{}},Xe=async()=>{var t,e,a,n,l,s;try{const u=await j.get("/session?source=gradeentry");if(pe.value=u.data.fullname,oe.value=u.data.level,ee.value=u.data.username,!pe.value||!oe.value||oe.value!=="teacher"){window.location.href="/";return}}catch{window.location.href="/";return}try{const u=`/finalgrades/${encodeURIComponent(Y)}/${encodeURIComponent(Z)}/${encodeURIComponent(J)}/${encodeURIComponent(X)}`,v=(await j.get(u,{params:{teacher_username:ee.value,ay_id:G.value.id}})).data;de(v.gradesData),de(v.gradeComponents),y.value=v.quizCount??5,f.value=v.attendanceCount??10;const me=((t=v.gradeComponents)==null?void 0:t.quiz)||{};I.value=Array(y.value).fill(0).map((ne,$)=>me[$+1]??0);const E=((e=v.gradeComponents)==null?void 0:e.attendance)||{};R.value=Array(f.value).fill(0).map((ne,$)=>E[$+1]??0),Q.value=((n=(a=v.gradeComponents)==null?void 0:a.performance)==null?void 0:n[1])??0,B.value=((s=(l=v.gradeComponents)==null?void 0:l.exam)==null?void 0:s[1])??0,q.value=v.students.map(ne=>{var re,ve;const $=((re=v.gradesData)==null?void 0:re[ne.studid])||{quizzes:[],attendance:[],performance:"",exams:[]},te=Array(y.value).fill("").map((_e,le)=>{var O;return((O=$.quizzes)==null?void 0:O[le])??""}),N=Array(f.value).fill("").map((_e,le)=>{var O;return((O=$.attendance)==null?void 0:O[le])??""});return{...ne,quizzes:te,attendance:N,performance:$.performance??"",finalExam:((ve=$.exams)==null?void 0:ve[0])??"",totals:{quiz:0,attendance:0,exam:0},equivs:{quiz:0,attendance:0,performance:0,exam:0},percents:{quiz:0,attendance:0,performance:0,exam:0},finalGrade:0,equivalent:0,remarks:"Failed"}})}catch(u){console.error("Failed to fetch final grades:",u)}finally{}};function W(t){const e=C.value.find(a=>a.studid===t);return e&&e.midtermGrade||0}function ae(t){return t>94.45?1:t>93.45?1.1:t>92.45?1.2:t>91.45?1.3:t>90.45?1.4:t>89.45?1.5:t>88.45?1.6:t>87.45?1.7:t>86.45?1.8:t>85.45?1.9:t>84.45?2:t>83.45?2.1:t>82.45?2.2:t>81.45?2.3:t>80.45?2.4:t>79.45?2.5:t>78.45?2.6:t>77.45?2.7:t>76.45?2.8:t>75.45?2.9:t>74.45?3:t>73.45?3.1:t>72.45?3.2:t>71.45?3.3:t>70.45?3.4:(t>69.45,3.5)}const We=()=>{C.value.forEach(t=>{const e=t.quizzes.reduce((u,T)=>u+(Number(T)||0),0);t.totals.quiz=e,t.equivs.quiz=fe.value?e*40/fe.value+60:0,t.percents.quiz=t.equivs.quiz*.3;const a=t.attendance.reduce((u,T)=>u+(Number(T)||0),0);t.totals.attendance=a,t.equivs.attendance=xe.value?a*100/xe.value:0,t.percents.attendance=t.equivs.attendance*.15,t.totals.performance=Number(t.performance)||0,t.equivs.performance=P.value?t.totals.performance*50/P.value+50:0,t.percents.performance=t.equivs.performance*.15;const n=Number(t.prelimScore)||0,l=Number(t.midtermScore)||0,s=n+l;t.totals.exam=s,t.equivs.exam=he.value?s*40/he.value+60:0,t.percents.exam=t.equivs.exam*.4,t.midtermGrade=(t.percents.quiz||0)+(t.percents.attendance||0)+(t.percents.performance||0)+(t.percents.exam||0),t.equivalent=Number(ae(t.midtermGrade).toFixed(1)),t.remarks=t.midtermGrade>=75?"Passed":"Failed"})},et=()=>{q.value.forEach(t=>{const e=t.quizzes.reduce((l,s)=>l+(Number(s)||0),0);t.totals.quiz=e,t.equivs.quiz=we.value?e*40/we.value+60:0,t.percents.quiz=t.equivs.quiz*.3;const a=t.attendance.reduce((l,s)=>l+(Number(s)||0),0);t.totals.attendance=a,t.equivs.attendance=ze.value?a*100/ze.value:0,t.percents.attendance=t.equivs.attendance*.15,t.totals.performance=Number(t.performance)||0,t.equivs.performance=Q.value?t.totals.performance*40/Q.value+60:0,t.percents.performance=t.equivs.performance*.15;const n=Number(t.finalExam)||0;t.totals.exam=n,t.equivs.exam=B.value?n*40/B.value+60:0,t.percents.exam=t.equivs.exam*.4,t.finalGrade=(t.percents.quiz||0)+(t.percents.attendance||0)+(t.percents.performance||0)+(t.percents.exam||0),t.equivalent=Number(ae(t.finalGrade).toFixed(1)),t.remarks=t.finalGrade>=75?"Passed":"Failed"})};Qe([C,U,V,P,H,K],We,{deep:!0,immediate:!0}),Qe([q,I,R,Q,B],et,{deep:!0,immediate:!0});const tt=async()=>{if(Ve()||Ge()){await S.fire({icon:"error",title:"Scores Exceed HPS",html:`
        <p class="text-sm text-gray-700">
          Some scores are higher than their column HPS.<br>
          Please fix the <span class="font-semibold text-red-600">red-highlighted cells</span> before submitting.
        </p>
      `,confirmButtonColor:"#ef4444"});return}if((await S.fire({title:"Submit Grades?",html:`
      <p class="text-sm text-gray-700">
        Once submitted, <b>grades cannot be edited or modified</b>.<br>
        Are you sure you want to finalize and submit all grades for this class?
      </p>
    `,icon:"warning",showCancelButton:!0,confirmButtonText:"Submit",cancelButtonText:"Cancel",confirmButtonColor:"#2563eb",cancelButtonColor:"#6b7280",reverseButtons:!0})).isConfirmed)try{await j.post("/grades/submit",{teacher_username:ee.value,subject_code:Y,course:Z,year:J,section:X,ay_id:G.value.id}),o.value=!0,await S.fire({icon:"success",title:"Grades Submitted!",text:"All grades have been marked as submitted and are now locked.",confirmButtonColor:"#2563eb"})}catch(e){console.error(e),S.fire({icon:"error",title:"Submission Failed!",text:"An error occurred while submitting grades. Please try again later.",confirmButtonColor:"#ef4444"})}finally{M.value=!1}},Me=async()=>{if(Ve()){await S.fire({icon:"error",title:"Scores Exceed HPS",html:`
        <p class="text-sm text-gray-700">
          At least one student has a score that is higher than the HPS for its column.<br>
          Please review the <span class="font-semibold text-red-600">red-highlighted cells</span> before saving.
        </p>
      `,confirmButtonColor:"#ef4444"});return}try{const t=[];U.value.forEach((l,s)=>{t.push({component_type:"quiz",component_index:s+1,hps:Number(l)||0})}),V.value.forEach((l,s)=>{t.push({component_type:"attendance",component_index:s+1,hps:Number(l)||0})}),t.push({component_type:"performance",component_index:1,hps:Number(P.value)||0}),t.push({component_type:"exam",component_index:1,hps:Number(H.value)||0}),t.push({component_type:"exam",component_index:2,hps:Number(K.value)||0});const e=[];C.value.forEach(l=>{l.quizzes.forEach((s,u)=>{e.push({student_id:l.studid,component_type:"quiz",component_index:u+1,score:s})}),l.attendance.forEach((s,u)=>{e.push({student_id:l.studid,component_type:"attendance",component_index:u+1,score:s})}),e.push({student_id:l.studid,component_type:"performance",component_index:1,score:l.performance}),e.push({student_id:l.studid,component_type:"exam",component_index:1,score:l.prelimScore}),e.push({student_id:l.studid,component_type:"exam",component_index:2,score:l.midtermScore})});const a=C.value.map(l=>({student_id:l.studid,midterm:Number(l.equivalent)||0}));await j.post("/grades/save",{teacher_username:ee.value,subject_code:Y,course:Z,year:J,section:X,ay_id:G.value.id,gradeComponents:t,gradesData:e,gradesSummary:a}),await S.fire({icon:"success",title:"Midterm Grades Saved!",text:"All midterm grades were successfully saved.",confirmButtonColor:"#2563eb"})}catch(t){console.error("Failed to save grades:",t),S.fire({icon:"error",title:"Failed to Save!",text:"There was an error saving midterm grades. Please try again.",confirmButtonColor:"#ef4444"})}},Te=async()=>{if(Ge()){await S.fire({icon:"error",title:"Scores Exceed HPS",html:`
        <p class="text-sm text-gray-700">
          At least one student has a score that is higher than the HPS for its column.<br>
          Please review the <span class="font-semibold text-red-600">red-highlighted cells</span> before saving.
        </p>
      `,confirmButtonColor:"#ef4444"});return}try{const t=[];I.value.forEach((n,l)=>{t.push({component_type:"quiz",component_index:l+1,hps:Number(n)||0})}),R.value.forEach((n,l)=>{t.push({component_type:"attendance",component_index:l+1,hps:Number(n)||0})}),t.push({component_type:"performance",component_index:1,hps:Number(Q.value)||0}),t.push({component_type:"exam",component_index:1,hps:Number(B.value)||0});const e=[];q.value.forEach(n=>{n.quizzes.forEach((l,s)=>{e.push({student_id:n.studid,component_type:"quiz",component_index:s+1,score:l})}),n.attendance.forEach((l,s)=>{e.push({student_id:n.studid,component_type:"attendance",component_index:s+1,score:l})}),e.push({student_id:n.studid,component_type:"performance",component_index:1,score:n.performance}),e.push({student_id:n.studid,component_type:"exam",component_index:1,score:n.finalExam})});const a=q.value.map(n=>{const l=W(n.studid),s=ae(Number(n.finalGrade))||0,u=(ae(l)*.3+s*.7).toFixed(2);return{student_id:n.studid,final:s,overall:u}});await j.post("/finalgrades/save",{teacher_username:ee.value,subject_code:Y,course:Z,year:J,section:X,ay_id:G.value.id,gradeComponents:t,gradesData:e,gradesSummary:a,term:"final"}),await S.fire({icon:"success",title:"Final Grades Saved!",text:"All final grades were successfully saved.",confirmButtonColor:"#2563eb"})}catch(t){console.error("Failed to save final grades:",t),S.fire({icon:"error",title:"Save Failed!",text:"There was an error saving final grades. Please try again.",confirmButtonColor:"#ef4444"})}},rt=async()=>{try{await Promise.all([Me(),Te()]),await S.fire({icon:"success",title:"All Grades Saved!",text:"Both Midterm and Final Grades were successfully saved.",confirmButtonColor:"#2563eb"})}catch(t){console.error("Failed to save both grade sets:",t),S.fire({icon:"error",title:"Save Failed!",text:"Something went wrong while saving both grade sets.",confirmButtonColor:"#ef4444"})}finally{M.value=!1}},ke=g(null);function at(){ke.value&&(document.fullscreenElement?document.exitFullscreen():ke.value.requestFullscreen().catch(t=>{console.error(`Error attempting fullscreen: ${t.message}`)}))}const G=g({id:null,academicyear:"",semester:""}),pe=g(""),oe=g(""),ee=g(""),ot=async()=>{try{const t=await j.get("/api/active-ay");t.data&&(G.value=t.data)}catch(t){console.error("Failed to fetch active academic year",t)}};return st(async()=>{var t;await ot(),Y&&Z&&J&&X&&((t=G.value)!=null&&t.id)&&(M.value=!0,await Je(),M.value=!1,await Xe())}),(t,e)=>(b(),c("div",ut,[r("div",it,[r("div",ct,[r("div",bt,"Subject Code: "+d(ge(Y)),1),e[7]||(e[7]=r("div",{class:"text-md font-bold"},null,-1))]),r("div",pt,[r("div",mt,"Course & Year: "+d(ge(Z))+" - "+d(ge(J)),1),r("div",vt,"Section: "+d(ge(X)),1)]),r("div",gt,[r("div",yt," Semester: "+d(G.value.semester==="1"?"First Semester":G.value.semester==="2"?"Second Semester":G.value.semester==="3"?"Summer":"Loading..."),1),r("div",ft,"Academic Year: "+d(G.value.academicyear),1)])]),r("div",{class:"overflow-auto border rounded-lg max-h-[535px]",ref_key:"gradesTable",ref:ke},[D.value==="midterm"?(b(),c("table",xt,[r("thead",null,[r("tr",null,[e[10]||(e[10]=r("th",{rowspan:"3",class:"bg-gray-300 border p-2"},"No.",-1)),e[11]||(e[11]=r("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-0 top-0 z-40 w-36"},"LASTNAME",-1)),e[12]||(e[12]=r("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-20 top-0 z-40 w-36"},"FIRSTNAME",-1)),e[13]||(e[13]=r("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-40 top-0 z-40 w-36"},"MIDDLENAME",-1)),r("th",{colspan:p.value+3,class:"bg-gray-300 border p-2"},[e[8]||(e[8]=ye(" QUIZZES ")),o.value?_("",!0):(b(),c("button",{key:0,onClick:Le,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Quiz Column"}," + ")),o.value?_("",!0):(b(),c("button",{key:1,onClick:He,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Quiz Column",disabled:p.value<=1}," - ",8,wt))],8,ht),r("th",{colspan:m.value+3,class:"bg-gray-300 border p-2"},[e[9]||(e[9]=ye(" ATTENDANCE ")),o.value?_("",!0):(b(),c("button",{key:0,onClick:De,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Attendance Column"}," + ")),o.value?_("",!0):(b(),c("button",{key:1,onClick:Ke,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Attendance Column",disabled:m.value<=1}," - ",8,kt))],8,zt),e[14]||(e[14]=r("th",{colspan:"3",class:"bg-gray-300 border p-2"},"PERFORMANCE",-1)),e[15]||(e[15]=r("th",{colspan:"5",class:"bg-gray-300 border p-2"},"MAJOR EXAM",-1)),e[16]||(e[16]=r("th",{colspan:"3",class:"bg-gray-300 border p-2"},"PRELIM",-1))]),r("tr",null,[(b(!0),c(A,null,F(p.value,a=>(b(),c("th",{key:"q-label-"+a,class:i(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])}," Q"+d(a),3))),128)),e[17]||(e[17]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[18]||(e[18]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[19]||(e[19]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"30%",-1)),(b(!0),c(A,null,F(m.value,a=>(b(),c("th",{key:"a-label-"+a,class:i(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])}," A"+d(a),3))),128)),e[20]||(e[20]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[21]||(e[21]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[22]||(e[22]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"15%",-1)),r("th",{class:i(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"100",2),e[23]||(e[23]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[24]||(e[24]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"15%",-1)),r("th",{class:i(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"PRELIM SCORE",2),r("th",{class:i(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"MIDTERM SCORE",2),e[25]||(e[25]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[26]||(e[26]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[27]||(e[27]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"40%",-1)),e[28]||(e[28]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"MIDTERM GRADE",-1)),e[29]||(e[29]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIVALENT",-1)),e[30]||(e[30]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"REMARKS",-1))]),r("tr",null,[(b(!0),c(A,null,F(U.value,(a,n)=>(b(),c("td",{key:"hps-quiz-"+n,class:i(["border p-1 bg-blue-200 sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[h(r("input",{"onUpdate:modelValue":l=>U.value[n]=l,type:"number",min:"0",class:i(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,_t),[[w,U.value[n],void 0,{number:!0}]])],2))),128)),r("td",Ct,d(fe.value.toFixed(0)),1),e[31]||(e[31]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[32]||(e[32]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"30",-1)),(b(!0),c(A,null,F(V.value,(a,n)=>(b(),c("td",{key:"hps-attendance-"+n,class:i(["border p-1 bg-blue-200 sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[h(r("input",{"onUpdate:modelValue":l=>V.value[n]=l,type:"number",min:"0",class:i(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,qt),[[w,V.value[n],void 0,{number:!0}]])],2))),128)),r("td",Et,d(xe.value.toFixed(0)),1),e[33]||(e[33]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[34]||(e[34]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"15",-1)),r("td",{class:i(["border p-1 bg-blue-200 text-center sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[h(r("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>P.value=a),type:"number",min:"0",class:i(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,At),[[w,P.value,void 0,{number:!0}]])],2),e[35]||(e[35]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[36]||(e[36]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"15",-1)),r("td",{class:i(["border p-1 bg-blue-200 text-center sticky top-8 z-30",{"bg-gray-300 ":o.value,"bg-blue-200":!o.value}])},[h(r("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>H.value=a),type:"number",min:"0",class:i(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,Ft),[[w,H.value,void 0,{number:!0}]])],2),r("td",{class:i(["border p-1 bg-blue-200 text-center sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[h(r("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>K.value=a),type:"number",min:"0",class:i(["w-12 border px-1 text-center bg-blue-200 sticky top-8 z-30 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,St),[[w,K.value,void 0,{number:!0}]])],2),r("td",Nt,d(he.value.toFixed(0)),1),e[37]||(e[37]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[38]||(e[38]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"40",-1)),e[39]||(e[39]=r("td",{colspan:"2",class:"border p-1 bg-gray-300 sticky top-8 z-30"},null,-1)),e[40]||(e[40]=r("td",{colspan:"1",class:"border p-1 bg-gray-300 sticky top-8 z-30"},null,-1))])]),r("tbody",null,[M.value?(b(),c("tr",Ut,[r("td",{colspan:Ce.value,class:"text-center p-4"},"Loading student data...",8,It)])):_("",!0),(b(!0),c(A,null,F(C.value,(a,n)=>(b(),c("tr",{key:a.id},[r("td",Rt,d(n+1),1),r("td",Vt,d(a.lname),1),r("td",Gt,d(a.fname),1),r("td",Mt,d(a.mname),1),(b(!0),c(A,null,F(a.quizzes,(l,s)=>(b(),c("td",{key:"quiz-"+n+"-"+s,class:i(["border p-1",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[h(r("input",{"onUpdate:modelValue":u=>a.quizzes[s]=u,type:"number",min:"0",max:U.value[s]||100,disabled:o.value,"data-section":"midterm","data-row":n,"data-col":s,onKeydown:[z(k(u=>x("down","midterm",n,s),["prevent"]),["enter"]),z(k(u=>x("up","midterm",n,s),["shift","prevent"]),["enter"])],class:i(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",qe(a,s)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Tt),[[w,a.quizzes[s],void 0,{number:!0}]])],2))),128)),r("td",$t,d(a.totals.quiz.toFixed(0)),1),r("td",Pt,d(a.equivs.quiz.toFixed(0)),1),r("td",Qt,d(a.percents.quiz.toFixed(0)),1),(b(!0),c(A,null,F(a.attendance,(l,s)=>(b(),c("td",{key:"att-"+n+"-"+s,class:i(["border p-1 bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[h(r("input",{"onUpdate:modelValue":u=>a.attendance[s]=u,type:"number",disabled:o.value,"data-section":"midterm","data-row":n,"data-col":p.value+s,onKeydown:[z(k(u=>x("down","midterm",n,p.value+s),["prevent"]),["enter"]),z(k(u=>x("up","midterm",n,p.value+s),["shift","prevent"]),["enter"])],class:i(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Ee(a,s)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Bt),[[w,a.attendance[s],void 0,{number:!0}]])],2))),128)),r("td",Lt,d(a.totals.attendance.toFixed(0)),1),r("td",Dt,d(a.equivs.attendance.toFixed(0)),1),r("td",Ht,d(a.percents.attendance.toFixed(0)),1),r("td",{class:i(["border p-1 text-center bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[h(r("input",{"onUpdate:modelValue":l=>a.performance=l,type:"number",min:"0",max:P.value,disabled:o.value,"data-section":"midterm","data-row":n,"data-col":p.value+m.value,onKeydown:[z(k(l=>x("down","midterm",n,p.value+m.value),["prevent"]),["enter"]),z(k(l=>x("up","midterm",n,p.value+m.value),["shift","prevent"]),["enter"])],class:i(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Ae(a)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Kt),[[w,a.performance,void 0,{number:!0}]])],2),r("td",Ot,d(a.equivs.performance.toFixed(0)),1),r("td",jt,d(a.percents.performance.toFixed(0)),1),r("td",{class:i(["border p-1 text-center bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[h(r("input",{"onUpdate:modelValue":l=>a.prelimScore=l,type:"number",min:"0",max:H.value,disabled:o.value,"data-section":"midterm","data-row":n,"data-col":p.value+m.value+1,onKeydown:[z(k(l=>x("down","midterm",n,p.value+m.value+1),["prevent"]),["enter"]),z(k(l=>x("up","midterm",n,p.value+m.value+1),["shift","prevent"]),["enter"])],class:i(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Fe(a)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Yt),[[w,a.prelimScore,void 0,{number:!0}]])],2),r("td",{class:i(["border p-1 text-center bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[h(r("input",{"onUpdate:modelValue":l=>a.midtermScore=l,type:"number",min:"0",max:K.value,disabled:o.value,"data-section":"midterm","data-row":n,"data-col":p.value+m.value+2,onKeydown:[z(k(l=>x("down","midterm",n,p.value+m.value+2),["prevent"]),["enter"]),z(k(l=>x("up","midterm",n,p.value+m.value+2),["shift","prevent"]),["enter"])],class:i(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Se(a)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Zt),[[w,a.midtermScore,void 0,{number:!0}]])],2),r("td",Jt,d(a.totals.exam.toFixed(0)),1),r("td",Xt,d(a.equivs.exam.toFixed(0)),1),r("td",Wt,d(a.percents.exam.toFixed(0)),1),r("td",er,d(a.midtermGrade.toFixed(0)),1),r("td",tr,d(a.equivalent.toFixed(1)),1),r("td",{class:i(["border p-1 text-center font-semibold",{"text-green-700 bg-green-100":a.remarks==="Passed","text-red-700 bg-red-100":a.remarks==="Failed"}])},d(a.remarks),3)]))),128))])])):_("",!0),D.value==="finals"?(b(),c("table",rr,[r("thead",null,[r("tr",null,[e[43]||(e[43]=r("th",{rowspan:"3",class:"bg-gray-300 border p-2"},"No.",-1)),e[44]||(e[44]=r("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-0 top-0 z-40 w-36"},"LASTNAME",-1)),e[45]||(e[45]=r("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-20 top-0 z-40 w-36"},"FIRSTNAME",-1)),e[46]||(e[46]=r("th",{rowspan:"3",class:"bg-gray-300 border-none p-2 sticky left-40 top-0 z-40 w-36"},"MIDDLENAME",-1)),r("th",{colspan:y.value+3,class:"bg-gray-300 border p-2"},[e[41]||(e[41]=ye(" QUIZZES ")),o.value?_("",!0):(b(),c("button",{key:0,onClick:Oe,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Quiz Column"},"+")),o.value?_("",!0):(b(),c("button",{key:1,onClick:Ye,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Quiz Column",disabled:y.value<=1},"-",8,or))],8,ar),r("th",{colspan:f.value+3,class:"bg-gray-300 border p-2"},[e[42]||(e[42]=ye(" ATTENDANCE ")),o.value?_("",!0):(b(),c("button",{key:0,onClick:je,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Attendance Column"},"+")),o.value?_("",!0):(b(),c("button",{key:1,onClick:Ze,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Attendance Column",disabled:f.value<=1},"-",8,lr))],8,nr),e[47]||(e[47]=r("th",{colspan:"3",class:"bg-gray-300 border p-2"},"PERFORMANCE",-1)),e[48]||(e[48]=r("th",{colspan:"3",class:"bg-gray-300 border p-2"},"MAJOR EXAM",-1)),e[49]||(e[49]=r("th",{colspan:"3",class:"bg-gray-300 border p-2"},"FINAL SUMMARY",-1)),e[50]||(e[50]=r("th",{colspan:"4",class:"bg-gray-300 border p-2"},"MIDTERM REFERENCE",-1))]),r("tr",null,[(b(!0),c(A,null,F(y.value,a=>(b(),c("th",{key:"fq-label-"+a,class:i(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"Q"+d(a),3))),128)),e[51]||(e[51]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[52]||(e[52]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[53]||(e[53]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"30%",-1)),(b(!0),c(A,null,F(f.value,a=>(b(),c("th",{key:"fa-label-"+a,class:i(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"A"+d(a),3))),128)),e[54]||(e[54]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[55]||(e[55]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[56]||(e[56]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"15%",-1)),r("th",{class:i(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"100",2),e[57]||(e[57]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[58]||(e[58]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"15%",-1)),r("th",{class:i(["bg-blue-200 border p-1 text-center sticky top-0 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},"FINAL SCORE",2),e[59]||(e[59]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[60]||(e[60]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"40%",-1)),e[61]||(e[61]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"FINAL GRADE",-1)),e[62]||(e[62]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIVALENT",-1)),e[63]||(e[63]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"REMARKS",-1)),e[64]||(e[64]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"MIDTERM GRADE",-1)),e[65]||(e[65]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"FINAL RATING",-1)),e[66]||(e[66]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"EQUIVALENT",-1)),e[67]||(e[67]=r("th",{class:"bg-gray-300 border p-1 text-center sticky top-0 z-30"},"REMARKS",-1))]),r("tr",null,[(b(!0),c(A,null,F(I.value,(a,n)=>(b(),c("td",{key:"fhps-quiz-"+n,class:i(["border p-1 bg-blue-200 sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[h(r("input",{"onUpdate:modelValue":l=>I.value[n]=l,type:"number",min:"0",class:i(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,sr),[[w,I.value[n],void 0,{number:!0}]])],2))),128)),r("td",dr,d(we.value.toFixed(0)),1),e[68]||(e[68]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[69]||(e[69]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"30",-1)),(b(!0),c(A,null,F(R.value,(a,n)=>(b(),c("td",{key:"fhps-att-"+n,class:i(["border p-1 bg-blue-200 sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[h(r("input",{"onUpdate:modelValue":l=>R.value[n]=l,type:"number",min:"0",class:i(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,ur),[[w,R.value[n],void 0,{number:!0}]])],2))),128)),r("td",ir,d(ze.value.toFixed(0)),1),e[70]||(e[70]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[71]||(e[71]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"15",-1)),r("td",{class:i(["border p-1 bg-blue-200 text-center sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[h(r("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>Q.value=a),type:"number",min:"0",class:i(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,cr),[[w,Q.value,void 0,{number:!0}]])],2),e[72]||(e[72]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[73]||(e[73]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"15",-1)),r("td",{class:i(["border p-1 bg-blue-200 text-center sticky top-8 z-30",{"bg-gray-300":o.value,"bg-blue-200":!o.value}])},[h(r("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>B.value=a),type:"number",min:"0",class:i(["w-12 border px-1 text-center bg-blue-200 score-input",{"bg-gray-300 cursor-not-allowed border-none focus:border-none":o.value,"bg-blue-200":!o.value}]),disabled:o.value},null,10,br),[[w,B.value,void 0,{number:!0}]])],2),e[74]||(e[74]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"100",-1)),e[75]||(e[75]=r("td",{class:"border p-1 bg-gray-300 text-center sticky top-8 z-30"},"40",-1)),e[76]||(e[76]=r("td",{colspan:"7",class:"border p-1 bg-gray-300 sticky top-8 z-30"},null,-1))])]),r("tbody",null,[M.value?(b(),c("tr",pr,[r("td",{colspan:Ce.value,class:"text-center p-4"},"Loading student data...",8,mr)])):_("",!0),(b(!0),c(A,null,F(q.value,(a,n)=>(b(),c("tr",{key:a.id},[r("td",vr,d(n+1),1),r("td",gr,d(a.lname),1),r("td",yr,d(a.fname),1),r("td",fr,d(a.mname),1),(b(!0),c(A,null,F(a.quizzes,(l,s)=>(b(),c("td",{key:"fquiz-"+n+"-"+s,class:i(["border p-1 bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[h(r("input",{"onUpdate:modelValue":u=>a.quizzes[s]=u,type:"number",min:"0",max:I.value[s]||100,disabled:o.value,"data-section":"finals","data-row":n,"data-col":s,onKeydown:[z(k(u=>x("down","finals",n,s),["prevent"]),["enter"]),z(k(u=>x("up","finals",n,s),["shift","prevent"]),["enter"])],class:i(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Ne(a,s)?"bg-red-200 border-red-500 text-red-800":""])},null,42,xr),[[w,a.quizzes[s],void 0,{number:!0}]])],2))),128)),r("td",hr,d(a.totals.quiz.toFixed(0)),1),r("td",wr,d(a.equivs.quiz.toFixed(0)),1),r("td",zr,d(a.percents.quiz.toFixed(0)),1),(b(!0),c(A,null,F(a.attendance,(l,s)=>(b(),c("td",{key:"fatt-"+n+"-"+s,class:i(["border p-1 bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[h(r("input",{"onUpdate:modelValue":u=>a.attendance[s]=u,type:"number",min:"0",max:R.value[s]||1,disabled:o.value,"data-section":"finals","data-row":n,"data-col":y.value+s,onKeydown:[z(k(u=>x("down","finals",n,y.value+s),["prevent"]),["enter"]),z(k(u=>x("up","finals",n,y.value+s),["shift","prevent"]),["enter"])],class:i(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Ue(a,s)?"bg-red-200 border-red-500 text-red-800":""])},null,42,kr),[[w,a.attendance[s],void 0,{number:!0}]])],2))),128)),r("td",_r,d(a.totals.attendance.toFixed(0)),1),r("td",Cr,d(a.equivs.attendance.toFixed(0)),1),r("td",qr,d(a.percents.attendance.toFixed(0)),1),r("td",{class:i(["border p-1 text-center bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[h(r("input",{"onUpdate:modelValue":l=>a.performance=l,type:"number",min:"0",max:Q.value,disabled:o.value,"data-section":"finals","data-row":n,"data-col":y.value+f.value,onKeydown:[z(k(l=>x("down","finals",n,y.value+f.value),["prevent"]),["enter"]),z(k(l=>x("up","finals",n,y.value+f.value),["shift","prevent"]),["enter"])],class:i(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Ie(a)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Er),[[w,a.performance,void 0,{number:!0}]])],2),r("td",Ar,d(a.equivs.performance.toFixed(0)),1),r("td",Fr,d(a.percents.performance.toFixed(0)),1),r("td",{class:i(["border p-1 text-center bg-blue-100",{"bg-gray-200":o.value,"bg-blue-100":!o.value}])},[h(r("input",{"onUpdate:modelValue":l=>a.finalExam=l,type:"number",min:"0",max:B.value,disabled:o.value,"data-section":"finals","data-row":n,"data-col":y.value+f.value+1,onKeydown:[z(k(l=>x("down","finals",n,y.value+f.value+1),["prevent"]),["enter"]),z(k(l=>x("up","finals",n,y.value+f.value+1),["shift","prevent"]),["enter"])],class:i(["w-12 border px-1 text-center score-input",o.value?"bg-gray-200 cursor-not-allowed border-none focus:border-none":"bg-blue-100",Re(a)?"bg-red-200 border-red-500 text-red-800":""])},null,42,Sr),[[w,a.finalExam,void 0,{number:!0}]])],2),r("td",Nr,d(a.equivs.exam.toFixed(0)),1),r("td",Ur,d(a.percents.exam.toFixed(0)),1),r("td",Ir,d(a.finalGrade.toFixed(0)),1),r("td",Rr,d(a.equivalent.toFixed(1)),1),r("td",{class:i(["border p-1 text-center font-semibold bg-gray-200",{"text-green-700 bg-green-100":a.remarks==="Passed","text-red-700 bg-red-100":a.remarks==="Failed"}])},d(a.remarks),3),r("td",Vr,d(W(a.studid).toFixed(0)),1),r("td",Gr,d((W(a.studid)*.3+a.finalGrade*.7).toFixed(0)),1),r("td",Mr,d((ae(W(a.studid))*.3+ae(a.finalGrade)*.7).toFixed(1)),1),r("td",{class:i(["border p-1 text-center font-semibold bg-gray-200",{"text-green-700 bg-green-100":W(a.studid)*.3+a.finalGrade*.7>=75,"text-red-700 bg-red-100":W(a.studid)*.3+a.finalGrade*.7<75}])},d(W(a.studid)*.3+a.finalGrade*.7>=75?"Passed":"Failed"),3)]))),128))])])):_("",!0)],512),r("div",Tr,[o.value?_("",!0):(b(),c("button",{key:0,onClick:Me,disabled:M.value,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded transition mr-3"}," Save Midterm Grades ",8,$r)),o.value?_("",!0):(b(),c("button",{key:1,onClick:Te,disabled:M.value,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded transition mr-3"}," Save Final Grades ",8,Pr)),o.value?_("",!0):(b(),c("button",{key:2,onClick:rt,disabled:M.value,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded transition mr-3"}," Save All Grades ",8,Qr)),o.value?_("",!0):(b(),c("button",{key:3,onClick:tt,disabled:M.value,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded transition"}," Mark as Submitted ",8,Br))]),r("div",Lr,[r("button",{onClick:e[5]||(e[5]=a=>D.value="midterm"),class:i([{"bg-gray-300 text-black":D.value==="midterm","bg-gray-100 text-gray-600":D.value!=="midterm"},"px-3 py-1 rounded border"])}," Prelim-Midterm ",2),r("button",{onClick:e[6]||(e[6]=a=>D.value="finals"),class:i([{"bg-gray-300 text-black":D.value==="finals","bg-gray-100 text-gray-600":D.value!=="finals"},"px-3 py-1 rounded border"])}," Finals ",2),r("button",{onClick:at,class:"fullscreen-btn mr-5 px-2 py-2"}," â›¶ Fullscreen ")])]))}},Yr=dt(Dr,[["__scopeId","data-v-ee1d3e0c"]]);export{Yr as default};
