import{r,c as p,o as L,b as S,d as a,w as V,g as o,e as t,k as b,t as l,F as h,h as f,i as D,a as v}from"./app-BM-D2KsP.js";import{_ as E}from"./DashboardLayout-BXprZFQe.js";import"./sweetalert2.esm.all-BQIkj5Wb.js";const F={key:0,class:"flex justify-center py-10"},N={key:1},T={class:"bg-white rounded shadow p-4 mb-4 flex flex-wrap gap-4 justify-between items-center"},U={class:"text-sm text-gray-700"},O={class:"font-semibold"},R={class:"text-xs text-gray-500 mt-1"},M={class:"font-semibold"},P={class:"font-semibold"},W={class:"text-center md:text-xl text-lg font-semibold text-mccblue mb-2"},z={class:"text-center md:text-lg text-md font-semibold text-mccblue py-2"},A={class:"min-w-full bg-white rounded-b-lg overflow-hidden"},H={class:"py-2 px-4 text-center font-medium md:text-base text-xs"},$={class:"py-2 px-4 text-center md:text-base text-xs"},q={class:"py-2 px-4 text-center md:text-base text-xs"},I={class:"py-2 px-4 text-center md:text-base text-xs"},J={key:0},K={key:1,class:"text-gray-400"},Q={key:0},et={__name:"ViewGrades",setup(X){const u=r(""),x=r(""),y=r(!0),d=r(null),m=r({}),k=async()=>{try{const e=await v.get("/session");u.value=e.data.fullname,x.value=e.data.level,username.value=e.data.username,(!u.value||!x.value)&&(window.location.href="/")}catch{window.location.href="/"}},j=async()=>{const e=await v.get("/student/viewgrades/data");d.value=e.data.curriculum,m.value=e.data.grouped},w=p(()=>{const e=[];return Object.values(m.value).forEach(s=>{Object.values(s).forEach(n=>{n.forEach(i=>e.push(i))})}),e}),C=p(()=>w.value.length),B=p(()=>w.value.filter(e=>e.grade!==null&&e.grade!==void 0&&e.grade!=="").length),G=async()=>{try{const e=await v.get("/viewgrades/download",{responseType:"blob"}),s=new Blob([e.data],{type:"application/pdf"}),n=document.createElement("a");n.href=window.URL.createObjectURL(s),n.download="gradeslip.pdf",n.click(),window.URL.revokeObjectURL(n.href)}catch(e){console.error("Failed to download PDF:",e)}};return L(async()=>{try{await k(),await j()}finally{y.value=!1}}),(e,s)=>(a(),S(E,{fullname:u.value,userLevel:x.value,title:"View Grades",class:"animate-slide-in-top"},{default:V(()=>[y.value?(a(),o("div",F,s[0]||(s[0]=[t("svg",{class:"animate-spin h-8 w-8 text-mccblue",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})],-1)]))):(a(),o("div",N,[t("div",T,[t("div",null,[t("p",U,[s[1]||(s[1]=b(" Curriculum: ")),t("span",O,l(d.value!==null&&d.value!==void 0?d.value:"Active"),1)]),t("p",R,[s[2]||(s[2]=b(" Total Subjects: ")),t("span",M,l(C.value),1),s[3]||(s[3]=b(" • With Grades: ")),t("span",P,l(B.value),1)])]),t("div",null,[t("button",{onClick:G,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded-md text-sm font-medium transition"}," Download a Copy ")])]),(a(!0),o(h,null,f(m.value,(n,i)=>(a(),o("div",{key:i,class:"mb-6"},[t("h2",W,l(i),1),(a(!0),o(h,null,f(n,(g,_)=>(a(),o("div",{key:_,class:"bg-white rounded shadow mb-4"},[t("h3",z,l(_),1),t("table",A,[s[5]||(s[5]=t("thead",{class:"bg-mcclightblue text-white"},[t("tr",null,[t("th",{class:"py-2 px-4 text-center md:text-base text-xs"},"Subject Code"),t("th",{class:"py-2 px-4 text-center md:text-base text-xs"},"Descriptive Title"),t("th",{class:"py-2 px-4 text-center md:text-base text-xs"},"Total Units"),t("th",{class:"py-2 px-4 text-center md:text-base text-xs"},"Grade")])],-1)),t("tbody",null,[(a(!0),o(h,null,f(g,c=>(a(),o("tr",{key:c.code,class:"hover:bg-gray-100 transition"},[t("td",H,l(c.code),1),t("td",$,l(c.title),1),t("td",q,l(c.total_units),1),t("td",I,[c.grade?(a(),o("span",J,l(Number(c.grade).toFixed(1)),1)):(a(),o("span",K,"–"))])]))),128)),g.length?D("",!0):(a(),o("tr",Q,s[4]||(s[4]=[t("td",{colspan:"4",class:"text-center py-3 text-gray-500"}," No subjects found for this semester. ",-1)])))])])]))),128))]))),128))]))]),_:1},8,["fullname","userLevel"]))}};export{et as default};
