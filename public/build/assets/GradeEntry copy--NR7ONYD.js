import{c as Q,r as u,N as xe,L as ve,o as ye,g as d,d as i,e as r,t as n,u as D,k as W,F as N,h as w,f,j as g,i as fe,a as P,n as ge}from"./app-CvgGXEGl.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _e={class:"p-6 bg-whitebg"},he={class:"grid grid-cols-3 gap-6 mb-6"},ke={class:"bg-blue-100 text-mcclightblue rounded-md p-4 shadow-md flex flex-col justify-between"},qe={class:"text-xl text-mccblue font-bold"},Ee={class:"bg-blue-100 text-mcclightblue rounded-md p-4 shadow-md flex flex-col justify-between"},Ne={class:"text-xl text-mccblue font-bold"},we={class:"text-md font-bold"},Ce={class:"bg-blue-100 text-mcclightblue rounded-md p-4 shadow-md flex flex-col justify-between"},Ae={class:"text-xl text-mccblue font-bold"},Se={class:"text-md font-bold"},Fe={class:"overflow-auto border rounded-lg max-h-[535px]"},Ue={class:"min-w-full border-collapse text-xs"},Ve=["colspan"],Ie=["disabled"],Re=["colspan"],Me=["disabled"],Te=["onUpdate:modelValue"],Ge={class:"border p-1 bg-gray-200 text-center font-semibold sticky top-8 z-30"},Le=["onUpdate:modelValue"],Qe={class:"border p-1 bg-gray-200 text-center font-semibold sticky top-8 z-30"},De={class:"border p-1 bg-blue-100 text-center sticky top-8 z-30"},Pe={class:"border p-1 bg-blue-100 text-center sticky top-8 z-30"},Oe={class:"border p-1 bg-blue-100 text-center sticky top-8 z-30"},$e={class:"border p-1 bg-gray-200 text-center sticky top-8 z-30"},He={key:0},Be=["colspan"],Ye={class:"border p-1 text-center"},Ze={class:"border p-1"},je={class:"border p-1"},Je={class:"border p-1"},Ke=["onUpdate:modelValue","max"],Xe={class:"border p-1 text-center font-semibold"},We={class:"border p-1 text-center font-semibold"},et={class:"border p-1 text-center font-semibold"},tt=["onUpdate:modelValue"],rt={class:"border p-1 text-center font-semibold"},ot={class:"border p-1 text-center font-semibold"},st={class:"border p-1 text-center font-semibold"},nt={class:"border p-1 text-center"},at=["onUpdate:modelValue","max"],lt={class:"border p-1 text-center font-semibold"},dt={class:"border p-1 text-center font-semibold"},it={class:"border p-1 text-center"},ct=["onUpdate:modelValue","max"],ut={class:"border p-1 text-center"},pt=["onUpdate:modelValue","max"],mt={class:"border p-1 text-center font-semibold"},bt={class:"border p-1 text-center font-semibold"},xt={class:"border p-1 text-center font-semibold"},vt={class:"border p-1 text-center font-semibold"},yt={class:"border p-1 text-center font-semibold"},ft={class:"mt-4 text-right"},gt=["disabled"],zt={__name:"GradeEntry copy",setup(_t){const ee=Q(()=>4+(m.value+3)+(b.value+3)+3+5+3),{url:te}=xe(),V=new URLSearchParams(te.split("?")[1]),I=V.get("subject")||"",R=V.get("course")||"",M=V.get("year")||"",T=V.get("section")||"",A=u(!0),m=u(5),b=u(10),v=u(Array(m.value).fill(0)),z=u(Array(b.value).fill(0)),_=u(100),q=u(100),E=u(100),y=u([]),O=Q(()=>v.value.reduce((t,e)=>t+(Number(e)||0),0)),$=Q(()=>z.value.reduce((t,e)=>t+(Number(e)||0),0)),H=Q(()=>(Number(q.value)||0)+(Number(E.value)||0)),re=()=>{m.value++,v.value.push(0),y.value.forEach(t=>{t.quizzes.push("")})},oe=()=>{b.value++,z.value.push(0),y.value.forEach(t=>{t.attendance.push("")})},se=()=>{m.value>1&&(m.value--,v.value.pop(),y.value.forEach(t=>{t.quizzes.pop()}))},ne=()=>{b.value>1&&(b.value--,z.value.pop(),y.value.forEach(t=>{t.attendance.pop()}))};function B(t){for(const e in t)if(Array.isArray(t[e]))t[e]=t[e].map(o=>{if(o===""||o===null)return o;const l=Number(o);return Number.isInteger(l)?parseInt(l):l});else if(typeof t[e]=="object"&&t[e]!==null)B(t[e]);else if(t[e]!==""&&t[e]!==null){const o=Number(t[e]);isNaN(o)||(t[e]=Number.isInteger(o)?parseInt(o):o)}}const ae=async()=>{var t,e,o,l,s,a,c,C;try{const k=await P.get("/session?source=gradeentry");if(Z.value=k.data.fullname,Y.value=k.data.level,G.value=k.data.username,!Z.value||!Y.value||Y.value!=="teacher"){window.location.href="/";return}}catch{window.location.href="/";return}try{A.value=!0;const k=`/grades/${encodeURIComponent(I)}/${encodeURIComponent(R)}/${encodeURIComponent(M)}/${encodeURIComponent(T)}`;console.log(`Fetching grades from: ${k}?teacher_username=${G.value}&ay_id=${h.value.id}`);const p=(await P.get(k,{params:{teacher_username:G.value,ay_id:h.value.id}})).data;B(p.gradesData),B(p.gradeComponents),m.value=p.quizCount??5,b.value=p.attendanceCount??10;const ce=((t=p.gradeComponents)==null?void 0:t.quiz)||{};v.value=Array(m.value).fill(0).map((S,x)=>ce[x+1]??0);const ue=((e=p.gradeComponents)==null?void 0:e.attendance)||{};z.value=Array(b.value).fill(0).map((S,x)=>ue[x+1]??0),_.value=((l=(o=p.gradeComponents)==null?void 0:o.performance)==null?void 0:l[1])??0,q.value=((a=(s=p.gradeComponents)==null?void 0:s.exam)==null?void 0:a[1])??0,E.value=((C=(c=p.gradeComponents)==null?void 0:c.exam)==null?void 0:C[2])??0,y.value=p.students.map(S=>{var j,J,K,X;const x=((j=p.gradesData)==null?void 0:j[S.studid])||{quizzes:[],attendance:[],performance:"",exams:[]},L=((J=p.summaryGrades)==null?void 0:J[S.studid])||{},pe=Array(m.value).fill("").map((be,F)=>{var U;return((U=x.quizzes)==null?void 0:U[F])!==void 0?x.quizzes[F]:""}),me=Array(b.value).fill("").map((be,F)=>{var U;return((U=x.attendance)==null?void 0:U[F])!==void 0?x.attendance[F]:""});return{...S,quizzes:pe,attendance:me,performance:x.performance??"",prelimScore:((K=x.exams)==null?void 0:K[0])??"",midtermScore:((X=x.exams)==null?void 0:X[1])??"",midterm:L.midterm??"",final:L.final??"",overall:L.overall??"",submitted:L.submitted??0,totals:{quiz:0,attendance:0,exam:0},equivs:{quiz:0,attendance:0,performance:0,exam:0},percents:{quiz:0,attendance:0,performance:0,exam:0},midtermGrade:0,equivalent:0,remarks:""}})}catch(k){console.error("Failed to fetch grades:",k)}finally{A.value=!1}};function le(t){return t>94.45?1:t>93.45?1.1:t>92.45?1.2:t>91.45?1.3:t>90.45?1.4:t>89.45?1.5:t>88.45?1.6:t>87.45?1.7:t>86.45?1.8:t>85.45?1.9:t>84.45?2:t>83.45?2.1:t>82.45?2.2:t>81.45?2.3:t>80.45?2.4:t>79.45?2.5:t>78.45?2.6:t>77.45?2.7:t>76.45?2.8:t>75.45?2.9:t>74.45?3:t>73.45?3.1:t>72.45?3.2:t>71.45?3.3:t>70.45?3.4:(t>69.45,3.5)}ve([y,v,z,_,q,E],()=>{y.value.forEach(t=>{const e=t.quizzes.reduce((c,C)=>c+(Number(C)||0),0);t.totals.quiz=e,t.equivs.quiz=O.value?e*40/O.value+60:0,t.percents.quiz=t.equivs.quiz*.3;const o=t.attendance.reduce((c,C)=>c+(Number(C)||0),0);t.totals.attendance=o,t.equivs.attendance=$.value?o*100/$.value:0,t.percents.attendance=t.equivs.attendance*.15,t.totals.performance=Number(t.performance)||0,t.equivs.performance=_.value?t.totals.performance*50/_.value+50:0,t.percents.performance=t.equivs.performance*.15;const l=Number(t.prelimScore)||0,s=Number(t.midtermScore)||0,a=l+s;t.totals.exam=a,t.equivs.exam=H.value?a*40/H.value+60:0,t.percents.exam=t.equivs.exam*.4,t.midtermGrade=(t.percents.quiz||0)+(t.percents.attendance||0)+(t.percents.performance||0)+(t.percents.exam||0),t.equivalent=Number(le(t.midtermGrade).toFixed(1)),t.remarks=t.midtermGrade>=75?"Passed":"Failed"})},{deep:!0,immediate:!0});const de=async()=>{try{const t=[];v.value.forEach((s,a)=>{t.push({component_type:"quiz",component_index:a+1,hps:Number(s)||0})}),z.value.forEach((s,a)=>{t.push({component_type:"attendance",component_index:a+1,hps:Number(s)||0})}),t.push({component_type:"performance",component_index:1,hps:Number(_.value)||0}),t.push({component_type:"exam",component_index:1,hps:Number(q.value)||0}),t.push({component_type:"exam",component_index:2,hps:Number(E.value)||0});const e=[];y.value.forEach(s=>{s.quizzes.forEach((a,c)=>{e.push({student_id:s.studid,component_type:"quiz",component_index:c+1,score:Number(a)||0})}),s.attendance.forEach((a,c)=>{e.push({student_id:s.studid,component_type:"attendance",component_index:c+1,score:Number(a)||0})}),e.push({student_id:s.studid,component_type:"performance",component_index:1,score:Number(s.performance)||0}),e.push({student_id:s.studid,component_type:"exam",component_index:1,score:Number(s.prelimScore)||0}),e.push({student_id:s.studid,component_type:"exam",component_index:2,score:Number(s.midtermScore)||0})});const o=y.value.map(s=>({student_id:s.studid,midterm:Number(s.equivalent)||0,final:Number(s.final)||0,overall:Number(s.overall)||0}));await P.post("/grades/save",{teacher_username:G.value,subject_code:I,course:R,year:M,section:T,ay_id:h.value.id,gradeComponents:t,gradesData:e,gradesSummary:o}),alert("Grades saved successfully!")}catch(t){console.error("Failed to save grades:",t),alert("Failed to save grades.")}},h=u({id:null,academicyear:"",semester:""}),Z=u(""),Y=u(""),G=u(""),ie=async()=>{try{const t=await P.get("/api/active-ay");t.data&&(h.value=t.data)}catch(t){console.error("Failed to fetch active academic year",t)}};return ye(()=>{ie(),I&&R&&M&&T?ae():A.value=!1}),(t,e)=>(i(),d("div",_e,[r("div",he,[r("div",ke,[r("div",qe,"Subject Code: "+n(D(I)),1),e[3]||(e[3]=r("div",{class:"text-md font-bold"},"Description here",-1))]),r("div",Ee,[r("div",Ne,"Course & Year: "+n(D(R))+" - "+n(D(M)),1),r("div",we,"Section: "+n(D(T)),1)]),r("div",Ce,[r("div",Ae," Semester: "+n(h.value.semester==="1"?"First Semester":h.value.semester==="2"?"Second Semester":h.value.semester==="3"?"Summer":"Loading..."),1),r("div",Se,"Academic Year: "+n(h.value.academicyear),1)])]),r("div",Fe,[r("table",Ue,[r("thead",null,[r("tr",null,[e[6]||(e[6]=r("th",{rowspan:"3",class:"bg-gray-300 border p-2"},"No.",-1)),e[7]||(e[7]=r("th",{rowspan:"3",class:"bg-gray-300 border p-2"},"LASTNAME",-1)),e[8]||(e[8]=r("th",{rowspan:"3",class:"bg-gray-300 border p-2"},"FIRSTNAME",-1)),e[9]||(e[9]=r("th",{rowspan:"3",class:"bg-gray-300 border p-2"},"MIDDLENAME",-1)),r("th",{colspan:m.value+3,class:"bg-gray-300 border p-2"},[e[4]||(e[4]=W(" QUIZZES ")),r("button",{onClick:re,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Quiz Column"}," + "),r("button",{onClick:se,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Quiz Column",disabled:m.value<=1}," - ",8,Ie)],8,Ve),r("th",{colspan:b.value+3,class:"bg-gray-300 border p-2"},[e[5]||(e[5]=W(" ATTENDANCE ")),r("button",{onClick:oe,class:"ml-2 bg-green-500 text-white px-2 py-0.5 rounded text-xs",title:"Add Attendance Column"}," + "),r("button",{onClick:ne,class:"ml-1 bg-red-500 text-white px-2 py-0.5 rounded text-xs",title:"Remove Attendance Column",disabled:b.value<=1}," - ",8,Me)],8,Re),e[10]||(e[10]=r("th",{colspan:"3",class:"bg-gray-300 border p-2"},"PERFORMANCE",-1)),e[11]||(e[11]=r("th",{colspan:"5",class:"bg-gray-300 border p-2"},"MAJOR EXAM",-1)),e[12]||(e[12]=r("th",{colspan:"3",class:"bg-gray-300 border p-2"},"PRELIM",-1))]),r("tr",null,[(i(!0),d(N,null,w(m.value,o=>(i(),d("th",{key:"q-label-"+o,class:"bg-blue-100 border p-1 text-center sticky top-0 z-30"}," Q"+n(o),1))),128)),e[13]||(e[13]=r("th",{class:"bg-gray-200 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[14]||(e[14]=r("th",{class:"bg-gray-200 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[15]||(e[15]=r("th",{class:"bg-gray-200 border p-1 text-center sticky top-0 z-30"},"30%",-1)),(i(!0),d(N,null,w(b.value,o=>(i(),d("th",{key:"a-label-"+o,class:"bg-blue-100 border p-1 text-center sticky top-0 z-30"}," A"+n(o),1))),128)),e[16]||(e[16]=r("th",{class:"bg-gray-200 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[17]||(e[17]=r("th",{class:"bg-gray-200 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[18]||(e[18]=r("th",{class:"bg-gray-200 border p-1 text-center sticky top-0 z-30"},"15%",-1)),e[19]||(e[19]=r("th",{class:"bg-blue-100 border p-1 text-center sticky top-0 z-30"},"100",-1)),e[20]||(e[20]=r("th",{class:"bg-gray-200 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[21]||(e[21]=r("th",{class:"bg-gray-200 border p-1 text-center sticky top-0 z-30"},"15%",-1)),e[22]||(e[22]=r("th",{class:"bg-blue-100 border p-1 text-center sticky top-0 z-30"},"PRELIM SCORE",-1)),e[23]||(e[23]=r("th",{class:"bg-blue-100 border p-1 text-center sticky top-0 z-30"},"MIDTERM SCORE",-1)),e[24]||(e[24]=r("th",{class:"bg-gray-200 border p-1 text-center sticky top-0 z-30"},"TOTAL",-1)),e[25]||(e[25]=r("th",{class:"bg-gray-200 border p-1 text-center sticky top-0 z-30"},"EQUIV",-1)),e[26]||(e[26]=r("th",{class:"bg-gray-200 border p-1 text-center sticky top-0 z-30"},"40%",-1)),e[27]||(e[27]=r("th",{class:"bg-gray-200 border p-1 text-center sticky top-0 z-30"},"MIDTERM GRADE",-1)),e[28]||(e[28]=r("th",{class:"bg-gray-200 border p-1 text-center sticky top-0 z-30"},"EQUIVALENT",-1)),e[29]||(e[29]=r("th",{class:"bg-gray-100 border p-1 text-center sticky top-0 z-30"},"REMARKS",-1))]),r("tr",null,[(i(!0),d(N,null,w(v.value,(o,l)=>(i(),d("td",{key:"hps-quiz-"+l,class:"border p-1 bg-blue-100 sticky top-8 z-30"},[f(r("input",{"onUpdate:modelValue":s=>v.value[l]=s,type:"number",min:"0",class:"w-12 border px-1 text-center bg-blue-100"},null,8,Te),[[g,v.value[l],void 0,{number:!0}]])]))),128)),r("td",Ge,n(O.value.toFixed(0)),1),e[30]||(e[30]=r("td",{class:"border p-1 bg-gray-200 text-center sticky top-8 z-30"},"100",-1)),e[31]||(e[31]=r("td",{class:"border p-1 bg-gray-200 text-center sticky top-8 z-30"},"30",-1)),(i(!0),d(N,null,w(z.value,(o,l)=>(i(),d("td",{key:"hps-attendance-"+l,class:"border p-1 bg-blue-100 sticky top-8 z-30"},[f(r("input",{"onUpdate:modelValue":s=>z.value[l]=s,type:"number",min:"0",class:"w-12 border px-1 text-center bg-blue-100"},null,8,Le),[[g,z.value[l],void 0,{number:!0}]])]))),128)),r("td",Qe,n($.value.toFixed(0)),1),e[32]||(e[32]=r("td",{class:"border p-1 bg-gray-200 text-center sticky top-8 z-30"},"100",-1)),e[33]||(e[33]=r("td",{class:"border p-1 bg-gray-200 text-center sticky top-8 z-30"},"15",-1)),r("td",De,[f(r("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>_.value=o),type:"number",min:"0",class:"w-12 border px-1 text-center bg-blue-100"},null,512),[[g,_.value,void 0,{number:!0}]])]),e[34]||(e[34]=r("td",{class:"border p-1 bg-gray-200 text-center sticky top-8 z-30"},"100",-1)),e[35]||(e[35]=r("td",{class:"border p-1 bg-gray-200 text-center sticky top-8 z-30"},"15",-1)),r("td",Pe,[f(r("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>q.value=o),type:"number",min:"0",class:"w-12 border px-1 text-center bg-blue-100"},null,512),[[g,q.value,void 0,{number:!0}]])]),r("td",Oe,[f(r("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>E.value=o),type:"number",min:"0",class:"w-12 border px-1 text-center bg-blue-100 sticky top-8 z-30"},null,512),[[g,E.value,void 0,{number:!0}]])]),r("td",$e,n(H.value.toFixed(0)),1),e[36]||(e[36]=r("td",{class:"border p-1 bg-gray-200 text-center sticky top-8 z-30"},"100",-1)),e[37]||(e[37]=r("td",{class:"border p-1 bg-gray-200 text-center sticky top-8 z-30"},"40",-1)),e[38]||(e[38]=r("td",{colspan:"2",class:"border p-1 bg-gray-200 sticky top-8 z-30"},null,-1)),e[39]||(e[39]=r("td",{colspan:"1",class:"border p-1 bg-gray-100 sticky top-8 z-30"},null,-1))])]),r("tbody",null,[A.value?(i(),d("tr",He,[r("td",{colspan:ee.value,class:"text-center p-4"},"Loading student data...",8,Be)])):fe("",!0),(i(!0),d(N,null,w(y.value,(o,l)=>(i(),d("tr",{key:o.id},[r("td",Ye,n(l+1),1),r("td",Ze,n(o.lname),1),r("td",je,n(o.fname),1),r("td",Je,n(o.mname),1),(i(!0),d(N,null,w(o.quizzes,(s,a)=>(i(),d("td",{key:"quiz-"+l+"-"+a,class:"border p-1"},[f(r("input",{"onUpdate:modelValue":c=>o.quizzes[a]=c,type:"number",min:"0",max:v.value[a]||100,class:"w-12 border px-1 text-center"},null,8,Ke),[[g,o.quizzes[a],void 0,{number:!0}]])]))),128)),r("td",Xe,n(o.totals.quiz.toFixed(0)),1),r("td",We,n(o.equivs.quiz.toFixed(0)),1),r("td",et,n(o.percents.quiz.toFixed(0)),1),(i(!0),d(N,null,w(o.attendance,(s,a)=>(i(),d("td",{key:"att-"+l+"-"+a,class:"border p-1"},[f(r("input",{"onUpdate:modelValue":c=>o.attendance[a]=c,type:"number",min:"0",max:"1",class:"w-12 border px-1 text-center"},null,8,tt),[[g,o.attendance[a],void 0,{number:!0}]])]))),128)),r("td",rt,n(o.totals.attendance.toFixed(0)),1),r("td",ot,n(o.equivs.attendance.toFixed(0)),1),r("td",st,n(o.percents.attendance.toFixed(0)),1),r("td",nt,[f(r("input",{"onUpdate:modelValue":s=>o.performance=s,type:"number",min:"0",max:_.value,class:"w-12 border px-1 text-center"},null,8,at),[[g,o.performance,void 0,{number:!0}]])]),r("td",lt,n(o.equivs.performance.toFixed(0)),1),r("td",dt,n(o.percents.performance.toFixed(0)),1),r("td",it,[f(r("input",{"onUpdate:modelValue":s=>o.prelimScore=s,type:"number",min:"0",max:q.value,class:"w-12 border px-1 text-center"},null,8,ct),[[g,o.prelimScore,void 0,{number:!0}]])]),r("td",ut,[f(r("input",{"onUpdate:modelValue":s=>o.midtermScore=s,type:"number",min:"0",max:E.value,class:"w-12 border px-1 text-center"},null,8,pt),[[g,o.midtermScore,void 0,{number:!0}]])]),r("td",mt,n(o.totals.exam.toFixed(0)),1),r("td",bt,n(o.equivs.exam.toFixed(0)),1),r("td",xt,n(o.percents.exam.toFixed(0)),1),r("td",vt,n(o.midtermGrade.toFixed(0)),1),r("td",yt,n(o.equivalent.toFixed(1)),1),r("td",{class:ge(["border p-1 text-center font-semibold",{"text-green-700 bg-green-100":o.remarks==="Passed","text-red-700 bg-red-100":o.remarks==="Failed"}])},n(o.remarks),3)]))),128))])])]),r("div",ft,[r("button",{onClick:de,disabled:A.value,class:"bg-mccblue hover:bg-mccdarkblue text-white px-4 py-2 rounded transition"}," Save Grades ",8,gt)])]))}},Nt=ze(zt,[["__scopeId","data-v-76704c8c"]]);export{Nt as default};
