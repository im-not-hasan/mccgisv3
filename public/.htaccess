# ===============================================================
# Laravel Root .htaccess â€” Secure + Hostinger Compatible (FINAL)
# ===============================================================

<IfModule mod_rewrite.c>
  RewriteEngine On

  # ğŸš« Block direct /public access
  RewriteCond %{THE_REQUEST} "\s/public([/?#\s]|$)" [NC]
  RewriteRule ^ - [R=403,L]

  # ğŸš« Block direct /index.php access
  RewriteCond %{THE_REQUEST} "^[A-Z]{3,}\s/+index\.php[?\s]" [NC]
  RewriteRule ^index\.php$ - [R=403,L]

  # âœ… Redirect everything else INTO /public (but not twice)
  RewriteCond %{REQUEST_URI} !^/public/
  RewriteRule ^(.*)$ public/$1 [L]
</IfModule>

# ===============================================================
# ğŸ§± Smart image protection (Hostinger-safe)
# ===============================================================
# Allow images to load inside pages, but block manual address-bar hits
<FilesMatch "(?i)^(logo\.png|header\.png|watermark\.png)$">
  <If "%{HTTP_REFERER} == ''">
    Require all denied
  </If>
</FilesMatch>

# Explanation:
# - If an image is loaded from your site (has a referer header), it's allowed âœ…
# - If someone opens it directly in the browser bar (no referer), it's denied ğŸš«


# ===============================================================
# ğŸ”’ Security Hardening
# ===============================================================
RedirectMatch 404 /\.(env|git|ht|DS_Store)
RedirectMatch 404 /\.env\..*
RedirectMatch 404 ^/(storage|vendor|bootstrap|resources|config)/.*

Options -Indexes

# ===============================================================
# ğŸ›¡ï¸ Security Headers
# ===============================================================
<IfModule mod_headers.c>
  Header always set X-XSS-Protection "1; mode=block"
  Header always set X-Content-Type-Options "nosniff"
  Header always set Referrer-Policy "no-referrer"
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), fullscreen=(self)"
</IfModule>
